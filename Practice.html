<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Neuroverbs ¬∑ TenseMaster v8.0</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,700;0,9..144,900;1,9..144,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,700;1,400&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
/* =========================================================
   Neuroverbs v8.0 ‚Äî Mejoras completas
   - Modal nativo reemplaza prompt()
   - URL hash routing
   - Autocomplete de verbos
   - Bot√≥n copiar oraci√≥n
   - Cobertura espa√±ol ampliada
   - UX mobile mejorada
   - Estad√≠sticas de tiempos visitados
   - Animaciones refinadas
========================================================= */

html { font-size: 16px; scroll-behavior: smooth; }
html.bigtext { font-size: 18px; }

body {
  font-family: 'DM Sans', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: var(--bg); color: var(--tx);
  min-height: 100vh; overflow-x: hidden;
  font-size: 1.02rem; line-height: 1.5;
}

:root {
  --bg: #080f1a;
  --s1: #0c1526;
  --s2: #111d30;
  --s3: #16243c;
  --s4: #1c2d48;
  --b0: rgba(255,255,255,.04);
  --b1: rgba(255,255,255,.10);
  --b2: rgba(255,255,255,.16);
  --b3: rgba(255,255,255,.26);
  --tx:  #e6f0fb;
  --tx2: #a6bfd8;
  --tx3: #5e7b98;
  --teal: #00c8a8;
  --teal2: #00e8c4;
  --teal3: #b3fff4;
  --teal-a: rgba(0,200,168,.10);
  --teal-b: rgba(0,200,168,.18);
  --past:  #e8506a;
  --past2: #ff7a90;
  --past-a: rgba(232,80,106,.11);
  --pres:  #00c8a8;
  --pres2: #00e8c4;
  --pres-a: rgba(0,200,168,.10);
  --fut:  #f09a1a;
  --fut2: #ffc040;
  --fut-a: rgba(240,154,26,.10);
  --indigo: #6c8ef5;
  --indigo-a: rgba(108,142,245,.12);
  --violet: #a87ff0;
  --violet-a: rgba(168,127,240,.12);
  --reg-bg: rgba(0,220,130,.14);
  --reg-c: #00dc82;
  --reg-bd: rgba(0,220,130,.35);
  --irr-bg: rgba(255,100,120,.14);
  --irr-c: #ff7a90;
  --irr-bd: rgba(255,100,120,.35);
  --v1: #ff8a00;
  --v2: #52a6ff;
  --v3: #00dc82;
  --adv-es: #6c8ef5;
  --tm-es: #a87ff0;
  --theme-speed: .35s;
  --topbar-h: 72px;
  --modal-z: 100000;
}

html.light {
  --bg: #f2f7fd;
  --s1: #ffffff;
  --s2: #eef5ff;
  --s3: #e3eefc;
  --s4: #d6e6f8;
  --b0: rgba(0,0,0,.04);
  --b1: rgba(0,0,0,.10);
  --b2: rgba(0,0,0,.16);
  --b3: rgba(0,0,0,.24);
  --tx: #0d2138;
  --tx2: #37516b;
  --tx3: #6f8aa4;
  --teal: #00a888;
  --teal2: #008c70;
  --teal3: #0d2138;
  --teal-a: rgba(0,168,136,.10);
  --teal-b: rgba(0,168,136,.20);
  --past: #c8334e;
  --past2: #a01e38;
  --past-a: rgba(200,51,78,.09);
  --pres: #00a888;
  --pres2: #007a60;
  --pres-a: rgba(0,168,136,.09);
  --fut: #c87200;
  --fut2: #a05800;
  --fut-a: rgba(200,114,0,.10);
  --indigo: #3d5ecc;
  --indigo-a: rgba(61,94,204,.10);
  --violet: #7048c8;
  --violet-a: rgba(112,72,200,.12);
  --reg-bg: rgba(0,160,90,.12);
  --reg-c: #007040;
  --reg-bd: rgba(0,160,90,.30);
  --irr-bg: rgba(180,40,60,.10);
  --irr-c: #a01e38;
  --irr-bd: rgba(180,40,60,.28);
  --v1: #c87200;
  --v2: #2b6fdd;
  --v3: #007040;
  --adv-es: #3d5ecc;
  --tm-es: #7048c8;
}

html.hc { --tx:#fff; --tx2:#e9f1ff; --tx3:#c7dcff; --b1:rgba(255,255,255,.22); --b2:rgba(255,255,255,.34); --b3:rgba(255,255,255,.44); }
html.light.hc { --tx:#000; --tx2:#0f1f33; --tx3:#2f4e70; --b1:rgba(0,0,0,.20); --b2:rgba(0,0,0,.30); --b3:rgba(0,0,0,.40); }

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
*, *::before, *::after {
  transition: background-color var(--theme-speed) ease, border-color var(--theme-speed) ease,
              color var(--theme-speed) ease, box-shadow var(--theme-speed) ease, transform .18s ease;
}
::selection { background: rgba(0,200,168,.25); color: var(--teal3); }

body::before {
  content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background:
    radial-gradient(ellipse 70% 55% at 0% 0%,    rgba(0,200,168,.05) 0%, transparent 55%),
    radial-gradient(ellipse 55% 50% at 100% 100%, rgba(108,142,245,.06) 0%, transparent 55%),
    radial-gradient(ellipse 45% 60% at 50% 40%,  rgba(232,80,106,.03) 0%, transparent 60%);
}
html.light body::before {
  background:
    radial-gradient(ellipse 70% 55% at 0% 0%,    rgba(0,168,136,.06) 0%, transparent 55%),
    radial-gradient(ellipse 55% 50% at 100% 100%, rgba(61,94,204,.05) 0%, transparent 55%),
    radial-gradient(ellipse 45% 60% at 50% 40%,  rgba(200,51,78,.03) 0%, transparent 60%);
}
body::after {
  content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0; opacity: .28;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.04'/%3E%3C/svg%3E");
}
html.light body::after { opacity: .14; }

/* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
.topbar {
  position: fixed;
  left: 14px; right: 14px;
  top: calc(env(safe-area-inset-top) + 10px);
  z-index: 99999;
  display: flex; align-items: center; justify-content: space-between; gap: 12px;
  padding: 10px 12px;
  border-radius: 16px; border: 1px solid var(--b2);
  background: rgba(10,18,30,.60);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  box-shadow: 0 10px 30px rgba(0,0,0,.28);
}
html.light .topbar { background: rgba(255,255,255,.86); box-shadow: 0 10px 30px rgba(0,0,0,.10); }

.topbar-info { display: flex; align-items: center; gap: 10px; min-width: 0; flex: 1 1 auto; }
.ts-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--teal2); box-shadow: 0 0 12px rgba(0,200,168,.45); flex: 0 0 auto; }
.ts-txt { color: var(--tx2); font-weight: 900; font-size: .92rem; white-space: nowrap; }
.ts-name { font-family: 'JetBrains Mono', monospace; font-weight: 900; font-size: .92rem; letter-spacing: .4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 44vw; }
.ts-zone { font-family: 'JetBrains Mono', monospace; font-weight: 900; font-size: .70rem; letter-spacing: 2px; text-transform: uppercase; padding: 5px 10px; border-radius: 999px; border: 1px solid var(--b2); color: var(--tx); flex: 0 0 auto; }
.topbar-actions { display: flex; align-items: center; gap: 10px; flex: 0 0 auto; }

.tbtn {
  width: 40px; height: 40px; border-radius: 12px; border: 1px solid var(--b2);
  background: var(--s3); color: var(--tx); box-shadow: 0 2px 12px rgba(0,0,0,.18);
  display: grid; place-items: center;
}
html.light .tbtn { box-shadow: 0 2px 12px rgba(0,0,0,.08); }
.tbtn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(0,200,168,.18); }
.tbtn[aria-pressed="true"] { background: var(--teal-a); border-color: var(--teal); color: var(--teal2); }
.tbtn small { font-family: 'JetBrains Mono', monospace; font-weight: 900; letter-spacing: 1px; }

.topbar-actions a.tbtn{ text-decoration:none; padding:0; }

/* Stats badge en topbar */
.ts-progress {
  display: flex; align-items: center; gap: 5px;
  padding: 4px 9px; border-radius: 99px;
  border: 1px solid var(--b1);
  background: var(--b0);
  font-family: 'JetBrains Mono', monospace;
  font-size: .62rem; font-weight: 900;
  color: var(--tx3); white-space: nowrap;
  letter-spacing: 1px;
}

@media(max-width: 520px) {
  .topbar { flex-wrap: wrap; justify-content: flex-start; }
  .topbar-info { justify-content: flex-start; flex-wrap: wrap; }
  .ts-name { max-width: 80vw; }
  .topbar-actions { margin-left: auto; }
  .ts-progress { display: none; }
}

/* Layout */
.wrap {
  position: relative; z-index: 1;
  max-width: 1060px; margin: 0 auto;
  padding: calc(var(--topbar-h, 72px) + 32px) 16px 80px;
}

/* Cards */
@keyframes fu { from { opacity: 0; transform: translateY(18px); } to { opacity: 1; transform: none; } }
.a0 { opacity: 0; animation: fu .55s cubic-bezier(.22,1,.36,1) .05s both; }
.a1 { opacity: 0; animation: fu .55s cubic-bezier(.22,1,.36,1) .14s both; }
.a2 { opacity: 0; animation: fu .55s cubic-bezier(.22,1,.36,1) .23s both; }
.a3 { opacity: 0; animation: fu .55s cubic-bezier(.22,1,.36,1) .32s both; }
.a4 { opacity: 0; animation: fu .55s cubic-bezier(.22,1,.36,1) .41s both; }
.a5 { opacity: 0; animation: fu .55s cubic-bezier(.22,1,.36,1) .50s both; }
.a6 { opacity: 0; animation: fu .55s cubic-bezier(.22,1,.36,1) .59s both; }
@media (prefers-reduced-motion: reduce) { * { animation: none !important; transition: none !important; } }

.card {
  background: var(--s1); border: 1px solid var(--b1); border-radius: 20px;
  padding: 22px; margin-bottom: 14px; box-shadow: 0 6px 22px rgba(0,0,0,.20);
}
html.light .card { box-shadow: 0 6px 22px rgba(0,0,0,.08); }
.card:hover { transform: translateY(-1px); box-shadow: 0 14px 44px rgba(0,0,0,.28), 0 0 0 1px var(--b2); }
html.light .card:hover { box-shadow: 0 14px 44px rgba(0,0,0,.12), 0 0 0 1px var(--b2); }

.card-lbl {
  font-family: 'JetBrains Mono', monospace; font-size: .62rem; letter-spacing: 3.3px;
  text-transform: uppercase; margin-bottom: 16px; display: flex; align-items: center; gap: 9px; color: var(--tx3);
}
button, input { font: inherit; }
button { cursor: pointer; }
button:focus-visible, input:focus-visible { outline: 3px solid rgba(108,142,245,.55); outline-offset: 3px; }
html.hc button:focus-visible, html.hc input:focus-visible { outline: 3px solid rgba(255,255,255,.85); }

/* Header */
.hdr { text-align: center; margin-bottom: 22px; }
.hdr-tag {
  display: inline-block; font-family: 'JetBrains Mono', monospace; font-size: .62rem;
  letter-spacing: 4px; text-transform: uppercase; color: var(--teal);
  border: 1px solid var(--teal-b); background: var(--teal-a); padding: 6px 14px; border-radius: 20px; margin-bottom: 12px;
}
.hdr h1 {
  font-family: 'Fraunces', serif; font-size: clamp(2.5rem,5vw,3.9rem);
  font-weight: 900; font-style: italic; letter-spacing: -2px; line-height: 1.05; margin-bottom: 8px;
  background: linear-gradient(130deg, var(--tx) 10%, var(--teal2) 48%, var(--indigo) 88%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.hdr p { color: var(--tx2); font-size: 1rem; max-width: 820px; margin: 0 auto; }
.hdr .sub { margin-top: 8px; font-size: .92rem; color: var(--tx3); }

/* Share / hash routing pill */
.hdr-hash {
  margin-top: 10px;
  display: inline-flex; align-items: center; gap: 8px;
  background: var(--s2); border: 1px solid var(--b1);
  border-radius: 99px; padding: 6px 14px;
  font-family: 'JetBrains Mono', monospace; font-size: .72rem;
  color: var(--tx3); cursor: pointer; user-select: none;
}
.hdr-hash:hover { border-color: var(--teal); color: var(--teal2); background: var(--teal-a); }
.hdr-hash span { font-size: .82rem; }

/* ‚îÄ‚îÄ TIMELINE STICKY ‚îÄ‚îÄ */
.tl-wrap {
  position: sticky;
  top: calc(env(safe-area-inset-top) + 10px + var(--topbar-h) + 10px);
  z-index: 99998;
  background: rgba(10,18,30,.58);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border: 1px solid var(--b2); border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,.22);
  padding: 46px 18px 30px; margin-bottom: 14px;
  overflow-x: auto; min-height: 140px;
}
html.light .tl-wrap { background: rgba(255,255,255,.86); box-shadow: 0 10px 30px rgba(0,0,0,.09); }

.tl-track {
  position: relative; height: 4px; min-width: 700px; border-radius: 2px;
  background: linear-gradient(to right,
    rgba(232,80,106,.2) 0%, rgba(232,80,106,.2) 36%,
    rgba(0,200,168,.2) 36%, rgba(0,200,168,.2) 64%,
    rgba(240,154,26,.2) 64%, rgba(240,154,26,.2) 100%);
}
.zlb {
  position: absolute; top: -28px;
  font-family: 'JetBrains Mono', monospace; font-size: .55rem;
  letter-spacing: 2.5px; text-transform: uppercase; font-weight: 800; padding: 3px 10px; border-radius: 16px;
}
.zp { left: 5%;  color: var(--past2);  background: var(--past-a); border: 1px solid rgba(232,80,106,.26); }
.zn { left: 39%; color: var(--pres2); background: var(--pres-a); border: 1px solid rgba(0,200,168,.26); }
.zf { left: 67%; color: var(--fut2);  background: var(--fut-a);  border: 1px solid rgba(240,154,26,.26); }

@keyframes heartbeat {
  0%,100% { box-shadow: 0 0 10px var(--teal), 0 0 24px rgba(0,200,168,.4), 0 0 0 0 rgba(0,200,168,.5); }
  50%      { box-shadow: 0 0 14px var(--teal), 0 0 36px rgba(0,200,168,.6), 0 0 0 12px rgba(0,200,168,0); }
}
.now-mk { position: absolute; left: 44.5%; top: 50%; transform: translate(-50%,-50%); z-index: 4; }
.now-line { width: 2px; height: 62px; background: linear-gradient(to bottom,transparent,var(--teal2),transparent); margin: 0 auto; position: relative; top: -30px; }
.now-dot { width: 9px; height: 9px; border-radius: 50%; background: var(--teal2); position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); animation: heartbeat 2.4s ease-in-out infinite; }
.now-lbl { position: absolute; top: -42px; left: 50%; transform: translateX(-50%); font-family: 'JetBrains Mono', monospace; font-size: .54rem; letter-spacing: 3px; color: var(--teal2); white-space: nowrap; }

@keyframes nodeRing {
  0%   { box-shadow: 0 0 16px currentColor, 0 0 0 0 rgba(255,255,255,.3); }
  60%  { box-shadow: 0 0 16px currentColor, 0 0 0 10px rgba(255,255,255,0); }
  100% { box-shadow: 0 0 16px currentColor, 0 0 0 0 rgba(255,255,255,0); }
}
.tn { position: absolute; top: 50%; transform: translate(-50%,-50%); z-index: 3; cursor: pointer; outline: none; }
.tn .dot { width: 12px; height: 12px; border-radius: 50%; background: currentColor; border: 2px solid var(--bg); }
html.light .tn .dot { border-color: rgba(255,255,255,.92); }
.tn:hover .dot { transform: scale(1.7); box-shadow: 0 0 12px currentColor; }
.tn.active .dot { transform: scale(2.5); border-color: rgba(255,255,255,.92); animation: nodeRing 1.8s ease-out infinite; }
.tn .tlbl { position: absolute; white-space: nowrap; font-size: .60rem; font-weight: 800; color: var(--tx3); width: 110px; text-align: center; left: 50%; transform: translateX(-50%); pointer-events: none; }
.tlbl.u { bottom: 18px; }
.tlbl.d { top: 18px; }
.tn:hover .tlbl, .tn.active .tlbl { color: var(--tx2); }

/* Visited dots */
.tn .dot.visited::after { content: ''; position: absolute; width: 5px; height: 5px; border-radius: 50%; background: var(--teal2); top: -1px; right: -1px; opacity: .8; }

@media(max-width: 560px) {
  .tl-wrap { padding: 44px 14px 26px; min-height: 132px; }
  .tl-track { min-width: 760px; }
  .tn .tlbl { font-size: .58rem; width: 104px; }
}

/* Tense header */
.tense-hdr { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; margin-bottom: 14px; }
.t-name { font-family: 'Fraunces', serif; font-size: 1.9rem; font-weight: 800; font-style: italic; }
.t-zone { font-family: 'JetBrains Mono', monospace; font-size: .62rem; letter-spacing: 2px; text-transform: uppercase; padding: 5px 13px; border-radius: 30px; font-weight: 900; }

/* Uso cards */
.uso-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(210px,1fr)); gap: 10px; }
.uso-card { background: var(--s2); border: 1px solid var(--b1); border-radius: 14px; padding: 14px 13px; }
.uso-ico { font-size: 1.25rem; margin-bottom: 5px; }
.uso-ti { font-size: .92rem; font-weight: 900; color: var(--tx); margin-bottom: 3px; }
.uso-desc { font-size: .8rem; color: var(--tx2); line-height: 1.55; margin-bottom: 8px; }
.uso-en { font-family: 'JetBrains Mono', monospace; font-size: .72rem; color: var(--teal2); margin-bottom: 2px; }
.uso-es { font-size: .74rem; color: var(--tx3); font-style: italic; }

/* Structure */
.fml-box {
  background: var(--bg); border: 2px solid var(--b2); border-radius: 12px;
  padding: 14px 16px; margin-bottom: 16px;
  font-family: 'JetBrains Mono', monospace; font-size: .82rem; color: var(--teal2);
  text-align: center; line-height: 1.6; position: relative;
}
.fml-lbl { position: absolute; top: 6px; left: 12px; font-size: .52rem; letter-spacing: 3px; color: var(--tx3); text-transform: uppercase; font-weight: 900; }
.aux-modes { display: flex; flex-direction: column; gap: 10px; }
.aux-block { background: var(--s2); border: 1px solid var(--b1); border-radius: 14px; padding: 14px 16px; }
.aux-block-lbl { font-family: 'JetBrains Mono', monospace; font-size: .56rem; letter-spacing: 2px; text-transform: uppercase; color: var(--tx3); margin-bottom: 9px; font-weight: 900; }
.chips-row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-bottom: 7px; }
.chip { display: inline-flex; align-items: center; padding: 6px 12px; border-radius: 9px; font-family: 'JetBrains Mono', monospace; font-size: .76rem; font-weight: 900; line-height: 1; }
.ch-subj { background: rgba(0,200,168,.12);   color: var(--teal2);  border: 1px solid rgba(0,200,168,.30); }
.ch-aux  { background: var(--violet-a);       color: #d7c3ff;       border: 1px solid rgba(168,127,240,.34); }
.ch-neg  { background: var(--past-a);         color: var(--past2);  border: 1px solid rgba(232,80,106,.34); }
.ch-verb { background: rgba(108,142,245,.12); color: var(--indigo); border: 1px solid rgba(108,142,245,.34); }
.ch-obj  { background: rgba(255,255,255,.04); color: var(--tx2);    border: 1px solid var(--b1); }
.ch-arr  { color: var(--tx3); font-size: 1.0rem; padding: 0 1px; }
.aux-note { font-size: .74rem; color: var(--tx2); font-style: italic; line-height: 1.55; }

/* Verb Engine */
.ve-grid { display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: start; }
.ve-lbl-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
.ve-main-lbl { font-family: 'JetBrains Mono', monospace; font-size: .62rem; letter-spacing: 3px; text-transform: uppercase; color: var(--teal); font-weight: 900; }
.ve-count-badge { font-size: .58rem; color: var(--tx3); background: var(--s2); padding: 4px 10px; border-radius: 10px; font-family: 'JetBrains Mono', monospace; letter-spacing: 1px; border: 1px solid var(--b1); }

/* Search / autocomplete */
.srch-wrap { position: relative; margin-bottom: 14px; }
.srch-ico { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--tx3); font-size: 1.05rem; pointer-events: none; z-index: 2; }
.srch-in {
  width: 100%; padding: 14px 42px 14px 44px;
  border-radius: 14px; border: 2px solid rgba(255,138,0,.55);
  background: linear-gradient(180deg, rgba(255,138,0,.08), rgba(255,255,255,.02));
  color: var(--tx); font-size: 1.02rem; font-weight: 700; outline: none;
  box-shadow: 0 0 0 1px rgba(255,138,0,.10), 0 10px 28px rgba(0,0,0,.18);
}
html.light .srch-in { background: linear-gradient(180deg, rgba(200,114,0,.10), rgba(255,255,255,.75)); border-color: rgba(200,114,0,.55); }
.srch-in:focus { border-color: rgba(255,138,0,.85); box-shadow: 0 0 0 4px rgba(255,138,0,.18), 0 12px 30px rgba(0,0,0,.18); }
.srch-in::placeholder { color: var(--tx3); font-weight: 600; }

/* Clear button inside input */
.srch-clear {
  position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  width: 28px; height: 28px; border-radius: 8px; border: 1px solid var(--b2);
  background: var(--s3); color: var(--tx3); font-size: .9rem;
  display: none; place-items: center; cursor: pointer;
}
.srch-clear.show { display: grid; }
.srch-clear:hover { color: var(--past2); border-color: var(--past2); }

/* Autocomplete dropdown */
.ac-drop {
  position: absolute; top: calc(100% + 6px); left: 0; right: 0; z-index: 500;
  background: var(--s1); border: 1px solid var(--b2); border-radius: 14px;
  box-shadow: 0 16px 40px rgba(0,0,0,.28); overflow: hidden;
  display: none;
}
.ac-drop.show { display: block; }
.ac-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 14px; cursor: pointer;
  border-bottom: 1px solid var(--b0);
  font-size: .9rem; color: var(--tx);
}
.ac-item:last-child { border-bottom: none; }
.ac-item:hover, .ac-item.focused { background: var(--s2); }
.ac-item-en { font-family: 'JetBrains Mono', monospace; font-weight: 900; color: var(--v1); }
.ac-item-es { font-size: .78rem; color: var(--tx3); font-style: italic; }
.ac-item-irr { font-size: .6rem; letter-spacing: 1.5px; text-transform: uppercase; font-weight: 900; padding: 2px 7px; border-radius: 6px; }
.ac-item-irr.irr { background: var(--irr-bg); color: var(--irr-c); border: 1px solid var(--irr-bd); }
.ac-item-irr.reg { background: var(--reg-bg); color: var(--reg-c); border: 1px solid var(--reg-bd); }

.v3-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; }
.vc { background: var(--s2); border: 1px solid var(--b1); border-radius: 14px; padding: 14px 12px; text-align: center; }
.vc-lbl { font-family: 'JetBrains Mono', monospace; font-size: .52rem; letter-spacing: 2px; text-transform: uppercase; color: var(--tx3); display: block; margin-bottom: 8px; font-weight: 900; }
.vc-form { font-family: 'JetBrains Mono', monospace; font-size: 1.08rem; font-weight: 900; display: block; }
#v1 { color: var(--v1); }
#v2 { color: var(--v2); }
#v3 { color: var(--v3); }
.vc-esp { font-size: .78rem; color: var(--tx3); display: block; margin-top: 6px; font-style: italic; }
.vtype-wrap { display: flex; justify-content: center; margin-top: 10px; }
.vtype { display: inline-flex; align-items: center; gap: 7px; padding: 5px 14px; border-radius: 22px; font-size: .6rem; letter-spacing: 2px; font-weight: 900; font-family: 'JetBrains Mono', monospace; text-transform: uppercase; }
.vtype::before { content: ''; width: 8px; height: 8px; border-radius: 50%; background: currentColor; flex-shrink: 0; }
.vtype.reg { background: var(--reg-bg); color: var(--reg-c); border: 1px solid var(--reg-bd); }
.vtype.irr { background: var(--irr-bg); color: var(--irr-c); border: 1px solid var(--irr-bd); }
.ve-right { background: var(--s2); border: 1px solid var(--b1); border-radius: 14px; padding: 14px 15px; min-width: 150px; text-align: center; }
.ve-r-lbl { font-family: 'JetBrains Mono', monospace; font-size: .52rem; letter-spacing: 2px; text-transform: uppercase; color: var(--tx3); display: block; margin-bottom: 10px; font-weight: 900; }
.ve-forms { display: flex; flex-direction: column; gap: 10px; }
.ve-form-tag { font-size: .52rem; color: var(--tx3); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 3px; font-weight: 900; }
.ve-form-val { font-family: 'JetBrains Mono', monospace; font-size: .9rem; font-weight: 900; color: var(--v1); }

/* Sentence */
.mode-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }

.mb {
  padding: 10px 18px;
  border: 1px solid var(--b2);
  border-radius: 999px;
  background: transparent;
  color: var(--tx2);
  font-weight: 900; font-size: .78rem; letter-spacing: .8px;
  text-transform: uppercase; min-height: 44px;
  transition: border-color .18s ease, color .18s ease, background .18s ease, box-shadow .18s ease;
}
.mb:hover { border-color: var(--b3); color: var(--tx); }

/* Sentence display ‚Äî border syncs with active mode */
.sent-disp.mode-af  { border-color: rgba(0,200,168,.40)  !important; background: linear-gradient(160deg, var(--s2) 0%, rgba(0,200,168,.05) 100%); }
.sent-disp.mode-neg { border-color: rgba(232,80,106,.40) !important; background: linear-gradient(160deg, var(--s2) 0%, rgba(232,80,106,.05) 100%); }
.sent-disp.mode-int { border-color: rgba(108,142,245,.40)!important; background: linear-gradient(160deg, var(--s2) 0%, rgba(108,142,245,.05) 100%); }
html.light .sent-disp.mode-af  { background: linear-gradient(160deg, #fff 0%, rgba(0,168,136,.06) 100%); }
html.light .sent-disp.mode-neg { background: linear-gradient(160deg, #fff 0%, rgba(200,51,78,.05) 100%); }
html.light .sent-disp.mode-int { background: linear-gradient(160deg, #fff 0%, rgba(61,94,204,.05) 100%); }

.sent-disp {
  background: linear-gradient(160deg, var(--s2) 0%, var(--s3) 100%);
  border: 2px solid var(--b2); border-radius: 18px;
  padding: 26px 22px; position: relative; overflow: hidden; margin-bottom: 10px;
}
html.light .sent-disp { background: linear-gradient(160deg, #fff 0%, #edf4fc 100%); }

/* Copy button */
.sent-copy-row { display: flex; justify-content: flex-end; margin-bottom: 8px; }
.sent-copy {
  font-family: 'JetBrains Mono', monospace; font-size: .62rem; letter-spacing: 1.5px;
  text-transform: uppercase; font-weight: 900;
  padding: 7px 13px; border-radius: 10px; border: 1px solid var(--b2);
  background: var(--s2); color: var(--tx3); cursor: pointer;
  display: flex; align-items: center; gap: 6px;
}
.sent-copy:hover { border-color: var(--teal); color: var(--teal2); background: var(--teal-a); }
.sent-copy.copied { background: var(--teal-a); border-color: var(--teal); color: var(--teal2); }

.sent-en { font-size: clamp(1.35rem,2.6vw,1.9rem); font-weight: 900; line-height: 1.25; color: var(--tx); text-align: center; }
.sent-es { margin-top: 12px; font-size: 1.05rem; color: var(--tx2); font-style: italic; line-height: 1.35; text-align: center; }
.sent-div { width: 34px; height: 2px; background: linear-gradient(to right, transparent, var(--b2), transparent); margin: 12px auto; }
.vw1 { color: var(--v1); font-weight: 900; }
.vw2 { color: var(--v2); font-weight: 900; }
.vw3 { color: var(--v3); font-weight: 900; }
.aux-hi { color: var(--teal2); font-weight: 900; }
.neg-hi { color: var(--past2); font-weight: 900; }
.adv-ins { color: var(--adv-es); font-weight: 800; font-style: normal; }
.tm-ins  { color: var(--tm-es);  font-weight: 800; font-style: normal; }
.sent-en em { color: var(--indigo); font-style: normal; font-weight: 800; }
.sent-es em { color: var(--indigo); font-style: italic; font-weight: 800; }
.sent-fml { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--b1); font-family: 'JetBrains Mono', monospace; font-size: .82rem; color: var(--tx2); text-align: center; line-height: 1.55; }
.sent-fml strong { color: var(--tx); font-weight: 900; letter-spacing: .4px; }
.warn { margin-top: 10px; padding: 12px 14px; border-radius: 14px; border: 1px solid rgba(240,154,26,.35); background: rgba(240,154,26,.10); color: var(--tx); font-size: .9rem; display: none; }
.warn strong { color: var(--fut2); }
.warn .line { display: block; margin-top: 4px; color: var(--tx2); font-size: .86rem; }
html.light .warn { border-color: rgba(200,114,0,.35); background: rgba(200,114,0,.08); }

/* Pronouns */
.pr-lbl { font-family: 'JetBrains Mono', monospace; font-size: .58rem; letter-spacing: 2.5px; text-transform: uppercase; color: var(--tx3); margin: 14px 0 10px; font-weight: 900; }
.pr-row { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
.pr {
  padding: 10px 14px;
  border: 1px solid var(--b2);
  border-radius: 12px;
  background: transparent;
  color: var(--tx2);
  font-family: 'JetBrains Mono', monospace; font-weight: 900; font-size: .86rem;
  min-height: 44px; min-width: 92px;
  transition: border-color .18s ease, color .18s ease, background .18s ease, box-shadow .18s ease;
}
.pr small { display: block; font-size: .62rem; letter-spacing: 1px; color: var(--tx3); font-weight: 900; margin-top: 2px; }
.pr:hover { border-color: var(--b3); color: var(--tx); }

/* Adverbs */
.adv-hdr { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; gap: 10px; flex-wrap: wrap; }
.adv-lbl { font-family: 'JetBrains Mono', monospace; font-size: .62rem; letter-spacing: 3px; text-transform: uppercase; color: var(--indigo); font-weight: 900; }
.adv-sub { font-size: .82rem; color: var(--tx3); font-style: italic; margin-bottom: 14px; }
.adv-clear { font-size: .78rem; color: var(--tx); cursor: pointer; background: transparent; border: 1px solid var(--b2); padding: 8px 12px; border-radius: 12px; font-weight: 900; }
.adv-clear:hover { border-color: var(--b3); background: var(--s2); }
.adv-cats { display: flex; flex-direction: column; gap: 12px; }
.adv-cat-lbl { font-family: 'JetBrains Mono', monospace; font-size: .56rem; letter-spacing: 2px; text-transform: uppercase; color: var(--tx3); font-weight: 900; margin-bottom: 6px; }
.adv-chips { display: flex; flex-wrap: wrap; gap: 8px; }
.adv-chip {
  padding: 9px 12px; border-radius: 999px; border: 1px solid rgba(108,142,245,.22);
  background: transparent; color: var(--tx); cursor: pointer;
  font-size: .82rem; font-family: 'JetBrains Mono', monospace; font-weight: 900;
  min-height: 44px; display: inline-flex; align-items: center; gap: 8px;
}
.adv-chip:hover { border-color: rgba(108,142,245,.55); background: var(--indigo-a); }
.adv-chip.on { background: var(--indigo-a); border-color: var(--indigo); color: var(--indigo); }
.adv-esp { font-size: .72rem; color: var(--tx3); font-style: italic; font-weight: 900; }
.adv-chip.on .adv-esp { color: rgba(108,142,245,.75); }
.adv-chip.dyn-chip { border-style: dashed; }
.adv-chip.dyn-chip::after { content: '‚Ä¶'; opacity: .5; margin-left: -4px; }

/* ‚îÄ‚îÄ TOAST NOTIFICATION ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: 28px; left: 50%; transform: translateX(-50%) translateY(20px);
  z-index: 99999999;
  background: var(--s1); border: 1px solid var(--b2); border-radius: 14px;
  padding: 12px 20px; box-shadow: 0 12px 36px rgba(0,0,0,.30);
  font-family: 'JetBrains Mono', monospace; font-size: .82rem; font-weight: 900; color: var(--tx);
  display: flex; align-items: center; gap: 10px;
  opacity: 0; pointer-events: none;
  transition: opacity .22s ease, transform .22s ease;
  white-space: nowrap;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.toast-ico { font-size: 1.1rem; }

/* ‚îÄ‚îÄ MODAL (reemplaza prompt()) ‚îÄ‚îÄ */
.modal-overlay {
  position: fixed; inset: 0; z-index: var(--modal-z);
  background: rgba(0,0,0,.64);
  backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
  display: flex; align-items: center; justify-content: center;
  padding: 16px;
  opacity: 0; pointer-events: none;
  transition: opacity .22s ease;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }

.modal-box {
  background: var(--s1); border: 1px solid var(--b2); border-radius: 22px;
  padding: 28px 26px; width: 100%; max-width: 440px;
  box-shadow: 0 24px 80px rgba(0,0,0,.45);
  transform: translateY(16px) scale(.97);
  transition: transform .25s cubic-bezier(.22,1,.36,1);
}
html.light .modal-box { box-shadow: 0 24px 80px rgba(0,0,0,.18); }
.modal-overlay.open .modal-box { transform: none; }

.modal-tag { font-family: 'JetBrains Mono', monospace; font-size: .58rem; letter-spacing: 3px; text-transform: uppercase; color: var(--indigo); font-weight: 900; margin-bottom: 10px; }
.modal-title { font-family: 'Fraunces', serif; font-size: 1.55rem; font-weight: 900; font-style: italic; color: var(--tx); margin-bottom: 6px; line-height: 1.15; }
.modal-desc { font-size: .88rem; color: var(--tx2); margin-bottom: 18px; line-height: 1.5; }
.modal-ex { font-family: 'JetBrains Mono', monospace; font-size: .75rem; color: var(--teal2); background: var(--teal-a); border: 1px solid rgba(0,200,168,.20); border-radius: 8px; padding: 7px 12px; margin-bottom: 18px; }
.modal-ex span { color: var(--tx3); }

.modal-in {
  width: 100%; padding: 13px 16px; border-radius: 12px;
  border: 2px solid var(--b2); background: var(--s2); color: var(--tx);
  font-size: 1rem; font-weight: 700; outline: none; margin-bottom: 16px;
}
.modal-in:focus { border-color: var(--indigo); box-shadow: 0 0 0 3px var(--indigo-a); }
.modal-in::placeholder { color: var(--tx3); font-weight: 600; }

.modal-btns { display: flex; gap: 10px; justify-content: flex-end; }
.modal-cancel { padding: 11px 18px; border-radius: 12px; border: 1px solid var(--b2); background: transparent; color: var(--tx2); font-weight: 900; font-size: .88rem; cursor: pointer; }
.modal-cancel:hover { background: var(--s2); color: var(--tx); }
.modal-ok { padding: 11px 22px; border-radius: 12px; border: none; background: var(--indigo); color: #fff; font-weight: 900; font-size: .88rem; cursor: pointer; box-shadow: 0 4px 18px rgba(108,142,245,.30); }
.modal-ok:hover { background: #5070dd; transform: translateY(-1px); }
.modal-ok:disabled { opacity: .4; cursor: not-allowed; transform: none; }

/* Keyboard hint bar */
.kb-hint {
  display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
  padding: 8px 0; margin-top: 4px;
  font-size: .72rem; color: var(--tx3);
}
.kb-hint kbd {
  font-family: 'JetBrains Mono', monospace; font-size: .62rem; font-weight: 900;
  background: var(--s3); border: 1px solid var(--b2); border-radius: 5px;
  padding: 2px 7px; color: var(--tx2);
}

/* Responsive */
@media(max-width: 720px) {
  .ve-grid { grid-template-columns: 1fr; }
  .ve-right { display: none; }
  .uso-cards { grid-template-columns: 1fr; }
  .pr { min-width: 48%; }
}
@media(max-width: 420px) {
  .pr { min-width: 100%; }
  .mb { width: 100%; }
}
@media (prefers-reduced-motion: reduce) {
  .card:hover { transform: none; }
}

/* ‚îÄ‚îÄ FOOTER TIMELINE ‚îÄ‚îÄ */
.site-footer {
  position: relative; z-index: 1;
  background: rgba(8,15,26,.92);
  border-top: 1px solid var(--b1);
  backdrop-filter: blur(10px);
  padding: 48px 20px 36px;
  margin-top: 40px;
}
html.light .site-footer { background: rgba(242,247,253,.96); }

.footer-title {
  text-align: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: .62rem; letter-spacing: 3.5px; text-transform: uppercase;
  color: var(--tx3); font-weight: 900; margin-bottom: 36px;
}
.footer-title span { color: var(--teal); }

/* Footer timeline ‚Äî wider, non-sticky */
.ftl-outer {
  max-width: 1060px; margin: 0 auto;
  position: relative; padding: 50px 14px 54px;
  overflow-x: auto;
}
.ftl-track {
  position: relative; height: 4px; min-width: 780px; border-radius: 2px;
  background: linear-gradient(to right,
    rgba(232,80,106,.25) 0%,   rgba(232,80,106,.25) 36%,
    rgba(0,200,168,.25) 36%,   rgba(0,200,168,.25) 64%,
    rgba(240,154,26,.25) 64%,  rgba(240,154,26,.25) 100%);
}
.ftl-zlb {
  position: absolute; top: -34px;
  font-family: 'JetBrains Mono', monospace; font-size: .55rem;
  letter-spacing: 2.5px; text-transform: uppercase; font-weight: 800;
  padding: 3px 10px; border-radius: 16px;
}
.ftl-zlb.zp { left: 5%;  color: var(--past2); background: var(--past-a); border: 1px solid rgba(232,80,106,.26); }
.ftl-zlb.zn { left: 39%; color: var(--pres2); background: var(--pres-a); border: 1px solid rgba(0,200,168,.26); }
.ftl-zlb.zf { left: 67%; color: var(--fut2);  background: var(--fut-a);  border: 1px solid rgba(240,154,26,.26); }

/* Footer timeline now marker */
.ftl-now { position: absolute; left: 44.5%; top: 50%; transform: translate(-50%,-50%); z-index: 4; pointer-events: none; }
.ftl-now-line { width: 2px; height: 58px; background: linear-gradient(to bottom,transparent,var(--teal2),transparent); margin: 0 auto; position: relative; top: -28px; }
.ftl-now-dot  { width: 8px; height: 8px; border-radius: 50%; background: var(--teal2); position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); animation: heartbeat 2.4s ease-in-out infinite; }
.ftl-now-lbl  { position: absolute; top: -38px; left: 50%; transform: translateX(-50%); font-family: 'JetBrains Mono', monospace; font-size: .52rem; letter-spacing: 3px; color: var(--teal2); white-space: nowrap; }

/* Footer timeline nodes */
.ftn {
  position: absolute; top: 50%; transform: translate(-50%,-50%);
  z-index: 3; cursor: pointer; outline: none; background: none; border: none; padding: 0;
}
.ftn .fdot {
  width: 14px; height: 14px; border-radius: 50%;
  background: currentColor; border: 2px solid rgba(8,15,26,.85);
  transition: transform .18s ease, box-shadow .18s ease;
  margin: 0 auto;
}
html.light .ftn .fdot { border-color: rgba(240,246,255,.92); }
.ftn:hover .fdot { transform: scale(1.9); box-shadow: 0 0 14px currentColor; }
.ftn:focus-visible .fdot { box-shadow: 0 0 0 3px rgba(108,142,245,.55); }
.ftn .ftlbl {
  position: absolute; white-space: nowrap;
  font-size: .60rem; font-weight: 800; color: var(--tx3);
  width: 118px; text-align: center;
  left: 50%; transform: translateX(-50%);
  pointer-events: none; line-height: 1.3;
}
.ftn .ftlbl.u { bottom: 22px; }
.ftn .ftlbl.d { top: 22px; }
.ftn:hover .ftlbl { color: var(--tx2); }
.ftn .fclick-hint {
  position: absolute; bottom: -18px; left: 50%; transform: translateX(-50%);
  font-size: .48rem; letter-spacing: 1.5px; text-transform: uppercase;
  color: var(--tx3); opacity: 0; white-space: nowrap; pointer-events: none;
  transition: opacity .18s;
}
.ftn .ftlbl.d ~ .fclick-hint { bottom: auto; top: -18px; }
.ftn:hover .fclick-hint { opacity: .7; }

/* Footer legend */
.footer-legend {
  display: flex; justify-content: center; gap: 22px; flex-wrap: wrap;
  margin-top: 8px; padding-top: 16px; border-top: 1px solid var(--b0);
}
.fl-item {
  display: flex; align-items: center; gap: 7px;
  font-family: 'JetBrains Mono', monospace; font-size: .60rem;
  letter-spacing: 1px; text-transform: uppercase; color: var(--tx3);
}
.fl-dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }

/* ‚îÄ‚îÄ TENSE MODAL (educativo) ‚îÄ‚îÄ */
.tm-overlay {
  position: fixed; inset: 0; z-index: 200000;
  background: rgba(4,9,18,.82);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  display: flex; align-items: center; justify-content: center;
  padding: 16px;
  opacity: 0; pointer-events: none;
  transition: opacity .25s ease;
}
.tm-overlay.open { opacity: 1; pointer-events: all; }

.tm-box {
  background: var(--s1); border: 1px solid var(--b2);
  border-radius: 24px; padding: 28px 26px;
  max-width: 620px; width: 100%;
  max-height: 88vh; overflow-y: auto;
  box-shadow: 0 32px 80px rgba(0,0,0,.45);
  transform: translateY(20px) scale(.97);
  transition: transform .28s cubic-bezier(.22,1,.36,1), opacity .25s ease;
  position: relative;
}
.tm-overlay.open .tm-box { transform: none; }

.tm-close {
  position: absolute; top: 16px; right: 16px;
  width: 34px; height: 34px; border-radius: 10px;
  border: 1px solid var(--b2); background: var(--s2); color: var(--tx2);
  font-size: 1.1rem; display: grid; place-items: center; cursor: pointer;
}
.tm-close:hover { background: var(--past-a); border-color: var(--past); color: var(--past2); }

.tm-zone-badge {
  display: inline-block; font-family: 'JetBrains Mono', monospace;
  font-size: .55rem; letter-spacing: 2.5px; text-transform: uppercase;
  font-weight: 900; padding: 4px 12px; border-radius: 99px; margin-bottom: 10px;
}
.tm-title {
  font-family: 'Fraunces', serif; font-size: 1.9rem;
  font-weight: 900; font-style: italic; margin-bottom: 4px;
}
.tm-formula {
  font-family: 'JetBrains Mono', monospace; font-size: .84rem;
  padding: 10px 14px; border-radius: 11px; margin-bottom: 18px;
  background: var(--bg); border: 1px solid var(--b2); color: var(--teal2);
  display: inline-block;
}
.tm-section-lbl {
  font-family: 'JetBrains Mono', monospace; font-size: .55rem;
  letter-spacing: 2.5px; text-transform: uppercase; color: var(--tx3);
  font-weight: 900; margin-bottom: 10px;
}
.tm-uso-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(170px,1fr)); gap: 10px; margin-bottom: 18px; }
.tm-uso-card {
  background: var(--s2); border: 1px solid var(--b1);
  border-radius: 14px; padding: 13px 12px;
}
.tm-uso-ico  { font-size: 1.2rem; margin-bottom: 5px; }
.tm-uso-ti   { font-size: .88rem; font-weight: 900; color: var(--tx); margin-bottom: 3px; }
.tm-uso-desc { font-size: .78rem; color: var(--tx2); line-height: 1.5; margin-bottom: 7px; }
.tm-uso-en   { font-family: 'JetBrains Mono', monospace; font-size: .70rem; color: var(--teal2); margin-bottom: 2px; }
.tm-uso-es   { font-size: .72rem; color: var(--tx3); font-style: italic; }

.tm-struct {
  display: flex; flex-direction: column; gap: 8px; margin-bottom: 18px;
}
.tm-struct-row {
  background: var(--s2); border: 1px solid var(--b1);
  border-radius: 12px; padding: 12px 14px;
}
.tm-struct-mode {
  font-family: 'JetBrains Mono', monospace; font-size: .52rem;
  letter-spacing: 2px; text-transform: uppercase; color: var(--tx3);
  font-weight: 900; margin-bottom: 8px;
}
.tm-chips { display: flex; gap: 6px; flex-wrap: wrap; align-items: center; margin-bottom: 6px; }
.tm-chip {
  display: inline-flex; align-items: center; padding: 4px 10px;
  border-radius: 8px; font-family: 'JetBrains Mono', monospace;
  font-size: .70rem; font-weight: 900;
}
.tm-chip.ch-subj { background: rgba(0,200,168,.12); color: var(--teal2); border: 1px solid rgba(0,200,168,.30); }
.tm-chip.ch-aux  { background: var(--violet-a); color: #d7c3ff; border: 1px solid rgba(168,127,240,.34); }
.tm-chip.ch-neg  { background: var(--past-a); color: var(--past2); border: 1px solid rgba(232,80,106,.34); }
.tm-chip.ch-verb { background: rgba(108,142,245,.12); color: var(--indigo); border: 1px solid rgba(108,142,245,.34); }
.tm-chip.ch-obj  { background: rgba(255,255,255,.04); color: var(--tx2); border: 1px solid var(--b1); }
.tm-chip.ch-arr  { color: var(--tx3); font-size: .9rem; padding: 0 2px; background: none; border: none; }
.tm-struct-note  { font-size: .76rem; color: var(--tx2); font-style: italic; line-height: 1.5; }

.tm-adv-list {
  display: flex; flex-wrap: wrap; gap: 7px; margin-bottom: 18px;
}
.tm-adv-chip {
  padding: 5px 11px; border-radius: 999px;
  background: var(--indigo-a); border: 1px solid rgba(108,142,245,.22);
  color: var(--tx2); font-size: .76rem; font-weight: 700;
}

.tm-cta {
  display: flex; align-items: center; justify-content: center; gap: 12px; flex-wrap: wrap;
  padding-top: 14px; border-top: 1px solid var(--b1);
}
.tm-btn-go {
  padding: 11px 22px; border-radius: 999px; border: none;
  font-weight: 900; font-size: .82rem; letter-spacing: .4px;
  cursor: pointer; transition: transform .16s, box-shadow .16s;
}
.tm-btn-go:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,.22); }
.tm-btn-close2 {
  padding: 11px 22px; border-radius: 999px;
  border: 1px solid var(--b2); background: transparent;
  color: var(--tx2); font-weight: 900; font-size: .82rem;
  cursor: pointer;
}
.tm-btn-close2:hover { border-color: var(--b3); color: var(--tx); background: var(--s2); }

/* Extra: Present Simple full guide (embedded) */
.tm-extra{ margin-top:16px; padding-top:16px; border-top:1px dashed var(--b1); display:none; }
.tm-extra-title{ font-family:'JetBrains Mono', monospace; font-size:.62rem; letter-spacing:2px; text-transform:uppercase; color:var(--tx3); font-weight:900; margin-bottom:8px; }
.tm-extra-sub{ font-size:.82rem; color:var(--tx2); margin-bottom:12px; line-height:1.45; }
.tm-extra-iframe{ width:100%; height:min(78vh, 820px); border:1px solid var(--b1); background:#0b0f1a; border-radius:16px; overflow:hidden; }
@media (max-width:520px){ .tm-extra-iframe{ height:78vh; } }

</style>
</head>
<body>

<!-- TOP BAR -->
<div id="topBar" class="topbar" aria-label="Barra fija de estado">
  <div id="tenseInfo" class="topbar-info" role="status" aria-live="polite"></div>
  <div class="topbar-actions" aria-label="Controles de accesibilidad">
    <a class="tbtn" href="neuroverbs.html" aria-label="Ir a Neuroverbs" title="Inicio">üè†</a>
    <button class="tbtn" id="btnTheme" onclick="toggleTheme()" aria-label="Cambiar tema" title="Tema claro/oscuro">üåì</button>
    <button class="tbtn" id="btnBig" onclick="toggleBigText()" aria-pressed="false" aria-label="Texto grande" title="Texto grande"><small>A+</small></button>
    <button class="tbtn" id="btnHC" onclick="toggleHighContrast()" aria-pressed="false" aria-label="Alto contraste" title="Alto contraste">‚óê</button>
  </div>
</div>

<!-- MODAL para adverbios din√°micos (reemplaza prompt()) -->
<div id="modalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-box">
    <div class="modal-tag" id="modalTag">Adverbio din√°mico</div>
    <div class="modal-title" id="modalTitle">Completa el marcador</div>
    <div class="modal-desc" id="modalDesc">Escribe el complemento de tiempo:</div>
    <div class="modal-ex" id="modalEx"><span>Ejemplo:</span> <span id="modalExText"></span></div>
    <input id="modalIn" class="modal-in" type="text" placeholder="" autocomplete="off" spellcheck="false" />
    <div class="modal-btns">
      <button class="modal-cancel" onclick="modalClose(false)">Cancelar</button>
      <button id="modalOk" class="modal-ok" onclick="modalClose(true)">A√±adir ‚úì</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast" role="status" aria-live="polite">
  <span class="toast-ico" id="toastIco">‚úì</span>
  <span id="toastMsg"></span>
</div>

<div class="wrap">

<!-- 1. HEADER -->
<div class="hdr a0" id="top">
  <div class="hdr-tag">Neuroverbs ¬∑ 12 tiempos verbales ¬∑ Motor de conjugaci√≥n v8.0</div>
  <h1>Neuroverbs</h1>
  <p>Explora los tiempos verbales en una l√≠nea de tiempo, mira cu√°ndo se usan, su estructura, conjuga verbos y genera oraciones con adverbios.</p>

  <div class="hdr-hash" role="button" tabindex="0" aria-label="Copiar enlace a este tiempo"
       onclick="copyShareLink()"
       onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();copyShareLink();}">
    <span>üîó</span> <span id="shareLinkTxt">Copiar enlace a este tiempo</span>
  </div>

</div>

<!-- 2. TIMELINE STICKY -->
<div class="tl-wrap a1" aria-label="L√≠nea de tiempo de tiempos verbales">
  <span class="zlb zp">Pasado</span>
  <span class="zlb zn">Presente</span>
  <span class="zlb zf">Futuro</span>

  <div class="tl-track" role="group" aria-label="Selector de tiempo verbal">
    <div class="now-mk" aria-hidden="true">
      <div class="now-line"></div>
      <div class="now-dot"></div>
      <div class="now-lbl">AHORA</div>
    </div>

    <div id="nd-ppc"  class="tn" style="left:4%;color:var(--past);"    onclick="selT(event,'ppc')" ><div class="dot"></div><span class="tlbl u">Past Perf. Cont.</span></div>
    <div id="nd-pp"   class="tn" style="left:12%;color:var(--past);"   onclick="selT(event,'pp')"  ><div class="dot"></div><span class="tlbl d">Past Perfect</span></div>
    <div id="nd-pc"   class="tn" style="left:21%;color:var(--past);"   onclick="selT(event,'pc')"  ><div class="dot"></div><span class="tlbl u">Past Continuous</span></div>
    <div id="nd-ps"   class="tn" style="left:31%;color:var(--past);"   onclick="selT(event,'ps')"  ><div class="dot"></div><span class="tlbl d">Past Simple</span></div>
    <div id="nd-prc"  class="tn" style="left:47%;color:var(--pres);"   onclick="selT(event,'prc')" ><div class="dot"></div><span class="tlbl u">Pres. Continuous</span></div>
    <div id="nd-prs"  class="tn" style="left:52.5%;color:var(--pres);" onclick="selT(event,'prs')" ><div class="dot"></div><span class="tlbl d">Pres. Simple</span></div>
    <div id="nd-prp"  class="tn" style="left:58%;color:var(--pres);"   onclick="selT(event,'prp')" ><div class="dot"></div><span class="tlbl u">Pres. Perfect</span></div>
    <div id="nd-prpc" class="tn" style="left:64%;color:var(--pres);"   onclick="selT(event,'prpc')"><div class="dot"></div><span class="tlbl d">Pres. Perf. Cont.</span></div>
    <div id="nd-fs"   class="tn" style="left:71%;color:var(--fut);"    onclick="selT(event,'fs')"  ><div class="dot"></div><span class="tlbl u">Future Simple</span></div>
    <div id="nd-fc"   class="tn" style="left:78%;color:var(--fut);"    onclick="selT(event,'fc')"  ><div class="dot"></div><span class="tlbl d">Future Continuous</span></div>
    <div id="nd-fp"   class="tn" style="left:85%;color:var(--fut);"    onclick="selT(event,'fp')"  ><div class="dot"></div><span class="tlbl u">Future Perfect</span></div>
    <div id="nd-fpc"  class="tn" style="left:92%;color:var(--fut);"    onclick="selT(event,'fpc')" ><div class="dot"></div><span class="tlbl d">Fut. Perf. Cont.</span></div>
  </div>
</div>

<!-- 3. CUANDO SE USA -->
<div id="usoCard" class="card a2">
  <div class="tense-hdr">
    <div id="tName" class="t-name"></div>
    <div id="tZone" class="t-zone"></div>
  </div>
  <div class="card-lbl" id="usoLbl">
    <span>üí°</span>
    <span id="usoLblTxt"></span>
    <span style="font-family:'DM Sans',sans-serif;font-style:italic;font-size:.85rem;color:var(--tx3);text-transform:none;letter-spacing:0;font-weight:700;">explicado de forma sencilla</span>
  </div>
  <div id="usoCards" class="uso-cards"></div>
</div>

<!-- 4. ESTRUCTURA -->
<div id="structCard" class="card a3">
  <div class="card-lbl" style="color:var(--violet);"><span>‚¨°</span><span>Estructura gramatical ¬∑ auxiliares</span></div>
  <div id="fmlBox" class="fml-box"><span class="fml-lbl">F√≥rmula</span></div>
  <div id="auxModes" class="aux-modes"></div>
</div>

<!-- 5. MOTOR DE CONJUGACI√ìN -->
<div class="card a4">
  <div class="ve-grid">
    <div class="ve-left">
      <div class="ve-lbl-row">
        <div class="ve-main-lbl">Motor de conjugaci√≥n ¬∑ V1 / V2 / V3</div>
</div>
      <div class="srch-wrap">
        <span class="srch-ico" aria-hidden="true">‚åï</span>
        <input id="vIn" class="srch-in" type="text"
          placeholder="Escribe un verbo: play, run, eat, write, go, make, sleep..."
          oninput="procVerb(); showAC()"
          onkeydown="handleACKey(event)"
          onfocus="showAC()"
          autocomplete="off" spellcheck="false"
          aria-label="Escribe un verbo en ingl√©s" aria-autocomplete="list" aria-controls="acDrop" />
        <button id="srchClear" class="srch-clear" onclick="clearVerbInput()" aria-label="Limpiar">‚úï</button>
        <div id="acDrop" class="ac-drop" role="listbox" aria-label="Sugerencias de verbos"></div>
      </div>
      <div class="v3-grid" aria-label="Formas del verbo">
        <div class="vc">
          <span class="vc-lbl">V1 ¬∑ Base</span>
          <span id="v1" class="vc-form">play</span>
          <span id="vEsp" class="vc-esp">jugar</span>
          <div class="vtype-wrap"><span id="vType" class="vtype reg">Regular</span></div>
        </div>
        <div class="vc">
          <span class="vc-lbl">V2 ¬∑ Past Simple</span>
          <span id="v2" class="vc-form">played</span>
        </div>
        <div class="vc">
          <span class="vc-lbl">V3 ¬∑ Past Participle</span>
          <span id="v3" class="vc-form">played</span>
        </div>
      </div>
    </div>
    <div class="ve-right" aria-label="Formas derivadas">
      <span class="ve-r-lbl">Formas derivadas</span>
      <div class="ve-forms">
        <div><div class="ve-form-tag">V-ing</div><div id="vVing" class="ve-form-val">playing</div></div>
        <div><div class="ve-form-tag">3¬™ sg</div><div id="vV1s"  class="ve-form-val">plays</div></div>
      </div>
    </div>
  </div>
</div>

<!-- 6. ORACI√ìN DE EJEMPLO -->
<div id="sentCard" class="card a5">
  <div class="card-lbl" style="color:var(--teal);"><span>‚óé</span><span>Oraci√≥n de ejemplo</span></div>
  <div class="mode-row" role="group" aria-label="Modo de oraci√≥n">
    <button id="bt-af"  class="mb active" onclick="setM('af')"  aria-pressed="true">Afirmativa (+)</button>
    <button id="bt-neg" class="mb"        onclick="setM('neg')" aria-pressed="false">Negativa (‚àí)</button>
    <button id="bt-int" class="mb"        onclick="setM('int')" aria-pressed="false">Pregunta (?)</button>
  </div>

  <div id="sentDisp" class="sent-disp" aria-label="Oraci√≥n en ingl√©s y su traducci√≥n">
    <div class="sent-copy-row">
      <button class="sent-copy" id="copyBtn" onclick="copySentence()" title="Copiar oraci√≥n al portapapeles">
        üìã Copiar
      </button>
    </div>
    <div id="sentEn" class="sent-en"></div>
    <div class="sent-div" aria-hidden="true"></div>
    <div id="sentEs" class="sent-es"></div>
    <div id="sentFml" class="sent-fml" aria-label="Estructura gramatical"></div>
    <div id="advWarn" class="warn" role="status" aria-live="polite"></div>
  </div>

  <div class="pr-lbl">Pronombre ‚Äî la oraci√≥n se actualiza al instante</div>
  <div class="pr-row" role="group" aria-label="Selector de pronombre">
    <button id="p-I"      class="pr"         onclick="setP('I')"      aria-pressed="false">I</button>
    <button id="p-You_s"  class="pr"        onclick="setP('You_s')"  aria-pressed="false">You <small>(sing.)</small></button>
    <button id="p-He"     class="pr"        onclick="setP('He')"     aria-pressed="false">He</button>
    <button id="p-She"    class="pr"        onclick="setP('She')"    aria-pressed="false">She</button>
    <button id="p-It"     class="pr"        onclick="setP('It')"     aria-pressed="false">It</button>
    <button id="p-You_p"  class="pr"        onclick="setP('You_p')"  aria-pressed="false">You <small>(pl.)</small></button>
    <button id="p-We"     class="pr"        onclick="setP('We')"     aria-pressed="false">We</button>
    <button id="p-They"   class="pr"        onclick="setP('They')"   aria-pressed="false">They</button>
  </div>
</div>

<!-- 7. ADVERBIOS -->
<div class="card a6">
  <div class="adv-hdr">
    <div class="adv-lbl">‚óà Adverbios y marcadores de tiempo</div>
    <button class="adv-clear" onclick="clearAdv()">Limpiar selecci√≥n</button>
  </div>
  <div class="adv-sub">Haz clic para a√±adirlos a la oraci√≥n. Los marcadores con <strong>‚Ä¶</strong> piden un complemento (sin popup del navegador).</div>
  <div id="advCats" class="adv-cats"></div>
</div>

</div><!-- /wrap -->

<!-- ‚ïê‚ïê TENSE INFO MODAL (footer timeline) ‚ïê‚ïê -->
<div id="tmOverlay" class="tm-overlay" role="dialog" aria-modal="true" aria-labelledby="tmTitle" onclick="if(event.target===this)closeTenseModal()">
  <div class="tm-box" id="tmBox">
    <button class="tm-close" onclick="closeTenseModal()" aria-label="Cerrar">‚úï</button>
    <div id="tmZone" class="tm-zone-badge"></div>
    <div id="tmTitle" class="tm-title"></div>
    <div id="tmFormula" class="tm-formula"></div>

    <div class="tm-section-lbl">‚óé Cu√°ndo se usa</div>
    <div id="tmUso" class="tm-uso-grid"></div>

    <div class="tm-section-lbl">‚¨° Estructura (Afirmativa ¬∑ Negativa ¬∑ Pregunta)</div>
    <div id="tmStruct" class="tm-struct"></div>

    <div class="tm-section-lbl">‚óà Adverbios t√≠picos</div>
    <div id="tmAdv" class="tm-adv-list"></div>

    <div class="tm-cta">
      <button id="tmBtnGo" class="tm-btn-go" onclick="closeTenseModal()">
        Explorar este tiempo ‚Üí
      </button>
      <button class="tm-btn-close2" onclick="closeTenseModal()">Cerrar</button>
    </div>

    
    <!-- Extra: Gu√≠a extendida (se carga en iframe dentro del modal) -->
    <div id="tmExtra" class="tm-extra" aria-label="Gu√≠a extendida del tiempo verbal">
      <div id="tmExtraTitle" class="tm-extra-title">üìò Gu√≠a extendida</div>
      <div id="tmExtraSub" class="tm-extra-sub">Resumen ampliado con ejemplos y tips.</div>
      <iframe id="tmExtraIfr" class="tm-extra-iframe" title="Gu√≠a extendida" loading="lazy"></iframe>
    </div>
</div>
</div>

<!-- ‚ïê‚ïê FOOTER CON TIMELINE EDUCATIVA ‚ïê‚ïê -->
<footer class="site-footer" aria-label="L√≠nea de tiempo educativa de tiempos verbales">
  <div class="footer-title">
    <span>‚óâ</span> Mapa de los 12 tiempos verbales ¬∑ haz clic en cada punto para aprender
  </div>

  <div class="ftl-outer">
    <!-- Zone labels -->
    <span class="ftl-zlb zp">Pasado</span>
    <span class="ftl-zlb zn">Presente</span>
    <span class="ftl-zlb zf">Futuro</span>

    <div class="ftl-track" role="group" aria-label="Mapa de tiempos verbales">
      <!-- Now marker -->
      <div class="ftl-now" aria-hidden="true">
        <div class="ftl-now-line"></div>
        <div class="ftl-now-dot"></div>
        <div class="ftl-now-lbl">AHORA</div>
      </div>

      <!-- Pasado -->
      <button class="ftn" style="left:4%;color:var(--past);"   onclick="openTenseModal('ppc')"  aria-label="Past Perfect Continuous ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl u">Past Perf. Cont.</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
      <button class="ftn" style="left:12%;color:var(--past);"  onclick="openTenseModal('pp')"   aria-label="Past Perfect ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl d">Past Perfect</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
      <button class="ftn" style="left:21%;color:var(--past);"  onclick="openTenseModal('pc')"   aria-label="Past Continuous ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl u">Past Continuous</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
      <button class="ftn" style="left:31%;color:var(--past);"  onclick="openTenseModal('ps')"   aria-label="Past Simple ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl d">Past Simple</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>

      <!-- Presente -->
      <button class="ftn" style="left:47%;color:var(--pres);"  onclick="openTenseModal('prc')"  aria-label="Present Continuous ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl u">Pres. Continuous</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
      <button class="ftn" style="left:52.5%;color:var(--pres);" onclick="openTenseModal('prs')" aria-label="Present Simple ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl d">Pres. Simple</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
      <button class="ftn" style="left:58%;color:var(--pres);"  onclick="openTenseModal('prp')"  aria-label="Present Perfect ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl u">Pres. Perfect</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
      <button class="ftn" style="left:64%;color:var(--pres);"  onclick="openTenseModal('prpc')" aria-label="Present Perfect Continuous ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl d">Pres. Perf. Cont.</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>

      <!-- Futuro -->
      <button class="ftn" style="left:71%;color:var(--fut);"   onclick="openTenseModal('fs')"   aria-label="Future Simple ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl u">Future Simple</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
      <button class="ftn" style="left:78%;color:var(--fut);"   onclick="openTenseModal('fc')"   aria-label="Future Continuous ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl d">Future Continuous</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
      <button class="ftn" style="left:85%;color:var(--fut);"   onclick="openTenseModal('fp')"   aria-label="Future Perfect ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl u">Future Perfect</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
      <button class="ftn" style="left:92%;color:var(--fut);"   onclick="openTenseModal('fpc')"  aria-label="Future Perfect Continuous ‚Äî clic para aprender">
        <div class="fdot"></div>
        <span class="ftlbl d">Fut. Perf. Cont.</span>
        <span class="fclick-hint">ver ‚Üí</span>
      </button>
    </div>
  </div>

  <div class="footer-legend">
    <div class="fl-item"><div class="fl-dot" style="background:var(--past2);"></div>Pasado</div>
    <div class="fl-item"><div class="fl-dot" style="background:var(--pres2);"></div>Presente</div>
    <div class="fl-item"><div class="fl-dot" style="background:var(--fut2);"></div>Futuro</div>
    <div class="fl-item" style="color:var(--tx3); font-style:italic;">Neuroverbs v8.0 ¬∑ Motor de conjugaci√≥n</div>
  </div>
</footer>


<!-- Template embebido para Present Simple (se carga en iframe dentro del modal) -->
<template id="prsAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Present Simple: La Gu√≠a Definitiva</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1; --secondary: #a855f7; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #22d3ee;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(99, 102, 241, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--secondary); margin: 25px 0 10px 0; font-size: 1.3rem; }
        p { margin-bottom: 15px; color: #cbd5e1; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--accent); font-family: 'Courier New', monospace; font-size: 1rem; color: #a5f3fc; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning); padding: 15px; margin: 20px 0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: left; }
        th { background: var(--primary); }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(99, 102, 241, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Present Simple</h1>
        <p>Tutorial Integral para Hispanohablantes</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/PHi80Uu1zYw" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'respuestas')">2. Respuestas</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">3. Uso</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">4. Adverbios</button>
        <button class="tab-btn" onclick="openTab(event, 'ortografia')">5. Ortograf√≠a</button>
        <button class="tab-btn" onclick="openTab(event, 'preguntas')">6. WH- Questions</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">7. Resumen</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura Gramatical</h2>
            <p>El Presente Simple se compone de tres formas b√°sicas:</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + Verbo. Si el sujeto es 3¬™ persona (He, She, It), a√±adimos <b>-s</b> o <b>-es</b>.</li>
                <li><b>Negativa:</b> Sujeto + Auxiliar (<b>don't / doesn't</b>) + Verbo en forma base (sin -s).</li>
                <li><b>Interrogativa:</b> Auxiliar (<b>Do / Does</b>) + Sujeto + Verbo en forma base.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">I <b>speak</b> English every day.<span class="trans">Yo hablo ingl√©s todos los d√≠as.</span></div>
                <div class="example-item">He <b>speaks</b> English very well.<span class="trans">√âl habla ingl√©s muy bien (Afirmativa 3¬™ persona).</span></div>
                <div class="example-item">We <b>don't</b> live in Madrid.<span class="trans">Nosotros no vivimos en Madrid (Negativa).</span></div>
                <div class="example-item">She <b>doesn't</b> want a coffee.<span class="trans">Ella no quiere un caf√© (Negativa 3¬™ persona).</span></div>
                <div class="example-item"><b>Do</b> you go to the gym?<span class="trans">¬øVas t√∫ al gimnasio? (Interrogativa).</span></div>
            </div>
        </div>
    </section>

    <section id="respuestas" class="content-section">
        <div class="card">
            <h2>Short Answers (Respuestas Cortas)</h2>
            <p>En ingl√©s, para responder a preguntas de "S√≠ o No", repetimos el auxiliar utilizado en la pregunta. No es natural decir solo "Yes" o "No".</p>
            <div class="example-list">
                <h3>Ejemplos de Respuestas:</h3>
                <div class="example-item">Do you study? - <b>Yes, I do.</b><span class="trans">¬øEstudias? - S√≠.</span></div>
                <div class="example-item">Does he play? - <b>No, he doesn't.</b><span class="trans">¬ø√âl juega? - No.</span></div>
                <div class="example-item">Do they help you? - <b>No, they don't.</b><span class="trans">¬øEllos te ayudan? - No.</span></div>
                <div class="example-item">Does it work? - <b>Yes, it does.</b><span class="trans">¬øFunciona? - S√≠.</span></div>
                <div class="example-item">Do we have a test? - <b>Yes, we do.</b><span class="trans">¬øTenemos un examen? - S√≠.</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>¬øCu√°ndo se usa?</h2>
            <p>El uso principal son las <b>acciones habituales</b>. No se usa para acciones que ocurren en este preciso instante (eso es Presente Continuo), sino para rutinas y hechos permanentes.</p>
            <div class="example-list">
                <h3>Ejemplos de Uso:</h3>
                <div class="example-item">I <b>get up</b> at 8 o'clock.<span class="trans">Me levanto a las 8 (Rutina).</span></div>
                <div class="example-item">Water <b>boils</b> at 100 degrees.<span class="trans">El agua hierve a 100 grados (Verdad universal).</span></div>
                <div class="example-item">She <b>works</b> in a hospital.<span class="trans">Ella trabaja en un hospital (Estado permanente).</span></div>
                <div class="example-item">They <b>travel</b> every summer.<span class="trans">Ellos viajan cada verano (H√°bito).</span></div>
                <div class="example-item">The train <b>leaves</b> at nine.<span class="trans">El tren sale a las nueve (Horario fijo).</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>Adverbios y Frecuencia (Completo)</h2>
            <h3>1. Adverbios de Frecuencia</h3>
            <p>Indican qu√© tan seguido hacemos algo. <b>Regla de oro:</b> Se colocan delante del verbo principal (pero despu√©s del verbo To Be).</p>
            <table>
                <tr><th>Adverbio</th><th>Significado</th></tr>
                <tr><td>Always</td><td>Siempre</td></tr>
                <tr><td>Usually / Normally</td><td>Normalmente</td></tr>
                <tr><td>Often</td><td>A menudo</td></tr>
                <tr><td>Sometimes</td><td>A veces</td></tr>
                <tr><td>Hardly ever / Rarely</td><td>Casi nunca</td></tr>
                <tr><td>Never</td><td>Nunca</td></tr>
            </table>

            <h3>2. Expresiones Temporales</h3>
            <p>Se suelen colocar al final de la frase.</p>
            <ul>
                <li><b>Every...:</b> Every day, Every week (Sin 's' al final).</li>
                <li><b>Once a... / Twice a...:</b> Una vez a / Dos veces a.</li>
                <li><b>Three times a...:</b> Tres veces a.</li>
            </ul>

            <div class="example-list">
                <h3>Ejemplos de Frecuencia:</h3>
                <div class="example-item">1. We <b>often</b> go to the beach.<span class="trans">A menudo vamos a la playa.</span></div>
                <div class="example-item">2. I <b>never</b> eat meat.<span class="trans">Nunca como carne.</span></div>
                <div class="example-item">3. He <b>usually</b> studies at night.<span class="trans">√âl normalmente estudia de noche.</span></div>
                <div class="example-item">4. She visits her aunt <b>twice a week</b>.<span class="trans">Ella visita a su t√≠a dos veces por semana.</span></div>
                <div class="example-item">5. We play tennis <b>every Saturday</b>.<span class="trans">Jugamos al tenis todos los s√°bados.</span></div>
            </div>
            <div class="note"><b>Nota:</b> "Sometimes" es flexible y puede ir tambi√©n al principio: <i>Sometimes we go out.</i></div>
        </div>
    </section>

    <section id="ortografia" class="content-section">
        <div class="card">
            <h2>Reglas de la 3¬™ Persona (Ortograf√≠a)</h2>
            <p>Cuando usamos He, She o It en afirmativa, el verbo cambia seg√∫n su terminaci√≥n:</p>
            <ul>
                <li>Si termina en <b>-s, -sh, -ch, -x, -o</b>: A√±adimos <b>-es</b>.</li>
                <li>Si termina en <b>Consonante + Y</b>: Cambiamos 'y' por <b>-ies</b>.</li>
                <li>Dem√°s casos: Solo a√±adimos <b>-s</b>.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Ortograf√≠a:</h3>
                <div class="example-item">1. She <b>watches</b> TV.<span class="trans">Ella ve la tele (Termina en -ch).</span></div>
                <div class="example-item">2. He <b>goes</b> to school.<span class="trans">√âl va al colegio (Termina en -o).</span></div>
                <div class="example-item">3. The baby <b>cries</b> a lot.<span class="trans">El beb√© llora mucho (Cry -> Cries).</span></div>
                <div class="example-item">4. He <b>fixes</b> cars.<span class="trans">√âl arregla coches (Termina en -x).</span></div>
                <div class="example-item">5. She <b>kisses</b> her mom.<span class="trans">Ella besa a su madre (Termina en -ss).</span></div>
            </div>
        </div>
    </section>

    <section id="preguntas" class="content-section">
        <div class="card">
            <h2>Preguntas con "WH-"</h2>
            <p>Se usan para pedir informaci√≥n espec√≠fica. La estructura es: <b>Palabra WH + Do/Does + Sujeto + Verbo.</b></p>
            <div class="example-list">
                <h3>Ejemplos WH-:</h3>
                <div class="example-item">1. <b>Where</b> do you live?<span class="trans">¬øD√≥nde vives?</span></div>
                <div class="example-item">2. <b>What</b> does she eat?<span class="trans">¬øQu√© come ella?</span></div>
                <div class="example-item">3. <b>When</b> do they arrive?<span class="trans">¬øCu√°ndo llegan ellos?</span></div>
                <div class="example-item">4. <b>How</b> do you spell your name?<span class="trans">¬øC√≥mo deletreas tu nombre?</span></div>
                <div class="example-item">5. <b>Why</b> do we study English?<span class="trans">¬øPor qu√© estudiamos ingl√©s?</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Resumen de Pr√°ctica Combinada</h2>
            <p>Aqu√≠ integramos adverbios, tercera persona y complementos tal como el profesor explica al final del video.</p>
            <div class="example-list">
                <h3>Ejemplos Combinados:</h3>
                <div class="example-item">1. I visit my aunt <b>every Sunday</b>.<span class="trans">Visito a mi t√≠a cada domingo.</span></div>
                <div class="example-item">2. She <b>visits</b> her grandfather everyday.<span class="trans">Ella visita a su abuelo todos los d√≠as.</span></div>
                <div class="example-item">3. I <b>often</b> study in the morning.<span class="trans">A menudo estudio por la ma√±ana.</span></div>
                <div class="example-item">4. She <b>studies</b> French <b>once a week</b>.<span class="trans">Ella estudia franc√©s una vez a la semana.</span></div>
                <div class="example-item">5. They <b>always</b> play tennis at weekends.<span class="trans">Ellos siempre juegan al tenis los fines de semana.</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Conocimientos</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es la forma correcta para 'She'?", o: ["She watch", "She watches", "She watchs"], c: 1 },
        { q: "¬øD√≥nde va 'Never'?", o: ["Al final", "Antes del verbo principal", "Al principio siempre"], c: 1 },
        { q: "¬øC√≥mo se dice 'cada semana'?", o: ["Every week", "Every weeks", "All weeks"], c: 0 },
        { q: "¬øRespuesta corta para 'Does he help?'?", o: ["Yes, he helps", "Yes, he does", "Yes, he help"], c: 1 },
        { q: "¬øC√≥mo se dice 'una vez al mes'?", o: ["One month", "Once a month", "Twice a month"], c: 1 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Completado! üéì";
            div.innerHTML = "<p>Has terminado el tutorial interactivo.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto!"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Revisa la teor√≠a."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>

<!-- Template embebido para Future Simple (Will) (se carga en iframe dentro del modal) -->
<template id="fsAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Simple Future (Will) - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #06b6d4; --secondary: #3b82f6; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #a5f3fc;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(6, 182, 212, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--primary); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--primary); font-family: 'Courier New', monospace; font-size: 1rem; color: #a5f3fc; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning); padding: 15px; margin: 20px 0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: left; }
        th { background: var(--secondary); }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(6, 182, 212, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Simple Future (Will)</h1>
        <p>Tutorial de Futuro con Will para Hispanohablantes</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/kt1W7Wkfuow" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'respuestas')">2. Respuestas</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">3. El Uso</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">4. Adverbios</button>
        <button class="tab-btn" onclick="openTab(event, 'ortografia')">5. Contracciones</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">6. Ejemplos Finales</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura Gramatical</h2>
            <p>El futuro con <b>Will</b> es uno de los tiempos m√°s sencillos porque no cambia seg√∫n la persona (I, You, He, She, etc., todos usan Will).</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + <b>Will</b> + Verbo (forma base) + Complemento.</li>
                <li><b>Negativa:</b> Sujeto + <b>Won't</b> (will not) + Verbo (forma base).</li>
                <li><b>Interrogativa:</b> <b>Will</b> + Sujeto + Verbo (forma base)?</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. You <b>will pass</b> English.<span class="trans">(T√∫ aprobar√°s el ingl√©s - Afirmativa)</span></div>
                <div class="example-item">2. She <b>will fail</b> French.<span class="trans">(Ella suspender√° el franc√©s - Afirmativa)</span></div>
                <div class="example-item">3. You <b>won't pass</b> English.<span class="trans">(T√∫ no aprobar√°s el ingl√©s - Negativa)</span></div>
                <div class="example-item">4. She <b>won't fail</b> French.<span class="trans">(Ella no suspender√° el franc√©s - Negativa)</span></div>
                <div class="example-item">5. <b>Will</b> you study tonight?<span class="trans">(¬øEstudiar√°s esta noche? - Interrogativa)</span></div>
            </div>
        </div>
    </section>

    <section id="respuestas" class="content-section">
        <div class="card">
            <h2>Short Answers (Respuestas Cortas)</h2>
            <p>Para responder de forma natural, utilizamos "Yes, [sujeto] will" o "No, [sujeto] won't".</p>
            <div class="example-list">
                <h3>Ejemplos de Respuestas:</h3>
                <div class="example-item">1. Will you pass? - <b>Yes, I will.</b><span class="trans">(¬øAprobar√°s? - S√≠)</span></div>
                <div class="example-item">2. Will you pass? - <b>No, I won't.</b><span class="trans">(¬øAprobar√°s? - No)</span></div>
                <div class="example-item">3. Will she fail? - <b>Yes, she will.</b><span class="trans">(¬øSuspender√° ella? - S√≠)</span></div>
                <div class="example-item">4. Will she fail? - <b>No, she won't.</b><span class="trans">(¬øSuspender√° ella? - No)</span></div>
                <div class="example-item">5. Will it rain? - <b>Yes, it will.</b><span class="trans">(¬øLlover√°? - S√≠)</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>¬øCu√°ndo usar Will?</h2>
            <p>A diferencia de otros futuros, Will se usa principalmente para:</p>
            <ul>
                <li><b>Predicciones:</b> Cosas que creemos que pasar√°n.</li>
                <li><b>Ofrecimientos:</b> Cuando te prestas a ayudar a alguien.</li>
                <li><b>Peticiones:</b> Cuando pides que alguien haga algo por ti.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Uso:</h3>
                <div class="example-item">1. I <b>will help</b> you.<span class="trans">(Yo te ayudar√© - Ofrecimiento)</span></div>
                <div class="example-item">2. <b>Will</b> you <b>help</b> me?<span class="trans">(¬øMe ayudas/ayudar√°s? - Petici√≥n)</span></div>
                <div class="example-item">3. It <b>will be</b> a sunny day.<span class="trans">(Ser√° un d√≠a soleado - Predicci√≥n)</span></div>
                <div class="example-item">4. I <b>will open</b> the door for you.<span class="trans">(Yo te abrir√© la puerta - Ofrecimiento)</span></div>
                <div class="example-item">5. They <b>will win</b> the match.<span class="trans">(Ellos ganar√°n el partido - Predicci√≥n)</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>Adverbios de Futuro</h2>
            <p>Palabras clave que nos indican que la acci√≥n ocurrir√° m√°s adelante.</p>
            <table>
                <tr><th>Adverbio</th><th>Uso/Significado</th></tr>
                <tr><td>Tomorrow</td><td>Ma√±ana</td></tr>
                <tr><td>Next (week/month/year)</td><td>El/La pr√≥ximo/a (semana/mes/a√±o)</td></tr>
                <tr><td>In (two weeks/days)</td><td>Dentro de... / En...</td></tr>
            </table>
            <div class="note">‚ö†Ô∏è <b>Error com√∫n:</b> No digas "The next week". Lo correcto es simplemente <b>Next week</b>.</div>
            <div class="example-list">
                <h3>Ejemplos con Adverbios:</h3>
                <div class="example-item">1. I will see you <b>tomorrow</b>.<span class="trans">(Te ver√© ma√±ana)</span></div>
                <div class="example-item">2. She will get married <b>next month</b>.<span class="trans">(Ella se casar√° el mes que viene)</span></div>
                <div class="example-item">3. You will go to France <b>in two months</b>.<span class="trans">(Ir√°s a Francia dentro de dos meses)</span></div>
                <div class="example-item">4. We will finish <b>next Sunday</b>.<span class="trans">(Terminaremos el pr√≥ximo domingo)</span></div>
                <div class="example-item">5. I will call you <b>in three days</b>.<span class="trans">(Te llamar√© en tres d√≠as)</span></div>
            </div>
        </div>
    </section>

    <section id="ortografia" class="content-section">
        <div class="card">
            <h2>Contracciones y Ortograf√≠a</h2>
            <p>En el lenguaje hablado, es muy com√∫n contraer el Will tanto en afirmativa como en negativa.</p>
            <ul>
                <li><b>Afirmativa:</b> I will -> <b>I'll</b> / You will -> <b>You'll</b> / It will -> <b>It'll</b>.</li>
                <li><b>Negativa:</b> Will not -> <b>Won't</b>.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Contracciones:</h3>
                <div class="example-item">1. <b>I'll</b> see you tomorrow.<span class="trans">(Te ver√© ma√±ana - Contra√≠do)</span></div>
                <div class="example-item">2. <b>They'll</b> arrive late.<span class="trans">(Ellos llegar√°n tarde)</span></div>
                <div class="example-item">3. <b>He won't</b> come to the party.<span class="trans">(√âl no vendr√° a la fiesta)</span></div>
                <div class="example-item">4. <b>We'll</b> help you later.<span class="trans">(Te ayudaremos m√°s tarde)</span></div>
                <div class="example-item">5. <b>It'll</b> be cold tonight.<span class="trans">(Har√° fr√≠o esta noche)</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Pr√°ctica de Consolidaci√≥n</h2>
            <p>Repaso de oraciones mezcladas seg√∫n el tutorial de LuisThree:</p>
            <div class="example-list">
                <div class="example-item">1. She <b>will get married</b> next month.<span class="trans">(Ella se casar√° el mes que viene)</span></div>
                <div class="example-item">2. You <b>will go</b> to France in two months.<span class="trans">(Ir√°s a Francia en dos meses)</span></div>
                <div class="example-item">3. <b>I'll</b> see you tomorrow.<span class="trans">(Te ver√© ma√±ana)</span></div>
                <div class="example-item">4. <b>Won't</b> you stay for dinner?<span class="trans">(¬øNo te quedar√°s a cenar? - Pregunta negativa)</span></div>
                <div class="example-item">5. <b>Will</b> you help me with this?<span class="trans">(¬øMe ayudas con esto? - Petici√≥n)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Futuro Simple</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es la contracci√≥n negativa de 'Will not'?", o: ["Willn't", "Wont", "Won't"], c: 2 },
        { q: "¬øCu√°l de estas frases es CORRECTA?", o: ["The next week", "Next week", "Next the week"], c: 1 },
        { q: "¬øPara qu√© se usa Will principalmente?", o: ["Acciones ahora", "Rutinas pasadas", "Predicciones y ofrecimientos"], c: 2 },
        { q: "Respuesta corta: 'Will you help me?'", o: ["Yes, I help", "Yes, I will", "Yes, I'm"], c: 1 },
        { q: "¬øC√≥mo se dice 'Dentro de dos semanas'?", o: ["In two weeks", "Ago two weeks", "Next two weeks"], c: 0 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Enhorabuena! üéì";
            div.innerHTML = "<p>Has completado el curso de Futuro Simple con Will.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Repasa los adverbios."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>

<template id="psAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Past Simple - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #f43f5e; --secondary: #fb923c; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #38bdf8;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(244, 63, 94, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--secondary); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--accent); font-family: 'Courier New', monospace; font-size: 1rem; color: #a5f3fc; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning); padding: 15px; margin: 20px 0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: left; }
        th { background: var(--primary); }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(244, 63, 94, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Past Simple</h1>
        <p>Tutorial de Pasado Simple para Hispanohablantes</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/RI0W_AqYZlQ" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'verbos')">1. Regulares vs Irregulares</button>
        <button class="tab-btn" onclick="openTab(event, 'estructura')">2. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'respuestas')">3. Respuestas</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">4. Adverbios</button>
        <button class="tab-btn" onclick="openTab(event, 'ortografia')">5. Ortograf√≠a</button>
        <button class="tab-btn" onclick="openTab(event, 'preguntas')">6. WH- Questions</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">7. Ejemplos Mixtos</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="verbos" class="content-section active">
        <div class="card">
            <h2>Tipos de Verbos en Pasado</h2>
            <p>En el pasado simple, lo primero es distinguir entre dos tipos de verbos:</p>
            <ul>
                <li><b>Verbos Regulares:</b> Se forman a√±adiendo <b>-ed</b> a la forma base.</li>
                <li><b>Verbos Irregulares:</b> Tienen una forma propia. Debes usar la <b>segunda columna</b> de la lista de verbos irregulares.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Formaci√≥n:</h3>
                <div class="example-item">1. Work -> <b>Worked</b> <span class="trans">(Trabaj√© - Regular)</span></div>
                <div class="example-item">2. Drink -> <b>Drank</b> <span class="trans">(Beb√≠ - Irregular, 2¬™ columna)</span></div>
                <div class="example-item">3. Wash -> <b>Washed</b> <span class="trans">(Lav√© - Regular)</span></div>
                <div class="example-item">4. Break -> <b>Broke</b> <span class="trans">(Romp√≠ - Irregular, 2¬™ columna)</span></div>
                <div class="example-item">5. See -> <b>Saw</b> <span class="trans">(Vi - Irregular, 2¬™ columna)</span></div>
            </div>
        </div>
    </section>

    <section id="estructura" class="content-section">
        <div class="card">
            <h2>Estructura (+ / - / ?)</h2>
            <p>A diferencia del presente, en el pasado **no hay cambios por persona** (He/She/It usan el mismo verbo que los dem√°s).</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + Verbo en Pasado (-ed o 2¬™ columna).</li>
                <li><b>Negativa:</b> Sujeto + <b>didn't</b> + Verbo en Forma Base (sin -ed / 1¬™ columna).</li>
                <li><b>Interrogativa:</b> <b>Did</b> + Sujeto + Verbo en Forma Base.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. He <b>washed</b> his car.<span class="trans">(√âl lav√≥ su coche - Afirmativa)</span></div>
                <div class="example-item">2. She <b>drank</b> some beer.<span class="trans">(Ella bebi√≥ algo de cerveza - Afirmativa)</span></div>
                <div class="example-item">3. He <b>didn't wash</b> his car.<span class="trans">(√âl no lav√≥ su coche - Negativa: el verbo vuelve al presente)</span></div>
                <div class="example-item">4. She <b>didn't drink</b> any beer.<span class="trans">(Ella no bebi√≥ nada de cerveza - Negativa)</span></div>
                <div class="example-item">5. <b>Did</b> you buy that car?<span class="trans">(¬øCompraste ese coche? - Interrogativa)</span></div>
            </div>
        </div>
    </section>

    <section id="respuestas" class="content-section">
        <div class="card">
            <h2>Short Answers (Respuestas Cortas)</h2>
            <p>Usamos el auxiliar <b>did</b> o <b>didn't</b> para responder de forma natural.</p>
            <div class="example-list">
                <h3>Ejemplos de Respuestas:</h3>
                <div class="example-item">Did he wash the car? - <b>Yes, he did.</b><span class="trans">(¬øLav√≥ el coche? - S√≠)</span></div>
                <div class="example-item">Did she drink beer? - <b>No, she didn't.</b><span class="trans">(¬øBebi√≥ cerveza? - No)</span></div>
                <div class="example-item">Did you see her? - <b>Yes, I did.</b><span class="trans">(¬øLa viste? - S√≠)</span></div>
                <div class="example-item">Did they go? - <b>No, they didn't.</b><span class="trans">(¬øSe fueron? - No)</span></div>
                <div class="example-item">Did it work? - <b>Yes, it did.</b><span class="trans">(¬øFuncion√≥? - S√≠)</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>Adverbios de Tiempo en Pasado</h2>
            <p>Se utilizan para situar la acci√≥n en un momento ya acabado.</p>
            <table>
                <tr><th>Adverbio</th><th>Uso/Significado</th></tr>
                <tr><td>Yesterday</td><td>Ayer</td></tr>
                <tr><td>Last (week/month/year)</td><td>El/La pasado/a (semana/mes/a√±o)</td></tr>
                <tr><td>Ago</td><td>Hace... (se pone al final: two days ago)</td></tr>
            </table>
            <div class="note">‚ö†Ô∏è <b>Error com√∫n:</b> No digas "The Last week". En ingl√©s se dice simplemente <b>Last week</b>.</div>
            <div class="example-list">
                <h3>Ejemplos con Adverbios:</h3>
                <div class="example-item">1. I saw your sister <b>yesterday</b>.<span class="trans">(Vi a tu hermana ayer)</span></div>
                <div class="example-item">2. She went to England <b>last year</b>.<span class="trans">(Ella fue a Inglaterra el a√±o pasado)</span></div>
                <div class="example-item">3. I talked to him <b>two hours ago</b>.<span class="trans">(Habl√© con √©l hace dos horas)</span></div>
                <div class="example-item">4. We finished the project <b>last month</b>.<span class="trans">(Terminamos el proyecto el mes pasado)</span></div>
                <div class="example-item">5. They arrived <b>five minutes ago</b>.<span class="trans">(Llegaron hace cinco minutos)</span></div>
            </div>
        </div>
    </section>

    <section id="ortografia" class="content-section">
        <div class="card">
            <h2>Reglas Ortogr√°ficas (Verbos Regulares)</h2>
            <p>Al a√±adir <b>-ed</b>, algunos verbos cambian:</p>
            <ul>
                <li><b>Consonante + Y:</b> Cambia a <b>-ied</b> (Study -> Studied).</li>
                <li><b>Monos√≠labos (Vocal + Consonante):</b> Doblan la consonante (Stop -> Stopped).</li>
                <li><b>Excepci√≥n:</b> <b>Travel</b> -> Travelled (Dobla la 'L' aunque no sea aguda).</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Ortograf√≠a:</h3>
                <div class="example-item">1. He <b>studied</b> for the exam.<span class="trans">(√âl estudi√≥ para el examen)</span></div>
                <div class="example-item">2. The car <b>stopped</b> suddenly.<span class="trans">(El coche se par√≥ de repente)</span></div>
                <div class="example-item">3. We <b>travelled</b> to France.<span class="trans">(Viajamos a Francia)</span></div>
                <div class="example-item">4. She <b>admitted</b> the truth.<span class="trans">(Ella admiti√≥ la verdad - Se dobla por ser aguda)</span></div>
                <div class="example-item">5. They <b>cried</b> during the movie.<span class="trans">(Ellos lloraron durante la pel√≠cula)</span></div>
            </div>
        </div>
    </section>

    <section id="preguntas" class="content-section">
        <div class="card">
            <h2>Preguntas WH- en Pasado</h2>
            <p>Estructura: <b>Palabra WH + Did + Sujeto + Verbo Base.</b></p>
            <div class="example-list">
                <h3>Ejemplos WH-:</h3>
                <div class="example-item">1. <b>What</b> did you say?<span class="trans">(¬øQu√© dijiste?)</span></div>
                <div class="example-item">2. <b>Where</b> did you go?<span class="trans">(¬øA d√≥nde fuiste?)</span></div>
                <div class="example-item">3. <b>When</b> did they arrive?<span class="trans">(¬øCu√°ndo llegaron?)</span></div>
                <div class="example-item">4. <b>Why</b> did she cry?<span class="trans">(¬øPor qu√© llor√≥ ella?)</span></div>
                <div class="example-item">5. <b>How</b> did you do it?<span class="trans">(¬øC√≥mo lo hiciste?)</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Pr√°ctica Combinada</h2>
            <p>Repaso de verbos regulares e irregulares en diferentes contextos:</p>
            <div class="example-list">
                <div class="example-item">1. You <b>broke</b> the window.<span class="trans">(T√∫ rompiste la ventana - Irregular)</span></div>
                <div class="example-item">2. I <b>talked</b> to him two hours ago.<span class="trans">(Habl√© con √©l hace dos horas - Regular)</span></div>
                <div class="example-item">3. She <b>didn't go</b> to England last year.<span class="trans">(Ella no fue a Inglaterra el a√±o pasado)</span></div>
                <div class="example-item">4. <b>Did</b> you buy that car?<span class="trans">(¬øCompraste ese coche?)</span></div>
                <div class="example-item">5. I <b>saw</b> your sister yesterday.<span class="trans">(Vi a tu hermana ayer - Irregular)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Pasado Simple</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es el pasado del verbo irregular 'Drink'?", o: ["Drinked", "Drank", "Drunk"], c: 1 },
        { q: "En la negativa 'She didn't...', el verbo va en:", o: ["Pasado (-ed)", "Forma base (Presente)", "Gerundio (-ing)"], c: 1 },
        { q: "¬øCu√°l es el error en: 'The last week'?", o: ["No lleva 'The'", "No lleva 'Last'", "Est√° correcto"], c: 0 },
        { q: "Pasado de 'Stop' (Monos√≠labo):", o: ["Stoped", "Stopped", "Stopied"], c: 1 },
        { q: "¬øC√≥mo se dice 'Hace dos d√≠as'?", o: ["Two days ago", "Ago two days", "Before two days"], c: 0 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Misi√≥n Cumplida! üèÜ";
            div.innerHTML = "<p>Has dominado el Pasado Simple.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Incorrecto. Mira la pesta√±a de reglas."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>

<template id="prpAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Present Perfect - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8b5cf6; --secondary: #d946ef; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #f472b6;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(139, 92, 246, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--secondary); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--accent); font-family: 'Courier New', monospace; font-size: 1rem; color: #fdf2f8; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning); padding: 15px; margin: 20px 0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: left; }
        th { background: var(--primary); }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(139, 92, 246, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Present Perfect</h1>
        <p>Tutorial de Presente Perfecto para Hispanohablantes</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/bpjfIF988dA" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'respuestas')">2. Respuestas</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">3. El Uso</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">4. Adverbios (Yet/Already/Just)</button>
        <button class="tab-btn" onclick="openTab(event, 'forsince')">5. For vs Since</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">6. Pr√°ctica Final</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura Gramatical</h2>
            <p>Para formar el Presente Perfecto necesitamos dos cosas: el auxiliar <b>have/has</b> y el <b>participio</b> del verbo.</p>
            <ul>
                <li><b>Auxiliar:</b> Usamos <b>Have</b> para (I, You, We, They) y <b>Has</b> para la 3¬™ persona (He, She, It).</li>
                <li><b>Participio:</b> Si el verbo es regular termina en <b>-ed</b>. Si es irregular, usamos la <b>3¬™ columna</b>.</li>
                <li><b>Estructuras:</b> Sujeto + Have/Has + Participio. Para negar: <b>Haven't/Hasn't</b>. Para preguntar: <b>Have/Has</b> al principio.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. You <b>have played</b> tennis.<span class="trans">(T√∫ has jugado al tenis - Regular)</span></div>
                <div class="example-item">2. She <b>has eaten</b> a sandwich.<span class="trans">(Ella ha comido un s√°ndwich - Irregular, 3¬™ columna)</span></div>
                <div class="example-item">3. He <b>hasn't watched</b> the match.<span class="trans">(√âl no ha visto el partido - Negativa)</span></div>
                <div class="example-item">4. <b>Have</b> you <b>done</b> your homework?<span class="trans">(¬øHas hecho tus deberes? - Interrogativa)</span></div>
                <div class="example-item">5. <b>Where has</b> she <b>gone</b>?<span class="trans">(¬øA d√≥nde ha ido ella? - Pregunta WH)</span></div>
            </div>
        </div>
    </section>

    <section id="respuestas" class="content-section">
        <div class="card">
            <h2>Short Answers (Respuestas Cortas)</h2>
            <p>Se responde repitiendo el auxiliar <b>have/has</b> o <b>haven't/hasn't</b>.</p>
            <div class="example-list">
                <h3>Ejemplos de Respuestas:</h3>
                <div class="example-item">1. Have you played? - <b>Yes, I have.</b><span class="trans">(¬øHas jugado? - S√≠)</span></div>
                <div class="example-item">2. Have you played? - <b>No, I haven't.</b><span class="trans">(¬øHas jugado? - No)</span></div>
                <div class="example-item">3. Has he watched it? - <b>Yes, he has.</b><span class="trans">(¬øLo ha visto? - S√≠)</span></div>
                <div class="example-item">4. Has he watched it? - <b>No, he hasn't.</b><span class="trans">(¬øLo ha visto? - No)</span></div>
                <div class="example-item">5. Has she eaten? - <b>Yes, she has.</b><span class="trans">(¬øHa comido? - S√≠)</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>¬øCu√°ndo se usa?</h2>
            <p>Se usa para acciones que ocurrieron en el pasado pero tienen conexi√≥n con el presente, o en un periodo de tiempo que a√∫n no ha terminado (como "esta ma√±ana").</p>
            <div class="example-list">
                <h3>Ejemplos de Uso:</h3>
                <div class="example-item">1. I <b>have eaten</b> chips this morning.<span class="trans">(He comido patatas esta ma√±ana - Sigue siendo por la ma√±ana)</span></div>
                <div class="example-item">2. I <b>have bought</b> a car.<span class="trans">(He comprado un coche - Lo tengo ahora, conexi√≥n presente)</span></div>
                <div class="example-item">3. <b>I've finished</b> my work.<span class="trans">(He terminado mi trabajo - Acci√≥n reciente)</span></div>
                <div class="example-item">4. She <b>has seen</b> that movie.<span class="trans">(Ella ha visto esa pel√≠cula - Experiencia pasada)</span></div>
                <div class="example-item">5. We <b>have lived</b> here for years.<span class="trans">(Hemos vivido aqu√≠ por a√±os - Seguimos viviendo aqu√≠)</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>Adverbios Clave: Yet, Already, Just</h2>
            <p>Estos adverbios cambian su significado y posici√≥n seg√∫n la frase:</p>
            <ul>
                <li><b>Yet:</b> Significa "ya" en interrogativas y "todav√≠a" en negativas. Va al <b>final</b> de la oraci√≥n.</li>
                <li><b>Already:</b> Significa "ya" en afirmativas. Va <b>delante</b> del participio.</li>
                <li><b>Just:</b> Indica que algo acaba de ocurrir. Se traduce como "acabar de". Va <b>delante</b> del participio.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos con Adverbios:</h3>
                <div class="example-item">1. Have you finished <b>yet</b>?<span class="trans">(¬øHas terminado ya? - Interrogativa)</span></div>
                <div class="example-item">2. I haven't finished <b>yet</b>.<span class="trans">(No he terminado todav√≠a - Negativa)</span></div>
                <div class="example-item">3. I have <b>already</b> finished.<span class="trans">(Yo ya he terminado - Afirmativa)</span></div>
                <div class="example-item">4. I have <b>just</b> seen Mary.<span class="trans">(Acabo de ver a Mary - Reci√©n ocurrido)</span></div>
                <div class="example-item">5. I've <b>just</b> drunk some water.<span class="trans">(Acabo de beber algo de agua)</span></div>
            </div>
        </div>
    </section>

    <section id="forsince" class="content-section">
        <div class="card">
            <h2>For vs Since (Desde / Desde hace)</h2>
            <p>Se usan para indicar la duraci√≥n de una acci√≥n:</p>
            <ul>
                <li><b>For:</b> Significa "desde hace". Se usa para un <b>periodo de tiempo</b> (2 a√±os, 3 meses).</li>
                <li><b>Since:</b> Significa "desde". Se usa para un <b>punto concreto</b> en el tiempo (2011, el lunes, las 5:00).</li>
            </ul>
            <div class="note">‚ö†Ô∏è <b>Diferencia cultural:</b> En espa√±ol decimos "conozco a Pedro desde hace 2 a√±os" (presente), pero en ingl√©s debemos usar Present Perfect: <b>I have known Pedro for 2 years</b>.</div>
            <div class="example-list">
                <h3>Ejemplos de For/Since:</h3>
                <div class="example-item">1. I have lived here <b>for</b> two years.<span class="trans">(He vivido aqu√≠ desde hace dos a√±os)</span></div>
                <div class="example-item">2. I have lived here <b>since</b> 2011.<span class="trans">(He vivido aqu√≠ desde 2011)</span></div>
                <div class="example-item">3. I've had this book <b>since</b> last year.<span class="trans">(Tengo/He tenido este libro desde el a√±o pasado)</span></div>
                <div class="example-item">4. She hasn't seen her mom <b>for</b> weeks.<span class="trans">(Ella no ha visto a su madre desde hace semanas)</span></div>
                <div class="example-item">5. We've been friends <b>since</b> we were kids.<span class="trans">(Hemos sido amigos desde que √©ramos ni√±os)</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Resumen de Pr√°ctica</h2>
            <p>Recuerda que <b>I have</b> se contrae como <b>I've</b> y <b>She has</b> como <b>She's</b> (no confundir con "She is").</p>
            <div class="example-list">
                <div class="example-item">1. I've already finished my homework.<span class="trans">(Ya he terminado mis deberes)</span></div>
                <div class="example-item">2. I haven't had lunch yet.<span class="trans">(No he almorzado todav√≠a)</span></div>
                <div class="example-item">3. Have you seen the pictures yet?<span class="trans">(¬øHas visto las fotos ya?)</span></div>
                <div class="example-item">4. I have known him for a long time.<span class="trans">(Le conozco desde hace mucho tiempo)</span></div>
                <div class="example-item">5. She's eaten chips this morning.<span class="trans">(Ella ha comido patatas esta ma√±ana)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Presente Perfecto</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es el participio (3¬™ columna) de 'Eat'?", o: ["Eated", "Ate", "Eaten"], c: 2 },
        { q: "En negativa, ¬ød√≥nde se coloca 'Yet'?", o: ["Al final", "Delante del verbo", "Al principio"], c: 0 },
        { q: "¬øC√≥mo se traduce 'I have just seen her'?", o: ["Ya la he visto", "Todav√≠a no la he visto", "Acabo de verla"], c: 2 },
        { q: "¬øCu√°l es correcto para un periodo: '2 years'?", o: ["Since 2 years", "For 2 years", "Ago 2 years"], c: 1 },
        { q: "¬øCu√°l es la contracci√≥n de 'He has'?", o: ["He's", "He've", "He'h"], c: 0 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Excelente Trabajo! üåü";
            div.innerHTML = "<p>Has dominado el Presente Perfecto.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Revisa la pesta√±a de adverbios."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>

<!-- Template embebido para Present Perfect Continuous (se carga en iframe dentro del modal) -->
<template id="prpcAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Present Perfect Continuous - LuisThree</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8b5cf6; --secondary: #6d28d9; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #a78bfa;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(139, 92, 246, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--accent); margin: 25px 0 10px 0; font-size: 1.3rem; }
        
        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--primary); font-family: 'Courier New', monospace; font-size: 1rem; color: #ede9fe; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(139, 92, 246, 0.1); border-left: 4px solid var(--primary); padding: 15px; margin: 20px 0; border-radius: 8px; }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(139, 92, 246, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Present Perfect Continuous</h1>
        <p>Tutorial: "He estado haciendo" - LuisThree Edition</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/9vj5hNmQamU" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">2. Uso y √ânfasis</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">3. For y Since</button>
        <button class="tab-btn" onclick="openTab(event, 'ortografia')">4. Contracciones</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">5. Ejemplos Finales</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>C√≥mo se forma</h2>
            <p>Se utiliza el presente del verbo haber (<b>have/has</b>), el participio del verbo ser (<b>been</b>) que es fijo, y el verbo principal en <b>-ing</b>.</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + <b>have/has been</b> + Verbo <b>-ing</b>.</li>
                <li><b>Negativa:</b> Sujeto + <b>haven't/hasn't been</b> + Verbo <b>-ing</b>.</li>
                <li><b>Interrogativa:</b> <b>Have/Has</b> + Sujeto + <b>been</b> + Verbo <b>-ing</b>?</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. You <b>have been working</b> all day.<span class="trans">(T√∫ has estado trabajando todo el d√≠a)</span></div>
                <div class="example-item">2. He <b>has been studying</b> English.<span class="trans">(√âl ha estado estudiando ingl√©s)</span></div>
                <div class="example-item">3. I <b>haven't been sleeping</b> well.<span class="trans">(No he estado durmiendo bien - Negativa)</span></div>
                <div class="example-item">4. <b>Has</b> he <b>been studying</b> English?<span class="trans">(¬øHa estado √©l estudiando ingl√©s? - Interrogativa)</span></div>
                <div class="example-item">5. <b>Have</b> you <b>been working</b>?<span class="trans">(¬øHas estado trabajando?)</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>Uso y Diferencia</h2>
            <p>Se traduce como "he estado..." o "llevo + gerundio" (llevo viviendo). Se usa igual que en espa√±ol.</p>
            <div class="note">üí° <b>Diferencia Clave:</b> A diferencia del Present Perfect simple (I have studied - he estudiado), el Continuous hace mucho m√°s <b>√©nfasis en el esfuerzo</b> y el proceso de la acci√≥n.</div>
            <div class="example-list">
                <h3>Ejemplos de Uso:</h3>
                <div class="example-item">1. I <b>have been living</b> in Murcia for two years.<span class="trans">(Llevo viviendo en Murcia desde hace dos a√±os)</span></div>
                <div class="example-item">2. She <b>has been cooking</b> all morning.<span class="trans">(Ella ha estado cocinando toda la ma√±ana - √ânfasis en el trabajo)</span></div>
                <div class="example-item">3. We <b>have been waiting</b> for an hour.<span class="trans">(Llevamos esperando una hora)</span></div>
                <div class="example-item">4. I <b>have been studying</b> (more emphasis) vs I <b>have studied</b> (more neutral).<span class="trans">(He estado estudiando vs He estudiado)</span></div>
                <div class="example-item">5. It <b>has been raining</b> all day.<span class="trans">(Ha estado lloviendo todo el d√≠a)</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>For y Since</h2>
            <p>Son los adverbios m√°s comunes para indicar cu√°nto tiempo dura la acci√≥n:</p>
            <ul>
                <li><b>For:</b> "Durante" o "Desde hace". Se usa para periodos de tiempo.</li>
                <li><b>Since:</b> "Desde". Se usa para un punto concreto en el tiempo.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos con For/Since:</h3>
                <div class="example-item">1. I have been playing tennis <b>for</b> two hours.<span class="trans">(He estado jugando al tenis durante dos horas)</span></div>
                <div class="example-item">2. I have been playing chess <b>since</b> three o'clock.<span class="trans">(He estado jugando al ajedrez desde las tres)</span></div>
                <div class="example-item">3. He's been working here <b>for</b> two months.<span class="trans">(√âl ha estado trabajando aqu√≠ durante dos meses)</span></div>
                <div class="example-item">4. She's been cooking <b>since</b> one o'clock.<span class="trans">(Ella ha estado cocinando desde la una)</span></div>
                <div class="example-item">5. We've been living here <b>since</b> 2010.<span class="trans">(Llevamos viviendo aqu√≠ desde 2010)</span></div>
            </div>
        </div>
    </section>

    <section id="ortografia" class="content-section">
        <div class="card">
            <h2>Contracciones (I've / He's)</h2>
            <p>Es muy com√∫n contraer el sujeto con el auxiliar <b>have/has</b>.</p>
            <div class="note">‚ö†Ô∏è <b>¬°Ojo!:</b> 's puede ser <i>is</i> o <i>has</i>. Si despu√©s ves <b>been</b>, entonces ese 's es <b>has</b>.</div>
            <div class="example-list">
                <h3>Ejemplos de Contracciones:</h3>
                <div class="example-item">1. <b>I've</b> been surfing the internet.<span class="trans">(He estado navegando por internet)</span></div>
                <div class="example-item">2. <b>He's</b> been working here.<span class="trans">(√âl ha estado trabajando aqu√≠)</span></div>
                <div class="example-item">3. <b>She's</b> been cooking.<span class="trans">(Ella ha estado cocinando)</span></div>
                <div class="example-item">4. <b>You've</b> been doing a great job.<span class="trans">(Has estado haciendo un gran trabajo)</span></div>
                <div class="example-item">5. <b>They've</b> been playing all day.<span class="trans">(Ellos han estado jugando todo el d√≠a)</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Resumen del Tutorial</h2>
            <p>Oraciones clave para repasar todo lo aprendido:</p>
            <div class="example-list">
                <div class="example-item">1. <b>How long</b> have you been surfing the internet?<span class="trans">(¬øCu√°nto tiempo has estado navegando por internet?)</span></div>
                <div class="example-item">2. I have been surfing the internet <b>for</b> three hours.<span class="trans">(He estado navegando por internet durante tres horas)</span></div>
                <div class="example-item">3. He's been working here <b>for</b> two months.<span class="trans">(Lleva trabajando aqu√≠ dos meses)</span></div>
                <div class="example-item">4. She's been cooking <b>since</b> one o'clock.<span class="trans">(Ha estado cocinando desde la una)</span></div>
                <div class="example-item">5. Have you <b>been working</b> all day?<span class="trans">(¬øHas estado trabajando todo el d√≠a?)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Present Perfect Continuous</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es el auxiliar que siempre va fijo?", o: ["Have", "Has", "Been"], c: 2 },
        { q: "Si quieres enfatizar el ESFUERZO, usas...", o: ["Present Perfect Simple", "Present Perfect Continuous", "Present Simple"], c: 1 },
        { q: "¬øQu√© significa 'Since'?", o: ["Desde", "Durante", "Hace"], c: 0 },
        { q: "Para 'He', usamos...", o: ["Have been", "Has been", "Has been -ed"], c: 1 },
        { q: "¬øC√≥mo se pregunta '¬øCu√°nto tiempo...?'", o: ["How many", "How much", "How long"], c: 2 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Excelente trabajo! üåü";
            div.innerHTML = "<p>Ya dominas el Presente Perfecto Continuo.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Recuerda que 'been' es fijo y usamos '-ing'."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>

<template id="ppAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Past Perfect - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #10b981; --secondary: #059669; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #34d399;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(16, 185, 129, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--accent); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--primary); font-family: 'Courier New', monospace; font-size: 1rem; color: #d1fae5; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--primary); padding: 15px; margin: 20px 0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: left; }
        th { background: var(--secondary); }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(16, 185, 129, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Past Perfect</h1>
        <p>Tutorial de Pasado Perfecto para Hispanohablantes</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/e2Fdf8Vqz3I" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'respuestas')">2. Respuestas</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">3. El Uso (Pasado del Pasado)</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">4. Adverbios Clave</button>
        <button class="tab-btn" onclick="openTab(event, 'ortografia')">5. Contracciones</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">6. Pr√°ctica Final</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura del Past Perfect</h2>
            <p>Este tiempo se traduce como el <b>Pluscuamperfecto</b> (hab√≠a ido, hab√≠a comido). Es muy sencillo porque el auxiliar <b>had</b> es el mismo para todos los sujetos.</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + <b>Had</b> + Participio (-ed o 3¬™ columna).</li>
                <li><b>Negativa:</b> Sujeto + <b>Hadn't</b> (had not) + Participio.</li>
                <li><b>Interrogativa:</b> <b>Had</b> + Sujeto + Participio?</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. They <b>had gone</b> home.<span class="trans">(Ellos se hab√≠an ido a casa - Irregular: Go-Went-Gone)</span></div>
                <div class="example-item">2. She <b>had studied</b> a lot.<span class="trans">(Ella hab√≠a estudiado mucho - Regular: Study -> Studied)</span></div>
                <div class="example-item">3. He <b>hadn't played</b> tennis.<span class="trans">(√âl no hab√≠a jugado al tenis - Negativa)</span></div>
                <div class="example-item">4. <b>Had</b> they <b>gone</b> home?<span class="trans">(¬øSe hab√≠an ido ellos a casa? - Interrogativa)</span></div>
                <div class="example-item">5. <b>What had</b> she <b>done</b>?<span class="trans">(¬øQu√© hab√≠a hecho ella? - Pregunta WH)</span></div>
            </div>
        </div>
    </section>

    <section id="respuestas" class="content-section">
        <div class="card">
            <h2>Short Answers (Respuestas Cortas)</h2>
            <p>Al igual que en otros tiempos, respondemos usando el auxiliar correspondiente, en este caso <b>had</b> o <b>hadn't</b>.</p>
            <div class="example-list">
                <h3>Ejemplos de Respuestas:</h3>
                <div class="example-item">1. Had they gone home? - <b>Yes, they had.</b><span class="trans">(¬øSe hab√≠an ido? - S√≠)</span></div>
                <div class="example-item">2. Had they gone? - <b>No, they hadn't.</b><span class="trans">(¬øSe hab√≠an ido? - No)</span></div>
                <div class="example-item">3. Had she studied? - <b>Yes, she had.</b><span class="trans">(¬øHab√≠a estudiado? - S√≠)</span></div>
                <div class="example-item">4. Had he played? - <b>No, he hadn't.</b><span class="trans">(¬øHab√≠a jugado? - No)</span></div>
                <div class="example-item">5. Had you finished? - <b>Yes, I had.</b><span class="trans">(¬øHab√≠as terminado? - S√≠)</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>El Pasado del Pasado</h2>
            <p>El Past Perfect se usa para describir una acci√≥n que ocurri√≥ <b>antes</b> de otra acci√≥n tambi√©n en el pasado. Suele ir conectado a una frase en <b>Past Simple</b>.</p>
            <div class="note">üí° <b>Concepto clave:</b> Si hay dos acciones en el pasado, la que ocurri√≥ primero va en <b>Past Perfect</b> y la que ocurri√≥ despu√©s en <b>Past Simple</b>.</div>
            <div class="example-list">
                <h3>Ejemplos de Uso:</h3>
                <div class="example-item">1. They <b>had gone</b> home when we arrived.<span class="trans">(Ellos ya se hab√≠an ido cuando nosotros llegamos)</span></div>
                <div class="example-item">2. When we arrived, they <b>had gone</b> home.<span class="trans">(Cuando llegamos, ellos se hab√≠an ido - Mismo sentido, distinto orden)</span></div>
                <div class="example-item">3. She <b>had studied</b> before she took the exam.<span class="trans">(Ella hab√≠a estudiado antes de hacer el examen)</span></div>
                <div class="example-item">4. The film <b>had finished</b> when I got home.<span class="trans">(La pel√≠cula hab√≠a terminado cuando llegu√© a casa)</span></div>
                <div class="example-item">5. I <b>had seen</b> him before you asked.<span class="trans">(Yo le hab√≠a visto antes de que preguntaras)</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>Adverbios y Expresiones Temporales</h2>
            <p>Estas palabras ayudan a conectar las dos acciones pasadas:</p>
            <table>
                <tr><th>Adverbio</th><th>Uso/Significado</th></tr>
                <tr><td>When</td><td>Cuando</td></tr>
                <tr><td>By the time</td><td>Para cuando... / En el momento en que... (Sin√≥nimo de When)</td></tr>
                <tr><td>Before + -ing</td><td>Antes de (hacer algo)</td></tr>
            </table>
            <div class="example-list">
                <h3>Ejemplos con Adverbios:</h3>
                <div class="example-item">1. <b>By the time</b> I arrived, everyone <b>had left</b>.<span class="trans">(Para cuando llegu√©, todos se hab√≠an ido)</span></div>
                <div class="example-item">2. <b>Before playing</b> football, we <b>had trained</b> a lot.<span class="trans">(Antes de jugar al f√∫tbol, hab√≠amos entrenado mucho)</span></div>
                <div class="example-item">3. <b>When</b> Mary arrived, the concert <b>had finished</b>.<span class="trans">(Cuando Mary lleg√≥, el concierto hab√≠a terminado)</span></div>
                <div class="example-item">4. <b>Before passing</b> the exam, she <b>had studied</b> hard.<span class="trans">(Antes de aprobar el examen, ella hab√≠a estudiado duro)</span></div>
                <div class="example-item">5. Where <b>had she been</b> when you asked her?<span class="trans">(¬øD√≥nde hab√≠a estado ella cuando le preguntaste?)</span></div>
            </div>
        </div>
    </section>

    <section id="ortografia" class="content-section">
        <div class="card">
            <h2>Contracciones (Sujeto + 'd)</h2>
            <p>En ingl√©s hablado, el auxiliar <b>had</b> se contrae con el sujeto usando <b>'d</b>.</p>
            <div class="note">‚ö†Ô∏è <b>Cuidado:</b> El ap√≥strofe <b>'d</b> tambi√©n puede significar <i>would</i>. ¬øC√≥mo distinguirlos? Si despu√©s hay un <b>participio</b>, es <b>Had</b>.</div>
            <div class="example-list">
                <h3>Ejemplos de Contracciones:</h3>
                <div class="example-item">1. <b>They'd</b> gone home.<span class="trans">(Ellos se hab√≠an ido a casa)</span></div>
                <div class="example-item">2. <b>He'd</b> played tennis.<span class="trans">(√âl hab√≠a jugado al tenis)</span></div>
                <div class="example-item">3. <b>She'd</b> studied a lot.<span class="trans">(Ella hab√≠a estudiado mucho)</span></div>
                <div class="example-item">4. <b>I'd</b> seen the movie before.<span class="trans">(Yo hab√≠a visto la pel√≠cula antes)</span></div>
                <div class="example-item">5. <b>We'd</b> finished the work.<span class="trans">(Hab√≠amos terminado el trabajo)</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Resumen de Pr√°ctica</h2>
            <p>Repaso de las frases clave del tutorial de LuisThree:</p>
            <div class="example-list">
                <div class="example-item">1. Everybody <b>had left</b> by the time I got to the park.<span class="trans">(Todo el mundo se hab√≠a ido para cuando llegu√© al parque)</span></div>
                <div class="example-item">2. She <b>had studied</b> hard before passing the exam.<span class="trans">(Ella hab√≠a estudiado mucho antes de aprobar el examen)</span></div>
                <div class="example-item">3. <b>Had</b> they <b>gone</b> home when we arrived?<span class="trans">(¬øSe hab√≠an ido ellos a casa cuando llegamos?)</span></div>
                <div class="example-item">4. Where <b>had he gone</b>?<span class="trans">(¬øA d√≥nde hab√≠a ido √©l?)</span></div>
                <div class="example-item">5. We <b>had trained</b> a lot before the match.<span class="trans">(Hab√≠amos entrenado mucho antes del partido)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Pasado Perfecto</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es el auxiliar del Past Perfect para 'She'?", o: ["Has", "Have", "Had"], c: 2 },
        { q: "¬øQu√© significa 'By the time'?", o: ["Hace tiempo", "Para cuando / En el momento en que", "Antes de"], c: 1 },
        { q: "Si ves 'I'd gone', ¬øqu√© significa ese 'd?", o: ["Would", "Had", "Did"], c: 1 },
        { q: "¬øQu√© acci√≥n va en Past Perfect?", o: ["La que ocurri√≥ primero en el pasado", "La que ocurri√≥ despu√©s", "La que ocurre ahora"], c: 0 },
        { q: "Pasado de 'Go' en participio (3¬™ columna):", o: ["Went", "Goed", "Gone"], c: 2 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Enhorabuena! üèÜ";
            div.innerHTML = "<p>Has dominado el Pasado Perfecto (Past Perfect).</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Incorrecto. Repasa el uso del 'pasado del pasado'."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>

<template id="ppcAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Past Perfect Continuous - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #f59e0b; --secondary: #d97706; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #fbbf24;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(245, 158, 11, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--accent); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--primary); font-family: 'Courier New', monospace; font-size: 1rem; color: #fef3c7; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--primary); padding: 15px; margin: 20px 0; border-radius: 8px; }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(245, 158, 11, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Past Perfect Continuous</h1>
        <p>Tutorial de Pasado Perfecto Continuo - LuisThree Edition</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/ScGthI9955w" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">2. El Uso</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">3. Adverbios Clave</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">4. Pr√°ctica de Oraciones</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura del Pasado Perfecto Continuo</h2>
            <p>Este tiempo se traduce como "hab√≠a estado haciendo algo". Lo bueno es que el auxiliar <b>Had Been</b> es fijo para todos los sujetos.</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + <b>had been</b> + Verbo en <b>-ing</b>.</li>
                <li><b>Negativa:</b> Sujeto + <b>hadn't been</b> (had not been) + Verbo en <b>-ing</b>.</li>
                <li><b>Interrogativa:</b> <b>Had</b> + Sujeto + <b>been</b> + Verbo en <b>-ing</b>?</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. She <b>had been dancing</b> for two hours.<span class="trans">(Ella hab√≠a estado bailando durante dos horas)</span></div>
                <div class="example-item">2. I <b>hadn't been waiting</b> long.<span class="trans">(No hab√≠a estado esperando mucho tiempo)</span></div>
                <div class="example-item">3. <b>Had</b> she <b>been dancing</b>?<span class="trans">(¬øHab√≠a estado ella bailando?)</span></div>
                <div class="example-item">4. They <b>had been playing</b> very well.<span class="trans">(Ellos hab√≠an estado jugando muy bien)</span></div>
                <div class="example-item">5. <b>I'd been waiting</b> for you.<span class="trans">(Yo hab√≠a estado esper√°ndote - Contracci√≥n)</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>¬øCu√°ndo se usa?</h2>
            <p>Se utiliza para un <b>periodo de tiempo</b> que ocurri√≥ en el pasado y termin√≥ en el pasado antes de otra acci√≥n (esta otra acci√≥n suele ir en <b>Past Simple</b>).</p>
            <div class="note">üí° <b>LuisThree dice:</b> √ösalo para dar √©nfasis en la <b>duraci√≥n</b>, el <b>esfuerzo</b> o la <b>repetici√≥n</b> de una acci√≥n.</div>
            <div class="example-list">
                <h3>Ejemplos de Uso y √ânfasis:</h3>
                <div class="example-item">1. She had been dancing <b>when I talked to her</b>.<span class="trans">(Hab√≠a estado bailando cuando habl√© con ella)</span></div>
                <div class="example-item">2. I <b>had been calling</b> you once and again.<span class="trans">(Hab√≠a estado llam√°ndote una y otra vez - Repetici√≥n)</span></div>
                <div class="example-item">3. I <b>had been knocking</b> at the door for ten minutes.<span class="trans">(Hab√≠a estado llamando a la puerta 10 min - Esfuerzo)</span></div>
                <div class="example-item">4. The players <b>had been playing</b> well before it started to rain.<span class="trans">(Los jugadores hab√≠an estado jugando bien antes de que empezara a llover)</span></div>
                <div class="example-item">5. I <b>had been wanting</b> this present for years.<span class="trans">(Hab√≠a estado deseando este regalo durante a√±os)</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>Adverbios y Nexos</h2>
            <p>Este tiempo verbal suele ir acompa√±ado de conectores que marcan el l√≠mite de la acci√≥n:</p>
            <ul>
                <li><b>Before:</b> Antes de (puede ir seguido de verbo con -ing o una oraci√≥n).</li>
                <li><b>For / Since:</b> Durante / Desde.</li>
                <li><b>When:</b> Cuando.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos con Conectores:</h3>
                <div class="example-item">1. <b>Before meeting</b> you, I had been shopping.<span class="trans">(Antes de quedar contigo, hab√≠a estado de compras)</span></div>
                <div class="example-item">2. <b>Before I met</b> you, I had been shopping.<span class="trans">(Antes de que quedara contigo, hab√≠a estado de compras)</span></div>
                <div class="example-item">3. I had been wanting this present <b>since</b> I was a child.<span class="trans">(Hab√≠a estado deseando este regalo desde que era ni√±o)</span></div>
                <div class="example-item">4. Had you been watching videos <b>before</b> finding this one?<span class="trans">(¬øHab√≠as estado viendo v√≠deos antes de encontrar este?)</span></div>
                <div class="example-item">5. I had been waiting <b>for</b> many hours.<span class="trans">(Hab√≠a estado esperando durante muchas horas)</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Resumen de Pr√°ctica</h2>
            <p>Oraciones finales para repasar los conceptos clave del tutorial:</p>
            <div class="example-list">
                <div class="example-item">1. She <b>had been waiting</b> at the station.<span class="trans">(Ella hab√≠a estado esperando en la estaci√≥n)</span></div>
                <div class="example-item">2. <b>Had she been</b> dancing for two hours?<span class="trans">(¬øHab√≠a estado ella bailando durante dos horas?)</span></div>
                <div class="example-item">3. <b>I'd been knocking</b> for ten minutes.<span class="trans">(Hab√≠a estado llamando a la puerta por diez minutos)</span></div>
                <div class="example-item">4. They <b>hadn't been</b> playing well.<span class="trans">(Ellos no hab√≠an estado jugando bien)</span></div>
                <div class="example-item">5. I <b>had been calling</b> you once and again.<span class="trans">(Te hab√≠a estado llamando una y otra vez)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Pasado Perfecto Continuo</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øQu√© auxiliar se usa para TODOS los sujetos?", o: ["Have been", "Had been", "Was being"], c: 1 },
        { q: "¬øEn qu√© termina el verbo principal?", o: ["En -ed", "En infinitivo", "En -ing"], c: 2 },
        { q: "¬øPara qu√© sirve el Past Perfect Continuous?", o: ["Para hablar del presente", "Para enfatizar la duraci√≥n de una acci√≥n pasada", "Para planes futuros"], c: 1 },
        { q: "¬øCu√°l es la contracci√≥n de 'I had been'?", o: ["I've been", "I'd been", "I was been"], c: 1 },
        { q: "¬øQu√© tiempo suele interrumpir al Past Perfect Continuous?", o: ["Present Simple", "Past Simple", "Future Simple"], c: 1 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Excelente trabajo! üéØ";
            div.innerHTML = "<p>Has dominado el Pasado Perfecto Continuo con el estilo de LuisThree.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Recuerda: Had been + ING."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>

<template id="fpAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Future Perfect - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #f59e0b; --secondary: #d97706; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #fbbf24;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(245, 158, 11, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--primary); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--primary); font-family: 'Courier New', monospace; font-size: 1rem; color: #fef3c7; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning); padding: 15px; margin: 20px 0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: left; }
        th { background: var(--secondary); }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(245, 158, 11, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Future Perfect</h1>
        <p>Tutorial de Futuro Perfecto para Hispanohablantes</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/A5binNWjSso" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">2. El Uso</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">3. Expresiones de Tiempo</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">4. Pr√°ctica de Oraciones</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura Gramatical</h2>
            <p>El <b>Future Perfect</b> se utiliza para decir "habr√© hecho algo". Lo bueno es que el auxiliar <b>Will have</b> no cambia seg√∫n el sujeto.</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + <b>Will have</b> + Participio (3¬™ columna).</li>
                <li><b>Negativa:</b> Sujeto + <b>Won't have</b> + Participio.</li>
                <li><b>Interrogativa:</b> <b>Will</b> + Sujeto + <b>have</b> + Participio?</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. He <b>will have come back</b>.<span class="trans">(√âl habr√° vuelto)</span></div>
                <div class="example-item">2. I <b>will have finished</b> my homework.<span class="trans">(Yo habr√© terminado mis deberes)</span></div>
                <div class="example-item">3. He <b>won't have come back</b>.<span class="trans">(√âl no habr√° vuelto - Negativa)</span></div>
                <div class="example-item">4. <b>Will</b> he <b>have come back</b>?<span class="trans">(¬øHabr√° vuelto √©l? - Interrogativa)</span></div>
                <div class="example-item">5. We <b>won't have eaten</b> dinner.<span class="trans">(No habremos cenado)</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>¬øCu√°ndo se usa?</h2>
            <p>Se utiliza para referirse a una <b>acci√≥n que estar√° finalizada</b> en un momento concreto del futuro. Es como mirar hacia atr√°s desde un punto futuro.</p>
            <div class="note">üí° <b>Enfoque LuisThree:</b> Siempre imagina un punto futuro (como el fin de mes) y una acci√≥n que ya se habr√° completado para entonces.</div>
            <div class="example-list">
                <h3>Ejemplos de Uso:</h3>
                <div class="example-item">1. I <b>will have graduated</b> by 2025.<span class="trans">(Me habr√© graduado para el 2025)</span></div>
                <div class="example-item">2. She <b>will have written</b> the book.<span class="trans">(Ella habr√° escrito el libro)</span></div>
                <div class="example-item">3. They <b>will have arrived</b> at the station.<span class="trans">(Ellos habr√°n llegado a la estaci√≥n)</span></div>
                <div class="example-item">4. By tomorrow, I <b>will have fixed</b> it.<span class="trans">(Para ma√±ana, lo habr√© arreglado)</span></div>
                <div class="example-item">5. We <b>will have cleaned</b> the house.<span class="trans">(Habremos limpiado la casa)</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>Expresiones Temporales Clave</h2>
            <p>Para que el Future Perfect tenga sentido, solemos concretar el momento del futuro con estas expresiones:</p>
            <table>
                <tr><th>Expresi√≥n</th><th>Significado</th></tr>
                <tr><td>By the end of...</td><td>Hacia el final de...</td></tr>
                <tr><td>By this time next week</td><td>M√°s o menos por esta √©poca de la semana que viene</td></tr>
                <tr><td>In (two months/days)</td><td>Dentro de (dos meses/d√≠as)</td></tr>
                <tr><td>By (April/Monday)</td><td>Para (Abril/Lunes)</td></tr>
            </table>
            <div class="example-list">
                <h3>Ejemplos con Expresiones:</h3>
                <div class="example-item">1. <b>By the end of</b> April, he will have come back.<span class="trans">(Hacia el final de abril, √©l habr√° vuelto)</span></div>
                <div class="example-item">2. <b>By this time</b> next week, I will have finished school.<span class="trans">(Para esta hora la pr√≥xima semana, habr√© terminado el colegio)</span></div>
                <div class="example-item">3. <b>In</b> two months, the holidays will have finished.<span class="trans">(Dentro de dos meses, las vacaciones se habr√°n acabado)</span></div>
                <div class="example-item">4. <b>By</b> tomorrow morning, she will have left.<span class="trans">(Para ma√±ana por la ma√±ana, ella se habr√° ido)</span></div>
                <div class="example-item">5. <b>By the end of</b> the year, they will have sold the house.<span class="trans">(Para finales de a√±o, ellos habr√°n vendido la casa)</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Pr√°ctica de Consolidaci√≥n</h2>
            <p>Repaso de las oraciones finales del tutorial:</p>
            <div class="example-list">
                <div class="example-item">1. By this time next month, we <b>will have moved</b> to Paris.<span class="trans">(Para esta fecha el mes que viene, nos habremos mudado a Par√≠s)</span></div>
                <div class="example-item">2. I <b>will have read</b> the whole book by Sunday.<span class="trans">(Habr√© le√≠do todo el libro para el domingo)</span></div>
                <div class="example-item">3. <b>Won't</b> you <b>have finished</b> by 5 o'clock?<span class="trans">(¬øNo habr√°s terminado para las 5?)</span></div>
                <div class="example-item">4. In three days, they <b>will have fixed</b> the car.<span class="trans">(Dentro de tres d√≠as, habr√°n arreglado el coche)</span></div>
                <div class="example-item">5. By next year, I <b>will have bought</b> a new house.<span class="trans">(Para el a√±o que viene, habr√© comprado una casa nueva)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Futuro Perfecto</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es la estructura afirmativa del Future Perfect?", o: ["Will + Verbo", "Will have + Participio", "Have + Participio"], c: 1 },
        { q: "¬øQu√© significa 'By the end of'?", o: ["Al principio de", "Hacia el final de", "Durante"], c: 1 },
        { q: "¬øC√≥mo se dice 'Yo habr√© terminado'?", o: ["I will finish", "I will have finished", "I have finished"], c: 1 },
        { q: "¬øCu√°l es la forma negativa de 'Will'?", o: ["Willing", "Don't will", "Won't"], c: 2 },
        { q: "¬øCu√°ndo se usa el Future Perfect?", o: ["Acciones ahora", "Acciones que estar√°n finalizadas en un punto futuro", "Acciones pasadas"], c: 1 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Excelente! üéì";
            div.innerHTML = "<p>Has completado el tutorial del Futuro Perfecto.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Repasa la estructura 'Will have + Participio'."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>

<!-- Template embebido para Future Perfect Continuous (se carga en iframe dentro del modal) -->
<template id="fpcAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Future Perfect Continuous - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8b5cf6; --secondary: #6d28d9; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #ddd6fe;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(139, 92, 246, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--accent); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--primary); font-family: 'Courier New', monospace; font-size: 1rem; color: #ede9fe; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(139, 92, 246, 0.1); border-left: 4px solid var(--primary); padding: 15px; margin: 20px 0; border-radius: 8px; }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(139, 92, 246, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Future Perfect Continuous</h1>
        <p>Tutorial de Futuro Perfecto Continuo - LuisThree Edition</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/pK9UPDqY6gc" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'usos')">2. Los 2 Usos</button>
        <button class="tab-btn" onclick="openTab(event, 'nexos')">3. Nexos Clave</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">4. Pr√°ctica de Oraciones</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura Gramatical</h2>
            <p>Este tiempo se traduce como "habr√© estado haciendo algo". El bloque central es <b>Will Have Been</b> y no cambia nunca seg√∫n el sujeto.</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + <b>will have been</b> + Verbo en <b>-ing</b>.</li>
                <li><b>Negativa:</b> Sujeto + <b>won't have been</b> (will not) + Verbo en <b>-ing</b>.</li>
                <li><b>Interrogativa:</b> <b>Will</b> + Sujeto + <b>have been</b> + Verbo en <b>-ing</b>?</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. You <b>will have been waiting</b> for two hours.<span class="trans">(T√∫ habr√°s estado esperando durante dos horas) [00:01:43]</span></div>
                <div class="example-item">2. He <b>will have been working</b> for three years.<span class="trans">(√âl habr√° estado trabajando durante tres a√±os) [00:02:27]</span></div>
                <div class="example-item">3. You <b>won't have been waiting</b> long.<span class="trans">(T√∫ no habr√°s estado esperando mucho tiempo) [00:04:18]</span></div>
                <div class="example-item">4. <b>Will you have been</b> waiting for two hours?<span class="trans">(¬øHabr√°s estado esperando por dos horas?) [00:05:36]</span></div>
                <div class="example-item">5. She <b>will have been living</b> here for 10 years.<span class="trans">(Ella habr√° estado viviendo aqu√≠ durante 10 a√±os) [00:13:52]</span></div>
            </div>
        </div>
    </section>

    <section id="usos" class="content-section">
        <div class="card">
            <h2>¬øCu√°ndo se utiliza?</h2>
            <ol>
                <li><b>Duraci√≥n antes de algo en el futuro:</b> Expresar cu√°nto tiempo llevar√° una acci√≥n cuando ocurra otra cosa.</li>
                <li><b>Causa de algo futuro:</b> Explicar por qu√© suceder√° algo bas√°ndose en una acci√≥n continua previa.</li>
            </ol>
            <div class="note">‚ö†Ô∏è <b>Importante:</b> Casi nunca va solo. Suele conectarse con una frase en <b>Present Simple</b> (aunque en espa√±ol pensemos en subjuntivo).</div>
            <div class="example-list">
                <h3>Ejemplos de Uso:</h3>
                <div class="example-item">1. I'll have been teaching for 35 years <b>by the time I retire</b>.<span class="trans">(Habr√© ense√±ado por 35 a√±os para cuando me jubile) [00:06:41]</span></div>
                <div class="example-item">2. You'll have a high level <b>because you'll have been watching</b> my videos.<span class="trans">(Tendr√°s un nivel alto porque habr√°s estado viendo mis v√≠deos) [00:07:38]</span></div>
                <div class="example-item">3. I'll have been looking for a job for a long time <b>by the time I find one</b>.<span class="trans">(Habr√© estado buscando trabajo mucho tiempo para cuando encuentre uno) [00:13:27]</span></div>
                <div class="example-item">4. You will score good marks <b>as you'll have been studying hard</b>.<span class="trans">(Sacar√°s buenas notas puesto que habr√°s estado estudiando duro) [00:13:04]</span></div>
                <div class="example-item">5. He'll have been working 3 years <b>when his contract ends</b>.<span class="trans">(√âl habr√° estado trabajando 3 a√±os cuando termine su contrato) [00:03:03]</span></div>
            </div>
        </div>
    </section>

    <section id="nexos" class="content-section">
        <div class="card">
            <h2>Adverbios y Conjunciones</h2>
            <p>LuisThree destaca varias palabras que "llaman" a este tiempo verbal:</p>
            <ul>
                <li><b>When / By the time:</b> Cu√°ndo / Para cuando (son sin√≥nimos en este tiempo). [00:09:13]</li>
                <li><b>Because / As / Since:</b> Porque / Puesto que / Ya que (explican la causa). [00:10:32]</li>
                <li><b>For:</b> Durante (indica el periodo de tiempo). [00:10:04]</li>
                <li><b>By:</b> Para/A la altura de (seguido de indicador como un mes). [00:11:45]</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos con Nexos:</h3>
                <div class="example-item">1. I will have been working for 3 months <b>by June</b>.<span class="trans">(Habr√© estado trabajando por 3 meses para junio) [00:12:10]</span></div>
                <div class="example-item">2. <b>How long</b> will you have been watching videos?<span class="trans">(¬øCu√°nto tiempo habr√°s estado viendo v√≠deos?) [00:12:41]</span></div>
                <div class="example-item">3. ...<b>as</b> you will have been studying hard.<span class="trans">(...ya que habr√°s estado estudiando duro) [00:13:16]</span></div>
                <div class="example-item">4. ...<b>by next September</b>.<span class="trans">(...para el pr√≥ximo septiembre) [00:14:00]</span></div>
                <div class="example-item">5. ...<b>when</b> I retire.<span class="trans">(...cuando me retire) [00:09:41]</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Pr√°ctica Combinada</h2>
            <p>Repaso de oraciones complejas del tutorial:</p>
            <div class="example-list">
                <div class="example-item">1. <b>How long will you have been watching</b> videos by the time you have a good command of English?<span class="trans">[00:12:33]</span></div>
                <div class="example-item">2. You <b>will have a high level</b> soon <b>because you will have been watching</b> my videos.<span class="trans">[00:10:52]</span></div>
                <div class="example-item">3. She <b>will have been living</b> in England for 10 years by next September.<span class="trans">[00:13:42]</span></div>
                <div class="example-item">4. I <b>will have been looking</b> for a job for a long time.<span class="trans">[00:13:20]</span></div>
                <div class="example-item">5. You <b>won't have been waiting</b> for two hours when I arrive.<span class="trans">[00:04:07]</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Futuro Perfecto Continuo</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es el bloque auxiliar FIJO?", o: ["Will have been", "Will been have", "Will has been"], c: 0 },
        { q: "¬øPara qu√© sirve el segundo uso mencionado?", o: ["Para una acci√≥n puntual", "Para expresar una causa futura", "Para hablar del pasado"], c: 1 },
        { q: "En 'By the time I retire', el verbo 'retire' est√° en...", o: ["Futuro", "Presente Simple", "Pasado"], c: 1 },
        { q: "¬øQu√© nexo es sin√≥nimo de 'Because'?", o: ["When", "As", "By the time"], c: 1 },
        { q: "¬øC√≥mo se hace la negativa?", o: ["Will have not been", "Won't have been", "Will have been not"], c: 1 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Nivel Experto! üéì";
            div.innerHTML = "<p>Has completado todos los tiempos continuos de LuisThree.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Revisa la estructura: Will have been + ING."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>


<template id="fcAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Future Continuous - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3b82f6; --secondary: #1d4ed8; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #60a5fa;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(59, 130, 246, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--accent); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--primary); font-family: 'Courier New', monospace; font-size: 1rem; color: #dbeafe; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(59, 130, 246, 0.1); border-left: 4px solid var(--primary); padding: 15px; margin: 20px 0; border-radius: 8px; }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(59, 130, 246, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Future Continuous</h1>
        <p>Tutorial de Futuro Continuo para Hispanohablantes</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/3FY-9iG7SY4" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">2. El Uso</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">3. Expresiones Clave</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">4. Pr√°ctica de Oraciones</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura del Futuro Continuo</h2>
            <p>Este tiempo se usa para decir "estar√© haciendo algo". Es muy sencillo porque el bloque <b>will be</b> es fijo para todos los sujetos.</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + <b>will be</b> + Verbo terminado en <b>-ing</b>.</li>
                <li><b>Negativa:</b> Sujeto + <b>won't be</b> (will not be) + Verbo terminado en <b>-ing</b>.</li>
                <li><b>Interrogativa:</b> <b>Will</b> + Sujeto + <b>be</b> + Verbo terminado en <b>-ing</b>?</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. You <b>will be flying</b> to London.<span class="trans">(T√∫ estar√°s volando a Londres)</span></div>
                <div class="example-item">2. He <b>will be driving</b> a car.<span class="trans">(√âl estar√° conduciendo un coche)</span></div>
                <div class="example-item">3. You <b>won't be flying</b> to London.<span class="trans">(T√∫ no estar√°s volando a Londres - Negativa)</span></div>
                <div class="example-item">4. <b>Will</b> you <b>be flying</b> to London?<span class="trans">(¬øEstar√°s t√∫ volando a Londres? - Interrogativa)</span></div>
                <div class="example-item">5. She <b>won't be sleeping</b> at 10 PM.<span class="trans">(Ella no estar√° durmiendo a las 10 PM)</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>¬øCu√°ndo se usa?</h2>
            <p>Se utiliza para describir una acci√≥n que <b>estar√° ocurriendo</b> en un momento concreto del futuro. Tambi√©n se usa en combinaci√≥n con el <b>Present Simple</b>.</p>
            <div class="note">üí° <b>LuisThree dice:</b> √ösalo cuando quieras enfatizar la duraci√≥n de una acci√≥n en un momento exacto de ma√±ana o de la pr√≥xima semana.</div>
            <div class="example-list">
                <h3>Ejemplos de Uso:</h3>
                <div class="example-item">1. <b>At this time tomorrow</b>, I will be teaching English.<span class="trans">(A esta hora ma√±ana, estar√© ense√±ando ingl√©s)</span></div>
                <div class="example-item">2. <b>When you arrive</b>, I will be waiting for you.<span class="trans">(Cuando llegues -Present Simple-, estar√© esper√°ndote)</span></div>
                <div class="example-item">3. I'll be watching you <b>whatever you do</b>.<span class="trans">(Estar√© vigil√°ndote hagas lo que hagas)</span></div>
                <div class="example-item">4. At 5 PM next Monday, he <b>will be working</b>.<span class="trans">(A las 5 PM el pr√≥ximo lunes, √©l estar√° trabajando)</span></div>
                <div class="example-item">5. They <b>will be traveling</b> during the holidays.<span class="trans">(Ellos estar√°n viajando durante las vacaciones)</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>Expresiones Temporales Clave</h2>
            <p>El Futuro Continuo casi siempre va acompa√±ado de expresiones que marcan el momento exacto:</p>
            <ul>
                <li><b>At this time tomorrow:</b> A esta hora ma√±ana.</li>
                <li><b>At this time next week:</b> A esta hora la semana que viene.</li>
                <li><b>Next (Monday/Month):</b> El pr√≥ximo (lunes/mes).</li>
                <li><b>Tomorrow:</b> Ma√±ana.</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos con Adverbios:</h3>
                <div class="example-item">1. <b>At this time next week</b>, he will be driving to Paris.<span class="trans">(A esta hora la semana que viene, √©l estar√° conduciendo a Par√≠s)</span></div>
                <div class="example-item">2. <b>Tomorrow morning</b>, they will be playing football.<span class="trans">(Ma√±ana por la ma√±ana, ellos estar√°n jugando al f√∫tbol)</span></div>
                <div class="example-item">3. <b>Next Sunday</b>, we will be relaxing at the beach.<span class="trans">(El pr√≥ximo domingo estaremos relaj√°ndonos en la playa)</span></div>
                <div class="example-item">4. <b>At noon</b>, I'll be eating lunch.<span class="trans">(Al mediod√≠a estar√© almorzando)</span></div>
                <div class="example-item">5. <b>At this time tomorrow</b>, you'll be flying.<span class="trans">(A esta hora ma√±ana, estar√°s volando)</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Resumen de Pr√°ctica</h2>
            <p>Oraciones destacadas del tutorial de LuisThree:</p>
            <div class="example-list">
                <div class="example-item">1. At this time tomorrow, I <b>will be teaching</b> English.<span class="trans">(A esta hora ma√±ana estar√© dando clases de ingl√©s)</span></div>
                <div class="example-item">2. When you arrive at the station, I <b>will be waiting</b> for you.<span class="trans">(Cuando llegues a la estaci√≥n, estar√© esper√°ndote)</span></div>
                <div class="example-item">3. Whatever you do, I <b>will be watching</b> you.<span class="trans">(Hagas lo que hagas, estar√© observ√°ndote)</span></div>
                <div class="example-item">4. <b>Will</b> you <b>be flying</b> to London next month?<span class="trans">(¬øEstar√°s volando a Londres el mes que viene?)</span></div>
                <div class="example-item">5. He <b>won't be driving</b> at this time next week.<span class="trans">(√âl no estar√° conduciendo a esta hora la semana que viene)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Futuro Continuo</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es el bloque fijo en este tiempo?", o: ["Will have", "Will be", "Will"], c: 1 },
        { q: "¬øC√≥mo termina el verbo principal?", o: ["En -ed", "En -ing", "En infinitivo"], c: 1 },
        { q: "¬øQu√© significa 'At this time tomorrow'?", o: ["Ma√±ana a cualquier hora", "A esta hora ma√±ana", "Ayer a esta hora"], c: 1 },
        { q: "¬øCu√°l es la forma negativa de 'will be'?", o: ["Not will be", "Will be not", "Won't be"], c: 2 },
        { q: "En la frase 'When you arrive, I will be waiting', ¬øen qu√© tiempo est√° 'arrive'?", o: ["Past Simple", "Present Simple", "Future"], c: 1 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Buen trabajo! üöÄ";
            div.innerHTML = "<p>Has dominado el Futuro Continuo (Future Continuous).</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Recuerda: Will be + ING."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>











<!-- Template embebido para Present Continuous (se carga en iframe dentro del modal) -->
<template id="prcAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Present Continuous - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ec4899; --secondary: #db2777; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #fbcfe8;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(236, 72, 153, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--accent); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--primary); font-family: 'Courier New', monospace; font-size: 1rem; color: #fdf2f8; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(236, 72, 153, 0.1); border-left: 4px solid var(--primary); padding: 15px; margin: 20px 0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: left; }
        th { background: var(--secondary); }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(236, 72, 153, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Present Continuous</h1>
        <p>Tutorial de Presente Continuo - LuisThree Edition</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/FlZ_ugyET8g" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">2. Los 2 Usos</button>
        <button class="tab-btn" onclick="openTab(event, 'adverbios')">3. Adverbios</button>
        <button class="tab-btn" onclick="openTab(event, 'ortografia')">4. Reglas -ing</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">5. Ejemplos Reales</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura Gramatical</h2>
            <p>Para este tiempo necesitamos el presente del verbo <b>To Be</b> (am, is, are) y el verbo principal terminado en <b>-ing</b>.</p>
            <ul>
                <li><b>Afirmativa:</b> Sujeto + <b>am/is/are</b> + Verbo <b>-ing</b>.</li>
                <li><b>Negativa:</b> Sujeto + <b>am not/isn't/aren't</b> + Verbo <b>-ing</b>.</li>
                <li><b>Interrogativa:</b> <b>Am/Is/Are</b> + Sujeto + Verbo <b>-ing</b>?</li>
            </ul>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. You <b>are writing</b> an email.<span class="trans">(T√∫ est√°s escribiendo un email)</span></div>
                <div class="example-item">2. He <b>is watching</b> the match.<span class="trans">(√âl est√° viendo el partido)</span></div>
                <div class="example-item">3. You <b>aren't writing</b> an email.<span class="trans">(T√∫ no est√°s escribiendo un email - Negativa)</span></div>
                <div class="example-item">4. <b>Are</b> you <b>writing</b> an email?<span class="trans">(¬øEst√°s escribiendo un email? - Interrogativa)</span></div>
                <div class="example-item">5. I <b>am writing</b> on the blackboard.<span class="trans">(Estoy escribiendo en la pizarra)</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>Los dos usos principales</h2>
            <p>A diferencia del espa√±ol, el presente continuo en ingl√©s tiene dos funciones:</p>
            <ol>
                <li><b>Momento de hablar:</b> Acciones que ocurren ¬°ahora mismo!.</li>
                <li><b>Planes futuros:</b> Acciones ya decididas o concertadas para el futuro.</li>
            </ol>
            <div class="note">üí° <b>Truco:</b> Si a√±ades una palabra como "tomorrow" a una frase de presente continuo, autom√°ticamente se convierte en futuro planeado.</div>
            <div class="example-list">
                <h3>Ejemplos de los 2 usos:</h3>
                <div class="example-item">1. She <b>is playing</b> the piano (Now).<span class="trans">(Ella est√° tocando el piano ahora)</span></div>
                <div class="example-item">2. She <b>is playing</b> the piano tomorrow.<span class="trans">(Ella va a tocar el piano ma√±ana - Plan)</span></div>
                <div class="example-item">3. What <b>are</b> you <b>doing</b> now?<span class="trans">(¬øQu√© est√°s haciendo ahora? - Momento de hablar)</span></div>
                <div class="example-item">4. When <b>are</b> you <b>leaving</b>?<span class="trans">(¬øCu√°ndo te marchas? - Futuro)</span></div>
                <div class="example-item">5. Tom <b>is playing</b> football next Saturday.<span class="trans">(Tom jugar√° al f√∫tbol el pr√≥ximo s√°bado - Futuro concertado)</span></div>
            </div>
        </div>
    </section>

    <section id="adverbios" class="content-section">
        <div class="card">
            <h2>Adverbios de Tiempo</h2>
            <p>Dependiendo del uso que le demos, utilizaremos unos u otros:</p>
            <table>
                <tr><th>Para el AHORA</th><th>Para el FUTURO</th></tr>
                <tr><td>Now (Ahora)</td><td>Tomorrow (Ma√±ana)</td></tr>
                <tr><td>At the moment (En este momento)</td><td>Next week/month (La pr√≥xima semana/mes)</td></tr>
            </table>
            <div class="example-list">
                <h3>Ejemplos con Adverbios:</h3>
                <div class="example-item">1. She is watching TV <b>now</b>.<span class="trans">(Ella est√° viendo la tele ahora)</span></div>
                <div class="example-item">2. They are playing tennis <b>at the moment</b>.<span class="trans">(Ellos est√°n jugando al tenis en este momento)</span></div>
                <div class="example-item">3. I am meeting Mary <b>tomorrow</b>.<span class="trans">(Me reunir√© con Mary ma√±ana)</span></div>
                <div class="example-item">4. We are leaving <b>next Sunday</b>.<span class="trans">(Nos vamos el pr√≥ximo domingo)</span></div>
                <div class="example-item">5. Are you working <b>next week</b>?<span class="trans">(¬øTrabajas la semana que viene?)</span></div>
            </div>
        </div>
    </section>

    <section id="ortografia" class="content-section">
        <div class="card">
            <h2>Reglas de Ortograf√≠a (-ing)</h2>
            <p>Al a√±adir <b>-ing</b>, el verbo puede cambiar:</p>
            <ul>
                <li><b>Pierden la -e:</b> Write -> Writing, Love -> Loving. (Excepciones: see -> seeing, being).</li>
                <li><b>Doblan consonante:</b> Verbos cortos (1 s√≠laba) vocal + consonante: Cut -> Cutting, Stop -> Stopping, Chat -> Chatting.</li>
                <li><b>Terminados en -L:</b> Travel -> Travelling (doble L).</li>
                <li><b>Casos raros:</b> Lie -> Lying, Die -> Dying, Tie -> Tying.</li>
            </ul>
            <div class="note">‚ö†Ô∏è <b>Error com√∫n:</b> ¬°No quites la "y" en Study! Se escribe <b>Studying</b>.</div>
            <div class="example-list">
                <h3>Ejemplos de cambios:</h3>
                <div class="example-item">1. Live -> <b>Living</b><span class="trans">(Vivir -> Viviendo)</span></div>
                <div class="example-item">2. Stop -> <b>Stopping</b><span class="trans">(Parar -> Parando - Doble consonante)</span></div>
                <div class="example-item">3. Travel -> <b>Travelling</b><span class="trans">(Viajar -> Viajando)</span></div>
                <div class="example-item">4. Die -> <b>Dying</b><span class="trans">(Morir -> Muriendo)</span></div>
                <div class="example-item">5. Study -> <b>Studying</b><span class="trans">(Estudiar -> Estudiando - ¬°Mantiene la Y!)</span></div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Resumen Pr√°ctico</h2>
            <p>Repaso de las oraciones finales de LuisThree:</p>
            <div class="example-list">
                <div class="example-item">1. He <b>is watching</b> the match.<span class="trans">(√âl est√° viendo el partido)</span></div>
                <div class="example-item">2. They <b>are playing</b> tennis.<span class="trans">(Ellos est√°n jugando al tenis)</span></div>
                <div class="example-item">3. <b>When is</b> he meeting Mary?<span class="trans">(¬øCu√°ndo se reunir√° con Mary?)</span></div>
                <div class="example-item">4. Tom <b>is playing</b> football next Saturday.<span class="trans">(Tom jugar√° al f√∫tbol el s√°bado pr√≥ximo)</span></div>
                <div class="example-item">5. <b>What are</b> you doing now?<span class="trans">(¬øQu√© est√°s haciendo ahora?)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Present Continuous</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øQu√© auxiliar usamos para 'You'?", o: ["Am", "Is", "Are"], c: 2 },
        { q: "¬øC√≥mo se escribe el gerundio de 'Study'?", o: ["Studing", "Studying", "Studiing"], c: 1 },
        { q: "Si digo 'I am leaving tomorrow', me refiero a...", o: ["Ahora mismo", "Un plan futuro", "El pasado"], c: 1 },
        { q: "¬øQu√© pasa con la 'e' en 'Write' al a√±adir -ing?", o: ["Se mantiene", "Desaparece", "Se dobla"], c: 1 },
        { q: "¬øC√≥mo se pregunta '¬øQu√© est√°s haciendo?'?", o: ["What you are doing?", "What are you doing?", "What doing are you?"], c: 1 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Hecho! üå∏";
            div.innerHTML = "<p>Has dominado el Presente Continuo con LuisThree.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Revisa las reglas del verbo To Be + ING."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>

<template id="pcAppendDoc">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastering Past Continuous - LuisThree Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #10b981; --secondary: #059669; --bg: #0f172a;
            --card-bg: #1e293b; --text: #f8fafc; --accent: #6ee7b7;
            --success: #22c55e; --error: #ef4444; --warning: #f59e0b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.8; }
        .container { max-width: 1100px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 15px; overflow: hidden; margin-bottom: 25px; border: 3px solid var(--primary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding: 10px 5px; scrollbar-width: thin; }
        .tab-btn { background: var(--card-bg); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
        .tab-btn.active { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 15px rgba(16, 185, 129, 0.6); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: var(--accent); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { color: var(--accent); margin: 25px 0 10px 0; font-size: 1.3rem; }

        .example-list { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .example-item { background: #0b0f1a; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid var(--primary); font-family: 'Courier New', monospace; font-size: 1rem; color: #ecfdf5; }
        .trans { display: block; font-family: 'Poppins', sans-serif; color: #94a3b8; font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        .note { background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--primary); padding: 15px; margin: 20px 0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: left; }
        th { background: var(--secondary); }

        .quiz-option { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .quiz-option:hover { background: rgba(16, 185, 129, 0.2); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mastering Past Continuous</h1>
        <p>Tutorial de Pasado Continuo - LuisThree Edition</p>
    </header>

    <div class="video-wrapper">
        <iframe src="https://www.youtube.com/embed/KlMARiyvJck" frameborder="0" allowfullscreen></iframe>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'estructura')">1. Estructura</button>
        <button class="tab-btn" onclick="openTab(event, 'uso')">2. Uso: When & While</button>
        <button class="tab-btn" onclick="openTab(event, 'respuestas')">3. Respuestas Cortas</button>
        <button class="tab-btn" onclick="openTab(event, 'ejemplos')">4. Pr√°ctica de Oraciones</button>
        <button class="tab-btn" onclick="openTab(event, 'quiz')">üî• Examen</button>
    </nav>

    <section id="estructura" class="content-section active">
        <div class="card">
            <h2>Estructura del Pasado Continuo</h2>
            <p>Para formar este tiempo necesitamos el pasado del verbo <b>To Be</b> (Was/Were) y el verbo principal con la terminaci√≥n <b>-ing</b>.</p>
            <table>
                <tr><th>Sujeto</th><th>Verbo To Be</th></tr>
                <tr><td>I, He, She, It</td><td><b>Was</b></td></tr>
                <tr><td>You, We, They</td><td><b>Were</b></td></tr>
            </table>
            <div class="example-list">
                <h3>Ejemplos de Estructura:</h3>
                <div class="example-item">1. You <b>were watching</b> TV.<span class="trans">(T√∫ estabas viendo la tele)</span></div>
                <div class="example-item">2. She <b>was playing</b> chess.<span class="trans">(Ella estaba jugando al ajedrez)</span></div>
                <div class="example-item">3. I <b>wasn't studying</b> English.<span class="trans">(No estaba estudiando ingl√©s - Negativa)</span></div>
                <div class="example-item">4. <b>Were</b> you <b>making</b> lunch?<span class="trans">(¬øEstabas preparando la comida? - Interrogativa)</span></div>
                <div class="example-item">5. We <b>were studying</b> when mom came.<span class="trans">(Est√°bamos estudiando cuando mam√° vino)</span></div>
            </div>
        </div>
    </section>

    <section id="uso" class="content-section">
        <div class="card">
            <h2>Uso de When y While</h2>
            <p>Este tiempo se usa para describir el proceso de una acci√≥n en el pasado. Es muy com√∫n usar nexos para unir frases:</p>
            <ul>
                <li><b>When (Cuando):</b> Suele unir una acci√≥n continua con una acci√≥n puntual (Past Simple).</li>
                <li><b>While (Mientras):</b> Suele unir dos acciones que ocurr√≠an al mismo tiempo.</li>
            </ul>
            <div class="note">üí° <b>LuisThree dice:</b> Con <i>While</i>, ambas acciones suelen ir en Pasado Continuo. Con <i>When</i>, una interrumpe a la otra.</div>
            <div class="example-list">
                <h3>Ejemplos con Nexos:</h3>
                <div class="example-item">1. I was watching TV <b>when</b> my father arrived.<span class="trans">(Estaba viendo la tele cuando mi padre lleg√≥)</span></div>
                <div class="example-item">2. <b>While</b> I was sleeping, she was washing the car.<span class="trans">(Mientras yo dorm√≠a, ella lavaba el coche)</span></div>
                <div class="example-item">3. I was ironing <b>while</b> she was writing an email.<span class="trans">(Yo estaba planchando mientras ella escrib√≠a un email)</span></div>
                <div class="example-item">4. We were studying <b>when</b> the phone rang.<span class="trans">(Est√°bamos estudiando cuando el tel√©fono son√≥)</span></div>
                <div class="example-item">5. What was he doing <b>when</b> you saw him?<span class="trans">(¬øQu√© estaba haciendo √©l cuando lo viste?)</span></div>
            </div>
        </div>
    </section>

    <section id="respuestas" class="content-section">
        <div class="card">
            <h2>Respuestas Cortas (Short Answers)</h2>
            <p>Es importante fijarse en el cambio de sujeto al responder una pregunta directa.</p>
            <div class="example-list">
                <h3>Ejemplos de Di√°logo:</h3>
                <div class="example-item">Q: Were you watching TV? <br>A: <b>Yes, I was</b> / <b>No, I wasn't</b>.</div>
                <div class="example-item">Q: Was she playing chess? <br>A: <b>Yes, she was</b> / <b>No, she wasn't</b>.</div>
                <div class="example-item">Q: Were they working? <br>A: <b>Yes, they were</b> / <b>No, they weren't</b>.</div>
                <div class="example-item">Q: Was it raining? <br>A: <b>Yes, it was</b> / <b>No, it wasn't</b>.</div>
                <div class="example-item">Q: Were we sleeping? <br>A: <b>Yes, we were</b> / <b>No, we weren't</b>.</div>
            </div>
        </div>
    </section>

    <section id="ejemplos" class="content-section">
        <div class="card">
            <h2>Pr√°ctica Combinada</h2>
            <p>M√°s oraciones del tutorial para consolidar el aprendizaje:</p>
            <div class="example-list">
                <div class="example-item">1. She <b>was reading</b> a book.<span class="trans">(Ella estaba leyendo un libro)</span></div>
                <div class="example-item">2. <b>What were</b> you doing at 8 o'clock?<span class="trans">(¬øQu√© estabas haciendo a las 8 en punto?)</span></div>
                <div class="example-item">3. <b>Where was</b> she going?<span class="trans">(¬øA d√≥nde estaba yendo ella?)</span></div>
                <div class="example-item">4. He <b>wasn't studying</b> English yesterday.<span class="trans">(√âl no estaba estudiando ingl√©s ayer)</span></div>
                <div class="example-item">5. <b>Was she playing</b> chess when you arrived?<span class="trans">(¬øEstaba ella jugando al ajedrez cuando llegaste?)</span></div>
            </div>
        </div>
    </section>

    <section id="quiz" class="content-section">
        <div class="card">
            <h2 id="qText">Examen de Pasado Continuo</h2>
            <div id="options"></div>
            <p id="res" style="margin-top:15px; font-weight:bold;"></p>
            <button id="nBtn" class="tab-btn" style="display:none; margin-top:15px;" onclick="loadQ()">Siguiente</button>
        </div>
    </section>
</div>

<script>
    function openTab(evt, name) {
        let i, content, btn;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active");
        btn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < btn.length; i++) btn[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
        window.scrollTo({top: 450, behavior: 'smooth'});
    }

    const quiz = [
        { q: "¬øCu√°l es el pasado de 'To Be' para 'She'?", o: ["Were", "Was", "Wasn't -ing"], c: 1 },
        { q: "¬øQu√© nexo se usa para unir dos acciones paralelas continuas?", o: ["When", "While", "Then"], c: 1 },
        { q: "¬øC√≥mo se dice 'Yo no estaba estudiando'?", o: ["I wasn't study", "I weren't studying", "I wasn't studying"], c: 2 },
        { q: "En la frase 'I was sleeping when...', ¬øqu√© tiempo sigue?", o: ["Past Continuous", "Past Simple", "Present Simple"], c: 1 },
        { q: "¬øCu√°l es la respuesta corta correcta a 'Were you watching TV'?", o: ["Yes, I were", "Yes, I was", "Yes, you were"], c: 1 }
    ];

    let cur = 0;
    function loadQ() {
        const div = document.getElementById('options');
        const txt = document.getElementById('qText');
        const res = document.getElementById('res');
        const btn = document.getElementById('nBtn');
        if(cur >= quiz.length) {
            txt.innerText = "¬°Excelente! üèÜ";
            div.innerHTML = "<p>Has completado el repaso del Past Continuous.</p>";
            res.innerText = ""; btn.style.display = 'none'; return;
        }
        txt.innerText = `${cur+1}. ${quiz[cur].q}`;
        div.innerHTML = ""; res.innerText = ""; btn.style.display = 'none';
        quiz[cur].o.forEach((o, i) => {
            const d = document.createElement('div');
            d.className = 'quiz-option'; d.innerText = o;
            d.onclick = () => {
                if(i === quiz[cur].c) { d.style.background = "#22c55e"; res.innerText = "¬°Correcto! ‚ú®"; }
                else { d.style.background = "#ef4444"; res.innerText = "Error. Recuerda: Was/Were + ING."; }
                Array.from(div.children).forEach(c => c.style.pointerEvents = 'none');
                cur++; btn.style.display = 'block';
            };
            div.appendChild(d);
        });
    }
    loadQ();
</script>
</body>
</html>
</template>
<script>
/* =========================================================
   DATOS (TD) ‚Äî 12 tiempos verbales
========================================================= */
const TD = {
  prs:{
    n:"Present Simple",z:"PRESENTE",c:"--pres",c2:"--pres2",
    f:"S + V1 (s/es) + O/C",
    uso:[
      {ico:"‚è±Ô∏è",ti:"Rutinas y h√°bitos",desc:"Para cosas que haces normalmente o con frecuencia.",en:"I play soccer every day.",es:"Yo juego f√∫tbol cada d√≠a."},
      {ico:"‚úÖ",ti:"Hechos y verdades",desc:"Para hechos generales (verdades) y situaciones estables.",en:"Water boils at 100¬∞C.",es:"El agua hierve a 100¬∞C."},
      {ico:"üìÖ",ti:"Horarios",desc:"Para horarios y programaciones (buses, clases, etc.).",en:"The class starts at 7:00.",es:"La clase empieza a las 7:00."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V1 (o V1+s/es)"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Con He/She/It se usa V1 + s/es (plays, goes, watches)."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"do/does"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V1"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Con He/She/It: does + V1 (He does not play)."}],
      int:[{chips:[{k:"aux",t:"Do/Does"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V1"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Do/Does al inicio (Do you play?)."}]
    },
    adverbs:{
      "Frecuencia (Frequency)":[
        {w:"always",e:"siempre",pos:"freq"},{w:"usually",e:"usualmente",pos:"freq"},
        {w:"often",e:"a menudo",pos:"freq"},{w:"sometimes",e:"a veces",pos:"freq"},
        {w:"rarely",e:"rara vez",pos:"freq"},{w:"never",e:"nunca",pos:"freq"}
      ],
      "Marcadores de tiempo":[
        {w:"every day",e:"cada d√≠a",pos:"end"},{w:"on Mondays",e:"los lunes",pos:"end"},
        {w:"in the morning",e:"en la ma√±ana",pos:"end"},{w:"at night",e:"en la noche",pos:"end"},
        {w:"once a week",e:"una vez a la semana",pos:"end"},{w:"twice a month",e:"dos veces al mes",pos:"end"}
      ]
    }
  },
  prc:{
    n:"Present Continuous",z:"PRESENTE",c:"--pres",c2:"--pres2",
    f:"S + am/is/are + V-ing + O/C",
    uso:[
      {ico:"üîµ",ti:"Ahora mismo",desc:"Para acciones que est√°n pasando en este momento.",en:"She is studying right now.",es:"Ella est√° estudiando ahora mismo."},
      {ico:"üìà",ti:"Temporal",desc:"Para situaciones temporales (estos d√≠as, esta semana).",en:"I am working this week.",es:"Yo estoy trabajando esta semana."},
      {ico:"üóìÔ∏è",ti:"Plan cercano",desc:"Para planes ya acordados (futuro cercano).",en:"We are meeting tomorrow.",es:"Nosotros nos reunimos ma√±ana (ya est√° planeado)."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"am/is/are"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Usa am (I), is (He/She/It) o are (You/We/They)."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"am/is/are"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: am/is/are + not."}],
      int:[{chips:[{k:"aux",t:"Am/Is/Are"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Am/Is/Are al inicio (Are you studying?)."}]
    },
    adverbs:{
      "En progreso":[{w:"currently",e:"actualmente",pos:"mid"},{w:"still",e:"todav√≠a",pos:"mid"}],
      "Marcadores de tiempo":[
        {w:"now",e:"ahora",pos:"end"},{w:"right now",e:"ahora mismo",pos:"end"},
        {w:"at the moment",e:"en este momento",pos:"end"},{w:"today",e:"hoy",pos:"end"},
        {w:"this week",e:"esta semana",pos:"end"},{w:"these days",e:"por estos d√≠as",pos:"end"}
      ]
    }
  },
  prp:{
    n:"Present Perfect",z:"PRESENTE",c:"--pres",c2:"--pres2",
    f:"S + have/has + V3 + O/C",
    uso:[
      {ico:"‚≠ê",ti:"Experiencia",desc:"Para hablar de experiencias (sin decir cu√°ndo).",en:"I have been to Bogot√°.",es:"Yo he estado en Bogot√°."},
      {ico:"‚úÖ",ti:"Resultado ahora",desc:"Algo pas√≥ antes y el resultado se nota ahora.",en:"She has lost her keys.",es:"Ella ha perdido sus llaves."},
      {ico:"üïí",ti:"Tiempo no espec√≠fico",desc:"No importa la fecha exacta; importa la acci√≥n.",en:"We have finished the project.",es:"Nosotros hemos terminado el proyecto."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have/has"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V3"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Con He/She/It usa has (He has eaten)."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have/has"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V3"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: have/has + not."}],
      int:[{chips:[{k:"aux",t:"Have/Has"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V3"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Have/Has al inicio (Have you eaten?)."}]
    },
    adverbs:{
      "Adverbios t√≠picos":[
        {w:"already",e:"ya",pos:"perf"},{w:"just",e:"acab(a) de",pos:"perf"},
        {w:"yet",e:"todav√≠a (en neg/preg)",pos:"perf"},{w:"ever",e:"alguna vez",pos:"perf"},
        {w:"never",e:"nunca",pos:"perf"}
      ],
      "Tiempo y duraci√≥n":[
        {w:"recently",e:"recientemente",pos:"end"},{w:"lately",e:"√∫ltimamente",pos:"end"},
        {w:"so far",e:"hasta ahora",pos:"end"},
        {w:"for",e:"durante‚Ä¶",pos:"end"},{w:"since",e:"desde‚Ä¶",pos:"end"}
      ]
    }
  },
  prpc:{
    n:"Present Perfect Continuous",z:"PRESENTE",c:"--pres",c2:"--pres2",
    f:"S + have/has + been + V-ing + O/C",
    uso:[
      {ico:"üîÅ",ti:"Acci√≥n que contin√∫a",desc:"Empez√≥ en el pasado y sigue ahora.",en:"I have been studying for 2 hours.",es:"Yo he estado estudiando durante 2 horas."},
      {ico:"‚è≥",ti:"Duraci√≥n",desc:"Enfoca el tiempo que dura la acci√≥n.",en:"She has been working since Monday.",es:"Ella ha estado trabajando desde el lunes."},
      {ico:"üòÆ",ti:"Evidencia",desc:"Acci√≥n reciente con evidencia (cansancio, sudor, etc.).",en:"They have been running.",es:"Ellos han estado corriendo."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have/has"},{k:"arr",t:"‚Üí"},{k:"aux",t:"been"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"have/has + been + V-ing (I have been‚Ä¶)."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have/has"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"aux",t:"been"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: have/has + not + been + V-ing."}],
      int:[{chips:[{k:"aux",t:"Have/Has"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"been"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Have/Has al inicio (Have you been working?)."}]
    },
    adverbs:{
      "Duraci√≥n":[
        {w:"for",e:"durante‚Ä¶",pos:"end"},{w:"since",e:"desde‚Ä¶",pos:"end"},
        {w:"all day",e:"todo el d√≠a",pos:"end"},{w:"all week",e:"toda la semana",pos:"end"}
      ],
      "Reciente":[
        {w:"recently",e:"recientemente",pos:"end"},{w:"lately",e:"√∫ltimamente",pos:"end"},
        {w:"just",e:"acab(a) de",pos:"perf"}
      ]
    }
  },
  ps:{
    n:"Past Simple",z:"PASADO",c:"--past",c2:"--past2",
    f:"S + V2 + O/C",
    uso:[
      {ico:"üìå",ti:"Acci√≥n terminada",desc:"Algo que pas√≥ y termin√≥ en el pasado.",en:"I visited my grandma yesterday.",es:"Yo visit√© a mi abuela ayer."},
      {ico:"üìö",ti:"Historia / narrativa",desc:"Para contar historias y acciones en secuencia.",en:"He arrived, opened the door, and sat down.",es:"√âl lleg√≥, abri√≥ la puerta y se sent√≥."},
      {ico:"üóìÔ∏è",ti:"Fecha definida",desc:"Cuando dices cu√°ndo pas√≥ (ayer, en 2019‚Ä¶).",en:"We played in 2019.",es:"Nosotros jugamos en 2019."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V2"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"V2 puede ser regular (-ed) o irregular (went, ate, wrote)."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"did"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V1"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Con did, el verbo vuelve a V1 (did not go)."}],
      int:[{chips:[{k:"aux",t:"Did"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V1"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Did al inicio (Did you go?)."}]
    },
    adverbs:{
      "Marcadores de tiempo":[
        {w:"yesterday",e:"ayer",pos:"end"},{w:"last night",e:"anoche",pos:"end"},
        {w:"last week",e:"la semana pasada",pos:"end"},{w:"in 2019",e:"en 2019",pos:"end"},
        {w:"ago",e:"hace‚Ä¶",pos:"end"}
      ]
    }
  },
  pc:{
    n:"Past Continuous",z:"PASADO",c:"--past",c2:"--past2",
    f:"S + was/were + V-ing + O/C",
    uso:[
      {ico:"üé¨",ti:"En progreso",desc:"Acci√≥n en progreso en un momento del pasado.",en:"I was studying at 8 pm.",es:"Yo estaba estudiando a las 8 pm."},
      {ico:"‚ö°",ti:"Interrupci√≥n",desc:"Una acci√≥n en progreso cuando otra pasa.",en:"She was cooking when I arrived.",es:"Ella estaba cocinando cuando yo llegu√©."},
      {ico:"üîÑ",ti:"Dos acciones",desc:"Dos acciones simult√°neas (while).",en:"We were studying while they were playing.",es:"Est√°bamos estudiando mientras ellos jugaban."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"was/were"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"was (I/He/She/It), were (You/We/They)."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"was/were"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: was/were + not."}],
      int:[{chips:[{k:"aux",t:"Was/Were"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Was/Were al inicio (Were you studying?)."}]
    },
    adverbs:{
      "En progreso":[{w:"still",e:"todav√≠a",pos:"mid"}],
      "Marcadores de tiempo":[
        {w:"at 8 pm",e:"a las 8 pm",pos:"end"},{w:"yesterday at this time",e:"ayer a esta hora",pos:"end"},
        {w:"when",e:"cuando‚Ä¶",pos:"end"},{w:"while",e:"mientras‚Ä¶",pos:"end"},{w:"as",e:"mientras / cuando‚Ä¶",pos:"end"}
      ]
    }
  },
  pp:{
    n:"Past Perfect",z:"PASADO",c:"--past",c2:"--past2",
    f:"S + had + V3 + O/C",
    uso:[
      {ico:"üß©",ti:"Un pasado antes de otro",desc:"Algo pas√≥ antes que otra cosa en el pasado.",en:"I had left before he arrived.",es:"Yo me hab√≠a ido antes de que √©l llegara."},
      {ico:"üï∞Ô∏è",ti:"Para cuando‚Ä¶",desc:"Muy com√∫n con 'by the time'.",en:"She had finished by the time we arrived.",es:"Ella hab√≠a terminado para cuando llegamos."},
      {ico:"‚úÖ",ti:"Resultado previo",desc:"El resultado ya estaba listo en ese pasado.",en:"They had already eaten.",es:"Ellos ya hab√≠an comido."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"had"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V3"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Siempre es had para todos los pronombres."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"had"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V3"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: had + not."}],
      int:[{chips:[{k:"aux",t:"Had"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V3"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Had al inicio (Had you eaten?)."}]
    },
    adverbs:{
      "Adverbios t√≠picos":[{w:"already",e:"ya",pos:"perf"},{w:"just",e:"acab(a) de",pos:"perf"}],
      "Conectores / tiempo":[
        {w:"before",e:"antes",pos:"end"},{w:"by the time",e:"para cuando‚Ä¶",pos:"end"},{w:"when",e:"cuando‚Ä¶",pos:"end"}
      ]
    }
  },
  ppc:{
    n:"Past Perfect Continuous",z:"PASADO",c:"--past",c2:"--past2",
    f:"S + had + been + V-ing + O/C",
    uso:[
      {ico:"‚è≥",ti:"Duraci√≥n antes de otro pasado",desc:"Algo dur√≥ un tiempo antes de un evento pasado.",en:"I had been studying for 2 hours before the test.",es:"Yo hab√≠a estado estudiando 2 horas antes del examen."},
      {ico:"üòÆ",ti:"Evidencia en el pasado",desc:"En ese momento del pasado hab√≠a se√±ales de la acci√≥n.",en:"He was tired because he had been running.",es:"√âl estaba cansado porque hab√≠a estado corriendo."},
      {ico:"üìç",ti:"for / since",desc:"Muy com√∫n con for/since para duraci√≥n.",en:"They had been working since Monday.",es:"Ellos hab√≠an estado trabajando desde el lunes."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"had"},{k:"arr",t:"‚Üí"},{k:"aux",t:"been"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"had + been + V-ing."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"had"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"aux",t:"been"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: had + not + been + V-ing."}],
      int:[{chips:[{k:"aux",t:"Had"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"been"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Had al inicio (Had you been working?)."}]
    },
    adverbs:{
      "Duraci√≥n":[{w:"for",e:"durante‚Ä¶",pos:"end"},{w:"since",e:"desde‚Ä¶",pos:"end"},{w:"already",e:"ya",pos:"perf"}],
      "Conectores":[{w:"before",e:"antes",pos:"end"},{w:"by the time",e:"para cuando‚Ä¶",pos:"end"}]
    }
  },
  fs:{
    n:"Future Simple",z:"FUTURO",c:"--fut",c2:"--fut2",
    f:"S + will + V1 + O/C",
    uso:[
      {ico:"üîÆ",ti:"Predicciones",desc:"Para predecir algo (crees que pasar√°).",en:"It will rain tomorrow.",es:"Va a llover ma√±ana."},
      {ico:"ü§ù",ti:"Promesas / decisiones",desc:"Para prometer o decidir en el momento.",en:"I will help you.",es:"Te ayudar√©."},
      {ico:"‚è≤Ô∏è",ti:"Hechos futuros",desc:"Para hechos del futuro en general.",en:"We will start next week.",es:"Empezaremos la pr√≥xima semana."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"will"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V1"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Will es igual para todos los pronombres."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"will"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V1"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: will + not (won't)."}],
      int:[{chips:[{k:"aux",t:"Will"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V1"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Will al inicio (Will you go?)."}]
    },
    adverbs:{
      "Probabilidad":[
        {w:"probably",e:"probablemente",pos:"will"},{w:"definitely",e:"definitivamente",pos:"will"},{w:"maybe",e:"tal vez",pos:"will"}
      ],
      "Marcadores de tiempo":[
        {w:"tomorrow",e:"ma√±ana",pos:"end"},{w:"next week",e:"la pr√≥xima semana",pos:"end"},
        {w:"in 2030",e:"en 2030",pos:"end"},{w:"soon",e:"pronto",pos:"end"}
      ]
    }
  },
  fc:{
    n:"Future Continuous",z:"FUTURO",c:"--fut",c2:"--fut2",
    f:"S + will + be + V-ing + O/C",
    uso:[
      {ico:"‚è≥",ti:"En progreso en el futuro",desc:"Acci√≥n que estar√° pasando en un momento futuro.",en:"I will be studying at 8 pm.",es:"Yo estar√© estudiando a las 8 pm."},
      {ico:"üïí",ti:"This time tomorrow",desc:"Muy com√∫n con 'this time tomorrow'.",en:"This time tomorrow, we will be traveling.",es:"A esta hora ma√±ana, estaremos viajando."},
      {ico:"üôÇ",ti:"Pregunta educada",desc:"Para preguntar por planes de forma suave.",en:"Will you be using the computer tonight?",es:"¬øVas a usar el computador esta noche?"}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"will"},{k:"arr",t:"‚Üí"},{k:"aux",t:"be"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"will + be + V-ing."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"will"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"aux",t:"be"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: will + not + be + V-ing."}],
      int:[{chips:[{k:"aux",t:"Will"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"be"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Will al inicio (Will you be studying?)."}]
    },
    adverbs:{
      "Probabilidad":[{w:"probably",e:"probablemente",pos:"will"},{w:"definitely",e:"definitivamente",pos:"will"}],
      "Marcadores de tiempo":[
        {w:"this time tomorrow",e:"a esta hora ma√±ana",pos:"end"},
        {w:"at 8 pm tomorrow",e:"a las 8 pm ma√±ana",pos:"end"},
        {w:"next year at this time",e:"el pr√≥ximo a√±o a esta hora",pos:"end"}
      ]
    }
  },
  fp:{
    n:"Future Perfect",z:"FUTURO",c:"--fut",c2:"--fut2",
    f:"S + will + have + V3 + O/C",
    uso:[
      {ico:"‚úÖ",ti:"Terminado antes de un punto futuro",desc:"La acci√≥n estar√° completada antes de una hora/fecha futura.",en:"I will have finished by 5 pm.",es:"Yo habr√© terminado para las 5 pm."},
      {ico:"üéØ",ti:"Metas",desc:"√ötil para metas con fecha l√≠mite.",en:"She will have saved enough by June.",es:"Ella habr√° ahorrado suficiente para junio."},
      {ico:"üï∞Ô∏è",ti:"By the time‚Ä¶",desc:"Muy com√∫n con 'by the time'.",en:"By the time you arrive, we will have eaten.",es:"Para cuando llegues, ya habremos comido."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"will"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V3"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"will + have + V3."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"will"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V3"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: will + not + have + V3."}],
      int:[{chips:[{k:"aux",t:"Will"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V3"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Will al inicio (Will you have finished?)."}]
    },
    adverbs:{
      "Probabilidad":[{w:"probably",e:"probablemente",pos:"will"},{w:"definitely",e:"definitivamente",pos:"will"}],
      "Adverbios t√≠picos":[{w:"already",e:"ya",pos:"perf"},{w:"just",e:"acab(a) de",pos:"perf"}],
      "Marcadores de tiempo":[
        {w:"by 5 pm",e:"para las 5 pm",pos:"end"},{w:"by next year",e:"para el pr√≥ximo a√±o",pos:"end"},
        {w:"by the time",e:"para cuando‚Ä¶",pos:"end"}
      ]
    }
  },
  fpc:{
    n:"Future Perfect Continuous",z:"FUTURO",c:"--fut",c2:"--fut2",
    f:"S + will + have been + V-ing + O/C",
    uso:[
      {ico:"üïí",ti:"Duraci√≥n hasta un punto futuro",desc:"Enfoca cu√°nto tiempo habr√° durado una acci√≥n.",en:"By 5 pm, I will have been studying for 3 hours.",es:"Para las 5 pm, yo habr√© estado estudiando durante 3 horas."},
      {ico:"üìà",ti:"Progreso",desc:"Destaca el proceso y la continuidad.",en:"She will have been working since Monday.",es:"Ella habr√° estado trabajando desde el lunes."},
      {ico:"üß†",ti:"for / since + by‚Ä¶",desc:"Muy com√∫n con for/since + 'by‚Ä¶'",en:"They will have been training for months.",es:"Ellos habr√°n estado entrenando por meses."}
    ],
    aux:{
      af: [{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"will"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have been"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"will + have been + V-ing."}],
      neg:[{chips:[{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"will"},{k:"arr",t:"‚Üí"},{k:"neg",t:"not"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have been"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement"}], note:"Negaci√≥n: will + not + have been + V-ing."}],
      int:[{chips:[{k:"aux",t:"Will"},{k:"arr",t:"‚Üí"},{k:"subj",t:"Subject"},{k:"arr",t:"‚Üí"},{k:"aux",t:"have been"},{k:"arr",t:"‚Üí"},{k:"verb",t:"V-ing"},{k:"arr",t:"‚Üí"},{k:"obj",t:"Object/Complement ?"}], note:"Pregunta: Will al inicio (Will you have been working?)."}]
    },
    adverbs:{
      "Probabilidad":[{w:"probably",e:"probablemente",pos:"will"}],
      "Adverbios t√≠picos":[{w:"already",e:"ya",pos:"perf"}],
      "Duraci√≥n / tiempo":[
        {w:"for",e:"durante‚Ä¶",pos:"end"},{w:"since",e:"desde‚Ä¶",pos:"end"},
        {w:"by next year",e:"para el pr√≥ximo a√±o",pos:"end"},{w:"by the time",e:"para cuando‚Ä¶",pos:"end"}
      ]
    }
  }
};

/* =========================================================
   VERBOS IRREGULARES (ampliado)
========================================================= */
const IRR = {
  be:["be","was/were","been","ser / estar"],
  have:["have","had","had","tener"],
  do:["do","did","done","hacer"],
  go:["go","went","gone","ir"],
  say:["say","said","said","decir"],
  get:["get","got","got","obtener / conseguir"],
  make:["make","made","made","hacer / crear"],
  know:["know","knew","known","saber / conocer"],
  think:["think","thought","thought","pensar / creer"],
  take:["take","took","taken","tomar / llevar"],
  see:["see","saw","seen","ver"],
  come:["come","came","come","venir"],
  find:["find","found","found","encontrar"],
  give:["give","gave","given","dar"],
  tell:["tell","told","told","decir / contar"],
  keep:["keep","kept","kept","guardar / mantener"],
  let:["let","let","let","dejar / permitir"],
  begin:["begin","began","begun","comenzar / empezar"],
  show:["show","showed","shown","mostrar"],
  hear:["hear","heard","heard","escuchar / o√≠r"],
  run:["run","ran","run","correr"],
  hold:["hold","held","held","sostener / aguantar"],
  bring:["bring","brought","brought","traer"],
  write:["write","wrote","written","escribir"],
  stand:["stand","stood","stood","estar de pie / soportar"],
  lose:["lose","lost","lost","perder"],
  pay:["pay","paid","paid","pagar"],
  meet:["meet","met","met","conocer / reunirse"],
  sit:["sit","sat","sat","sentarse"],
  speak:["speak","spoke","spoken","hablar"],
  lead:["lead","led","led","liderar / guiar"],
  read:["read","read","read","leer"],
  grow:["grow","grew","grown","crecer / cultivar"],
  spend:["spend","spent","spent","gastar / pasar tiempo"],
  fall:["fall","fell","fallen","caer"],
  send:["send","sent","sent","enviar / mandar"],
  build:["build","built","built","construir"],
  understand:["understand","understood","understood","entender / comprender"],
  draw:["draw","drew","drawn","dibujar"],
  break:["break","broke","broken","romper / quebrar"],
  buy:["buy","bought","bought","comprar"],
  wear:["wear","wore","worn","usar / llevar puesto"],
  choose:["choose","chose","chosen","elegir / escoger"],
  cut:["cut","cut","cut","cortar"],
  put:["put","put","put","poner / colocar"],
  eat:["eat","ate","eaten","comer"],
  drink:["drink","drank","drunk","beber / tomar"],
  drive:["drive","drove","driven","conducir / manejar"],
  fly:["fly","flew","flown","volar"],
  hide:["hide","hid","hidden","esconder / ocultar"],
  hit:["hit","hit","hit","golpear / pegar"],
  hurt:["hurt","hurt","hurt","herir / doler"],
  leave:["leave","left","left","salir / dejar / irse"],
  lend:["lend","lent","lent","prestar"],
  mean:["mean","meant","meant","significar / querer decir"],
  quit:["quit","quit","quit","renunciar / dejar de"],
  ride:["ride","rode","ridden","montar / cabalgar"],
  ring:["ring","rang","rung","sonar / llamar por tel√©fono"],
  rise:["rise","rose","risen","subir / surgir / levantarse"],
  sell:["sell","sold","sold","vender"],
  shoot:["shoot","shot","shot","disparar"],
  shut:["shut","shut","shut","cerrar"],
  sing:["sing","sang","sung","cantar"],
  sleep:["sleep","slept","slept","dormir"],
  steal:["steal","stole","stolen","robar"],
  swim:["swim","swam","swum","nadar"],
  teach:["teach","taught","taught","ense√±ar"],
  throw:["throw","threw","thrown","lanzar / tirar"],
  wake:["wake","woke","woken","despertar"],
  win:["win","won","won","ganar"],
  catch:["catch","caught","caught","atrapar / coger"],
  feel:["feel","felt","felt","sentir / sentirse"],
  fight:["fight","fought","fought","pelear / luchar"],
  forget:["forget","forgot","forgotten","olvidar"],
  freeze:["freeze","froze","frozen","congelar / helarse"],
  hang:["hang","hung","hung","colgar"],
  lay:["lay","laid","laid","poner / colocar objetos"],
  shine:["shine","shone","shone","brillar"],
  stick:["stick","stuck","stuck","pegar / adherir"],
  bite:["bite","bit","bitten","morder"],
  /* Nuevos en v8 */
  blow:["blow","blew","blown","soplar"],
  bear:["bear","bore","born","soportar / dar a luz"],
  beat:["beat","beat","beaten","golpear / vencer"],
  bend:["bend","bent","bent","doblar / curvar"],
  bind:["bind","bound","bound","atar / vincular"],
  bleed:["bleed","bled","bled","sangrar"],
  breed:["breed","bred","bred","criar / reproducirse"],
  burn:["burn","burnt","burnt","quemar / arder"],
  burst:["burst","burst","burst","estallar / reventar"],
  cast:["cast","cast","cast","lanzar / proyectar"],
  cling:["cling","clung","clung","aferrarse / adherirse"],
  creep:["creep","crept","crept","arrastrarse / escabullirse"],
  deal:["deal","dealt","dealt","tratar / repartir"],
  dig:["dig","dug","dug","cavar / excavar"],
  dream:["dream","dreamt","dreamt","so√±ar"],
  feed:["feed","fed","fed","alimentar / dar de comer"],
  flee:["flee","fled","fled","huir / escapar"],
  fling:["fling","flung","flung","lanzar con fuerza"],
  forbid:["forbid","forbade","forbidden","prohibir"],
  forgive:["forgive","forgave","forgiven","perdonar"],
  grind:["grind","ground","ground","moler / triturar"],
  kneel:["kneel","knelt","knelt","arrodillarse"],
  lean:["lean","leant","leant","inclinarse / apoyarse"],
  leap:["leap","leapt","leapt","saltar"],
  learn:["learn","learnt","learnt","aprender"],
  light:["light","lit","lit","encender / iluminar"],
  mistake:["mistake","mistook","mistaken","confundir / equivocarse"],
  overcome:["overcome","overcame","overcome","superar / vencer"],
  overtake:["overtake","overtook","overtaken","adelantar / sobrepasar"],
  prove:["prove","proved","proven","probar / demostrar"],
  rebuild:["rebuild","rebuilt","rebuilt","reconstruir"],
  seek:["seek","sought","sought","buscar"],
  set:["set","set","set","poner / establecer"],
  shed:["shed","shed","shed","derramar / desprenderse"],
  shrink:["shrink","shrank","shrunk","encoger"],
  sink:["sink","sank","sunk","hundirse"],
  slide:["slide","slid","slid","deslizarse"],
  smell:["smell","smelt","smelt","oler"],
  spell:["spell","spelt","spelt","deletrear"],
  spill:["spill","spilt","spilt","derramar"],
  spit:["spit","spat","spat","escupir"],
  split:["split","split","split","dividir / partir"],
  spoil:["spoil","spoilt","spoilt","arruinar / mimar"],
  spread:["spread","spread","spread","extender / difundir"],
  spring:["spring","sprang","sprung","saltar / brotar"],
  swear:["swear","swore","sworn","jurar / maldecir"],
  sweep:["sweep","swept","swept","barrer"],
  swing:["swing","swung","swung","balancearse"],
  tear:["tear","tore","torn","rasgar / desgarrar"],
  tread:["tread","trod","trodden","pisar"],
  undergo:["undergo","underwent","undergone","someterse / pasar por"],
  upset:["upset","upset","upset","molestar / trastornar"],
  weave:["weave","wove","woven","tejer"],
  weep:["weep","wept","wept","llorar"],
  withdraw:["withdraw","withdrew","withdrawn","retirar / retirarse"],
  wring:["wring","wrung","wrung","retorcer / estrujar"],
};

/* Verbos regulares con traducci√≥n (ampliado) */
const REG_ESP = {
  play:"jugar / tocar (instrumento)",work:"trabajar",talk:"hablar",walk:"caminar",
  call:"llamar",open:"abrir",close:"cerrar",start:"empezar / iniciar",
  stop:"parar / dejar de",finish:"terminar / acabar",help:"ayudar",
  ask:"preguntar / pedir",answer:"responder / contestar",clean:"limpiar",
  cook:"cocinar",dance:"bailar",jump:"saltar",kick:"patear",
  listen:"escuchar",live:"vivir",love:"amar / querer",look:"mirar / buscar",
  move:"mover / mudarse",need:"necesitar",pick:"elegir / recoger",
  push:"empujar",pull:"jalar / tirar",rain:"llover",reach:"alcanzar / llegar",
  remember:"recordar",return:"volver / regresar",save:"guardar / salvar",
  smile:"sonre√≠r",study:"estudiar",travel:"viajar",try:"intentar / probar",
  turn:"girar / voltear",use:"usar / utilizar",visit:"visitar",
  wait:"esperar",wash:"lavar",watch:"ver / mirar",want:"querer / desear",
  accept:"aceptar",add:"agregar / sumar",allow:"permitir / dejar",
  arrive:"llegar",believe:"creer",carry:"cargar / llevar",
  change:"cambiar",check:"revisar / verificar",complete:"completar",
  consider:"considerar",continue:"continuar",create:"crear",
  decide:"decidir",describe:"describir",develop:"desarrollar",
  discover:"descubrir",discuss:"discutir / hablar de",enjoy:"disfrutar",
  enter:"entrar",explain:"explicar",express:"expresar",
  fail:"fallar / reprobar",follow:"seguir",form:"formar",
  happen:"suceder / pasar",improve:"mejorar",include:"incluir",
  increase:"aumentar / incrementar",inform:"informar",
  join:"unirse / unir",laugh:"re√≠r",learn:"aprender",
  like:"gustar / agradar",manage:"manejar / lograr",mention:"mencionar",
  miss:"extra√±ar / perder",notice:"notar / darse cuenta",offer:"ofrecer",
  pass:"pasar / aprobar",plan:"planear / planificar",point:"se√±alar / apuntar",
  practice:"practicar",prepare:"preparar",present:"presentar",
  prevent:"prevenir",produce:"producir",provide:"proveer",
  receive:"recibir",reduce:"reducir",refer:"referir / remitir",
  remain:"quedar / permanecer",remove:"quitar / eliminar",
  repeat:"repetir",replace:"reemplazar",report:"reportar / informar",
  represent:"representar",require:"requerir / necesitar",
  share:"compartir",show:"mostrar",skip:"saltar / omitir",
  solve:"resolver",suppose:"suponer",support:"apoyar",
  suggest:"sugerir",thank:"agradecer",understand:"entender",
  update:"actualizar",upload:"subir",download:"descargar",
  vote:"votar",wish:"desear",wonder:"preguntarse / maravillarse",
};

/* =========================================================
   CONJUGACI√ìN ESPA√ëOLA MEJORADA
========================================================= */
const ES_PRES_IRR = {
  "ir":["voy","vas","va","vamos","van"],
  "ser":["soy","eres","es","somos","son"],
  "estar":["estoy","est√°s","est√°","estamos","est√°n"],
  "haber":["he","has","ha","hemos","han"],
  "tener":["tengo","tienes","tiene","tenemos","tienen"],
  "hacer":["hago","haces","hace","hacemos","hacen"],
  "poder":["puedo","puedes","puede","podemos","pueden"],
  "querer":["quiero","quieres","quiere","queremos","quieren"],
  "saber":["s√©","sabes","sabe","sabemos","saben"],
  "ver":["veo","ves","ve","vemos","ven"],
  "venir":["vengo","vienes","viene","venimos","vienen"],
  "decir":["digo","dices","dice","decimos","dicen"],
  "dar":["doy","das","da","damos","dan"],
  "dormir":["duermo","duermes","duerme","dormimos","duermen"],
  "sentir":["siento","sientes","siente","sentimos","sienten"],
  "jugar":["juego","juegas","juega","jugamos","juegan"],
  "poner":["pongo","pones","pone","ponemos","ponen"],
  "traer":["traigo","traes","trae","traemos","traen"],
  "salir":["salgo","sales","sale","salimos","salen"],
  "conocer":["conozco","conoces","conoce","conocemos","conocen"],
  "conducir":["conduzco","conduces","conduce","conducimos","conducen"],
  "traducir":["traduzco","traduces","traduce","traducimos","traducen"],
  "construir":["construyo","construyes","construye","construimos","construyen"],
  "caer":["caigo","caes","cae","caemos","caen"],
  "o√≠r":["oigo","oyes","oye","o√≠mos","oyen"],
  "elegir":["elijo","eliges","elige","elegimos","eligen"],
  "seguir":["sigo","sigues","sigue","seguimos","siguen"],
  "servir":["sirvo","sirves","sirve","servimos","sirven"],
  "pedir":["pido","pides","pide","pedimos","piden"],
  "repetir":["repito","repites","repite","repetimos","repiten"],
  "perder":["pierdo","pierdes","pierde","perdemos","pierden"],
  "entender":["entiendo","entiendes","entiende","entendemos","entienden"],
  "volver":["vuelvo","vuelves","vuelve","volvemos","vuelven"],
  "encontrar":["encuentro","encuentras","encuentra","encontramos","encuentran"],
  "mostrar":["muestro","muestras","muestra","mostramos","muestran"],
  "contar":["cuento","cuentas","cuenta","contamos","cuentan"],
  "so√±ar":["sue√±o","sue√±as","sue√±a","so√±amos","sue√±an"],
  "morir":["muero","mueres","muere","morimos","mueren"],
  "probar":["pruebo","pruebas","prueba","probamos","prueban"],
  "recordar":["recuerdo","recuerdas","recuerda","recordamos","recuerdan"],
  "almorzar":["almuerzo","almuerzas","almuerza","almorzamos","almuerzan"],
  "costar":["cuesta","cuestan","cuesta","costamos","cuestan"],
  "cerrar":["cierro","cierras","cierra","cerramos","cierran"],
  "comenzar":["comienzo","comienzas","comienza","comenzamos","comienzan"],
  "empezar":["empiezo","empiezas","empieza","empezamos","empiezan"],
  "pensar":["pienso","piensas","piensa","pensamos","piensan"],
  "sentar":["siento","sientas","sienta","sentamos","sientan"],
};
const ES_PRET_IRR = {
  "ir":["fui","fuiste","fue","fuimos","fueron"],
  "ser":["fui","fuiste","fue","fuimos","fueron"],
  "estar":["estuve","estuviste","estuvo","estuvimos","estuvieron"],
  "tener":["tuve","tuviste","tuvo","tuvimos","tuvieron"],
  "hacer":["hice","hiciste","hizo","hicimos","hicieron"],
  "poder":["pude","pudiste","pudo","pudimos","pudieron"],
  "querer":["quise","quisiste","quiso","quisimos","quisieron"],
  "saber":["supe","supiste","supo","supimos","supieron"],
  "venir":["vine","viniste","vino","vinimos","vinieron"],
  "decir":["dije","dijiste","dijo","dijimos","dijeron"],
  "ver":["vi","viste","vio","vimos","vieron"],
  "dar":["di","diste","dio","dimos","dieron"],
  "poner":["puse","pusiste","puso","pusimos","pusieron"],
  "traer":["traje","trajiste","trajo","trajimos","trajeron"],
  "conducir":["conduje","condujiste","condujo","condujimos","condujeron"],
  "producir":["produje","produjiste","produjo","produjimos","produjeron"],
  "caer":["ca√≠","ca√≠ste","cay√≥","ca√≠mos","cayeron"],
  "leer":["le√≠","le√≠ste","ley√≥","le√≠mos","leyeron"],
  "o√≠r":["o√≠","o√≠ste","oy√≥","o√≠mos","oyeron"],
  "elegir":["eleg√≠","elegiste","eligi√≥","elegimos","eligieron"],
  "seguir":["segu√≠","seguiste","sigui√≥","seguimos","siguieron"],
  "dormir":["dorm√≠","dormiste","durmi√≥","dormimos","durmieron"],
  "sentir":["sent√≠","sentiste","sinti√≥","sentimos","sintieron"],
  "pedir":["ped√≠","pediste","pidi√≥","pedimos","pidieron"],
  "morir":["mor√≠","moriste","muri√≥","morimos","murieron"],
  "haber":["hube","hubiste","hubo","hubimos","hubieron"],
  "andar":["anduve","anduviste","anduvo","anduvimos","anduvieron"],
  "caber":["cupe","cupiste","cupo","cupimos","cupieron"],
};
const ES_FUT_IRR = {
  "haber":["habr√©","habr√°s","habr√°","habremos","habr√°n"],
  "poder":["podr√©","podr√°s","podr√°","podremos","podr√°n"],
  "tener":["tendr√©","tendr√°s","tendr√°","tendremos","tendr√°n"],
  "venir":["vendr√©","vendr√°s","vendr√°","vendremos","vendr√°n"],
  "hacer":["har√©","har√°s","har√°","haremos","har√°n"],
  "decir":["dir√©","dir√°s","dir√°","diremos","dir√°n"],
  "saber":["sabr√©","sabr√°s","sabr√°","sabremos","sabr√°n"],
  "querer":["querr√©","querr√°s","querr√°","querremos","querr√°n"],
  "salir":["saldr√©","saldr√°s","saldr√°","saldremos","saldr√°n"],
  "poner":["pondr√©","pondr√°s","pondr√°","pondremos","pondr√°n"],
  "valer":["valdr√©","valdr√°s","valdr√°","valdremos","valdr√°n"],
  "caber":["cabr√©","cabr√°s","cabr√°","cabremos","cabr√°n"],
  "haber":["habr√©","habr√°s","habr√°","habremos","habr√°n"],
};
const ES_IMP_IRR = {
  // imperfecto
  "ser":["era","eras","era","√©ramos","eran"],
  "ir":["iba","ibas","iba","√≠bamos","iban"],
  "ver":["ve√≠a","ve√≠as","ve√≠a","ve√≠amos","ve√≠an"],
};

/* =========================================================
   MORFOLOG√çA INGLESA
========================================================= */
const VW = new Set(['a','e','i','o','u']);
function makeVing(v) {
  if(v==='be') return 'being';
  if(v.endsWith('ie')) return v.slice(0,-2)+'ying';
  if(v.endsWith('ee')||v.endsWith('oe')||v.endsWith('ye')) return v+'ing';
  if(v.endsWith('e')&&!v.endsWith('ee')) return v.slice(0,-1)+'ing';
  if(v.length>=3){
    const a=v[v.length-3],b=v[v.length-2],c=v[v.length-1];
    if(!VW.has(c)&&VW.has(b)&&!VW.has(a)&&c!=='w'&&c!=='x'&&c!=='y') return v+c+'ing';
  }
  return v+'ing';
}
function makeV2V3(v) {
  if(v.endsWith('e')) return v+'d';
  if(v.endsWith('y')&&!VW.has(v[v.length-2])) return v.slice(0,-1)+'ied';
  if(v.length>=3){
    const a=v[v.length-3],b=v[v.length-2],c=v[v.length-1];
    if(!VW.has(c)&&VW.has(b)&&!VW.has(a)&&c!=='w'&&c!=='x'&&c!=='y') return v+c+'ed';
  }
  return v+'ed';
}
function thirdSg(v) {
  if(v==='have') return 'has';
  if(v==='do')   return 'does';
  if(v==='go')   return 'goes';
  if(v==='be')   return 'is';
  const e2=v.slice(-2);
  if(['sh','ch','ss','zz'].includes(e2)||v.endsWith('x')) return v+'es';
  if(v.endsWith('y')&&!VW.has(v[v.length-2])) return v.slice(0,-1)+'ies';
  if(v.endsWith('o')&&!VW.has(v[v.length-2])) return v+'es';
  return v+'s';
}

/* =========================================================
   PRONOMBRES / √çNDICES
========================================================= */
const P_KEYS = ["I","You_s","He","She","It","You_p","We","They"];
const EN_PRON = { I:"I", You_s:"You", He:"He", She:"She", It:"It", You_p:"You", We:"We", They:"They" };
const ES_PRON = { I:"Yo", You_s:"T√∫", He:"√âl", She:"Ella", It:"Eso", You_p:"Ustedes", We:"Nosotros", They:"Ellos" };
const ES_IDX  = { I:0, You_s:1, He:2, She:2, It:2, We:3, They:4, You_p:4 };

/* =========================================================
   ESTADO GLOBAL
========================================================= */
let cV  = {v1:'play',v2:'played',v3:'played',esp:'jugar',irreg:false};
let cT  = 'prs', cM = 'af', cP = 'I';
let cAdv    = new Set();
let cAdvMap = new Map();
const visitedTenses = new Set();

/* =========================================================
   MODAL (reemplaza prompt())
========================================================= */
let modalResolve = null;

const MODAL_CONFIG = {
  "for":{
    tag:"Duraci√≥n",
    title:"¬øCu√°nto tiempo?",
    desc:"Indica la duraci√≥n de la acci√≥n.",
    ex:"3 hours ¬∑ 2 days ¬∑ 10 minutes ¬∑ 1 week",
    ph:"Ej: 3 hours"
  },
  "since":{
    tag:"Punto de inicio",
    title:"¬øDesde cu√°ndo?",
    desc:"Indica desde qu√© momento comenz√≥ la acci√≥n.",
    ex:"Monday ¬∑ 2020 ¬∑ last year ¬∑ I was a child",
    ph:"Ej: Monday"
  },
  "ago":{
    tag:"Tiempo pasado",
    title:"¬øHace cu√°nto?",
    desc:"Indica cu√°nto tiempo atr√°s ocurri√≥ la acci√≥n.",
    ex:"2 days ¬∑ 3 hours ¬∑ a week ¬∑ 10 minutes",
    ph:"Ej: 2 days"
  },
  "when":{
    tag:"Cl√°usula when",
    title:"¬øCu√°ndo ocurri√≥?",
    desc:"Completa la cl√°usula con lo que pas√≥ en ese momento.",
    ex:"the phone rang ¬∑ I arrived ¬∑ she called",
    ph:"Ej: the phone rang"
  },
  "while":{
    tag:"Cl√°usula while",
    title:"¬øMientras qu√© pasaba?",
    desc:"Indica la acci√≥n simult√°nea.",
    ex:"she cooked ¬∑ we were studying ¬∑ it rained",
    ph:"Ej: she cooked"
  },
  "as":{
    tag:"Cl√°usula as",
    title:"¬øMientras / a medida que‚Ä¶?",
    desc:"Acci√≥n simult√°nea o gradual.",
    ex:"I was leaving ¬∑ the sun set ¬∑ time passed",
    ph:"Ej: I was leaving"
  },
  "by the time":{
    tag:"Para cuando‚Ä¶",
    title:"¬øPara cu√°ndo?",
    desc:"Indica el momento de referencia futuro o pasado.",
    ex:"he arrived ¬∑ we finish ¬∑ you get home",
    ph:"Ej: he arrives"
  },
};

function modalOpen(base) {
  return new Promise(resolve => {
    const cfg = MODAL_CONFIG[base] || { tag:"Adverbio", title:"Completa el marcador", desc:"Escribe el complemento:", ex:"", ph:"" };
    document.getElementById('modalTag').textContent   = cfg.tag;
    document.getElementById('modalTitle').textContent = cfg.title;
    document.getElementById('modalDesc').textContent  = cfg.desc;
    document.getElementById('modalExText').textContent = cfg.ex;
    const inp = document.getElementById('modalIn');
    inp.placeholder = cfg.ph;
    inp.value = '';

    const overlay = document.getElementById('modalOverlay');
    overlay.classList.add('open');
    setTimeout(()=>inp.focus(), 80);
    modalResolve = resolve;
  });
}

function modalClose(ok) {
  const overlay = document.getElementById('modalOverlay');
  overlay.classList.remove('open');
  const val = ok ? document.getElementById('modalIn').value.trim() : null;
  if(modalResolve) { modalResolve(val); modalResolve = null; }
}

document.addEventListener('keydown', e => {
  if(e.key==='Escape' && document.getElementById('modalOverlay').classList.contains('open')) {
    modalClose(false);
  }
  if(e.key==='Enter' && document.getElementById('modalOverlay').classList.contains('open')) {
    const val = document.getElementById('modalIn').value.trim();
    if(val) modalClose(true);
  }
});

/* =========================================================
   TOAST
========================================================= */
let toastTimer = null;
function showToast(msg, ico='‚úì', dur=2200) {
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  document.getElementById('toastIco').textContent = ico;
  t.classList.add('show');
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>t.classList.remove('show'), dur);
}

/* =========================================================
   ACCESIBILIDAD / PREFERENCIAS
========================================================= */
function toggleTheme() {
  const isLight = document.documentElement.classList.toggle('light');
  localStorage.setItem('nv-theme', isLight?'light':'dark');
  setTopbarSpacing();
}
function toggleBigText() {
  const on = document.documentElement.classList.toggle('bigtext');
  localStorage.setItem('nv-bigtext', on?'1':'0');
  document.getElementById('btnBig').setAttribute('aria-pressed', on?'true':'false');
  setTopbarSpacing();
}
function toggleHighContrast() {
  const on = document.documentElement.classList.toggle('hc');
  localStorage.setItem('nv-hc', on?'1':'0');
  document.getElementById('btnHC').setAttribute('aria-pressed', on?'true':'false');
}
function initPrefs() {
  const t = localStorage.getItem('nv-theme');
  if(t==='light') document.documentElement.classList.add('light');
  const bt = localStorage.getItem('nv-bigtext')==='1';
  document.documentElement.classList.toggle('bigtext', bt);
  document.getElementById('btnBig').setAttribute('aria-pressed', bt?'true':'false');
  const hc = localStorage.getItem('nv-hc')==='1';
  document.documentElement.classList.toggle('hc', hc);
  document.getElementById('btnHC').setAttribute('aria-pressed', hc?'true':'false');
}

function setTopbarSpacing() {
  const bar = document.getElementById('topBar');
  if(!bar) return;
  const h = bar.offsetHeight || 72;
  document.documentElement.style.setProperty('--topbar-h', h+'px');
}

/* =========================================================
   URL HASH ROUTING
========================================================= */
function updateHash() {
  // Mantiene el hash sincronizado con el tiempo actual (sin romper la UI si no existe el pill)
  history.replaceState(null, '', '#'+cT);
}

function refreshSharePill() {
  const el = document.getElementById('shareLinkTxt');
  if(!el) return;
  el.textContent = `Copiar enlace a este tiempo (#${cT})`;
}

function readHash() {
  const h = location.hash.replace('#','').trim();
  return TD[h] ? h : null;
}

function copyShareLink() {
  const url = location.href.split('#')[0] + '#' + cT;
  if(navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(url).then(()=>{
      showToast('Enlace copiado: #'+cT, 'üîó');
      document.getElementById('shareLinkTxt').textContent = '‚úì Copiado al portapapeles';
      setTimeout(()=>{ document.getElementById('shareLinkTxt').textContent = 'Copiar enlace a este tiempo'; }, 2500);
    });
  } else {
    showToast('#'+cT+' ‚Äî copia la URL del navegador', 'üîó');
  }
}

/* =========================================================
   AUTOCOMPLETE
========================================================= */
let acIdx = -1;

function getAllVerbsSorted() {
  const all = [];
  Object.entries(IRR).forEach(([k,v]) => all.push({w:k, es:v[3], irr:true}));
  Object.entries(REG_ESP).forEach(([k,v]) => { if(!IRR[k]) all.push({w:k, es:v, irr:false}); });
  return all.sort((a,b)=>a.w.localeCompare(b.w));
}

function showAC() {
  const raw = (document.getElementById('vIn').value||'').toLowerCase().trim();
  const drop = document.getElementById('acDrop');
  const clrBtn = document.getElementById('srchClear');
  clrBtn.classList.toggle('show', raw.length > 0);

  if(!raw || raw.length < 1) {
    drop.classList.remove('show');
    return;
  }
  const all = getAllVerbsSorted();
  const matches = all.filter(v => v.w.startsWith(raw) || v.w.includes(raw)).slice(0,8);
  if(!matches.length) { drop.classList.remove('show'); return; }

  drop.innerHTML = matches.map((v,i) => `
    <div class="ac-item" role="option" data-verb="${escHtml(v.w)}" tabindex="-1"
      onmousedown="selectAC('${escHtml(v.w)}')" onmouseover="setACFocus(${i})">
      <div>
        <span class="ac-item-en">${escHtml(v.w)}</span>
        <span class="ac-item-es"> ¬∑ ${escHtml(v.es)}</span>
      </div>
      <span class="ac-item-irr ${v.irr?'irr':'reg'}">${v.irr?'Irr':'Reg'}</span>
    </div>`).join('');
  acIdx = -1;
  drop.classList.add('show');
}

function setACFocus(i) {
  acIdx = i;
  const items = document.querySelectorAll('#acDrop .ac-item');
  items.forEach((el,j) => el.classList.toggle('focused', j===i));
}

function selectAC(w) {
  const inp = document.getElementById('vIn');
  inp.value = w;
  document.getElementById('acDrop').classList.remove('show');
  document.getElementById('srchClear').classList.add('show');
  procVerb();
  inp.blur();
}

function handleACKey(e) {
  const drop = document.getElementById('acDrop');
  if(!drop.classList.contains('show')) return;
  const items = document.querySelectorAll('#acDrop .ac-item');
  if(e.key==='ArrowDown') {
    e.preventDefault();
    acIdx = Math.min(acIdx+1, items.length-1);
    setACFocus(acIdx);
  } else if(e.key==='ArrowUp') {
    e.preventDefault();
    acIdx = Math.max(acIdx-1, -1);
    setACFocus(acIdx);
  } else if(e.key==='Enter' && acIdx>=0) {
    e.preventDefault();
    const sel = items[acIdx];
    if(sel) selectAC(sel.dataset.verb);
  } else if(e.key==='Escape') {
    drop.classList.remove('show');
    acIdx = -1;
  }
}

document.addEventListener('click', e => {
  const drop = document.getElementById('acDrop');
  const inp  = document.getElementById('vIn');
  if(drop && !drop.contains(e.target) && e.target !== inp) {
    drop.classList.remove('show');
    acIdx = -1;
  }
});

function clearVerbInput() {
  const inp = document.getElementById('vIn');
  inp.value = '';
  document.getElementById('srchClear').classList.remove('show');
  document.getElementById('acDrop').classList.remove('show');
  procVerb();
  inp.focus();
}

/* =========================================================
   ADVERBIOS DIN√ÅMICOS
========================================================= */
const DYN_BASE = new Set(["for","since","ago","when","while","as","by the time"]);

function hasBase(base) {
  for(const k of cAdv) if(k.startsWith(base+'|')) return true;
  return false;
}
function removeBase(base) {
  for(const k of Array.from(cAdv)) {
    if(k.startsWith(base+'|')) { cAdv.delete(k); cAdvMap.delete(k); }
  }
}

function parseQtyPhrase(input) {
  const s = String(input||'').trim();
  const m = s.match(/^(\d+)\s*(minute|minutes|min|mins|hour|hours|hr|hrs|day|days|week|weeks|month|months|year|years|yr|yrs)\b/i);
  if(!m) return {en:s, es:s};
  const n = m[1];
  const unit = m[2].toLowerCase();
  const U = u => {
    if(["minute","minutes","min","mins"].includes(u)) return {sg:"minuto",pl:"minutos"};
    if(["hour","hours","hr","hrs"].includes(u))       return {sg:"hora",pl:"horas"};
    if(["day","days"].includes(u))                    return {sg:"d√≠a",pl:"d√≠as"};
    if(["week","weeks"].includes(u))                  return {sg:"semana",pl:"semanas"};
    if(["month","months"].includes(u))                return {sg:"mes",pl:"meses"};
    if(["year","years","yr","yrs"].includes(u))       return {sg:"a√±o",pl:"a√±os"};
    return {sg:u,pl:u};
  };
  const u = U(unit);
  const esUnit = Number(n)===1 ? u.sg : u.pl;
  const enBase = unit.startsWith("min") ? "minute" : unit.startsWith("hr") ? "hour" : unit.replace(/s$/,'');
  const enUnit = Number(n)===1 ? enBase : enBase+'s';
  return {en:`${n} ${enUnit}`, es:`${n} ${esUnit}`};
}

function getAdvIndex() {
  const idx = new Map();
  const cats = (TD[cT]&&TD[cT].adverbs) ? TD[cT].adverbs : {};
  Object.values(cats).flat().forEach(a => { if(!idx.has(a.w)) idx.set(a.w,{pos:a.pos,e:a.e,w:a.w}); });
  return idx;
}

function getSelectedAdverbs() {
  const idx = getAdvIndex();
  const list = [];
  for(const k of cAdv) {
    if(k.includes('|')) {
      const o = cAdvMap.get(k);
      if(o) list.push(o);
    } else {
      const a = idx.get(k);
      if(a) list.push({w:a.w,e:a.e,pos:a.pos,base:a.w});
    }
  }
  return list;
}

/* =========================================================
   HELPERS CSS / HTML
========================================================= */
function escHtml(s) {
  return String(s).replace(/[&<>"']/g, m =>
    ({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m])
  );
}
const COLOR_RGB = {'--pres':'0,200,168','--past':'232,80,106','--fut':'240,154,26'};
function rgba(varName,a) { return `rgba(${COLOR_RGB[varName]||'200,200,200'},${a})`; }

function vSpan(text,which) {
  const cls = which===1?'vw1':which===2?'vw2':'vw3';
  return `<span class="${cls}">${escHtml(text)}</span>`;
}
function hiAux(t) { return `<span class="aux-hi">${escHtml(t)}</span>`; }
function hiNeg(t) { return `<span class="neg-hi">${escHtml(t)}</span>`; }

/* =========================================================
   TOP BAR INFO
========================================================= */
function updateTenseStick() {
  const td = TD[cT];
  if(!td) return;
  const cv=td.c, cv2=td.c2;
  const visited = visitedTenses.size;
  const total   = Object.keys(TD).length;
  document.getElementById('tenseInfo').innerHTML = `
    <span class="ts-dot" style="background:var(${cv2});box-shadow:0 0 14px ${rgba(cv,.42)};"></span>
    <span class="ts-txt">Tiempo:</span>
    <span class="ts-name" style="color:var(${cv2});">${escHtml(td.n)}</span>
    <span class="ts-zone" style="background:${rgba(cv,.12)};border:1px solid ${rgba(cv,.30)};color:var(${cv2});">${escHtml(td.z)}</span>
    <span class="ts-progress" title="Tiempos explorados">${visited}/${total} explorados</span>
  `;
  setTopbarSpacing();
}

/* =========================================================
   CONJUGACI√ìN ESPA√ëOLA
========================================================= */
function espVerbPhrase() {
  const pi  = ES_IDX[cP];
  const raw = (cV.esp||'').split(/[\/¬∑]/)[0].trim().toLowerCase();
  const term = raw.slice(-2), root = raw.slice(0,-2);
  const isAr = term==='ar', isEr = term==='er', isIr = term==='ir';
  const ok = (isAr||isEr||isIr);

  const part = ok ? (root+(isAr?'ado':'ido')) : '(participio)';
  const ger  = ok ? (root+(isAr?'ando':'iendo')) : '(gerundio)';

  function pres() {
    if(ES_PRES_IRR[raw]) return ES_PRES_IRR[raw][pi];
    if(!ok) return '(presente)';
    const e = isAr?['o','as','a','amos','an']:(isEr?['o','es','e','emos','en']:['o','es','e','imos','en']);
    return root+e[pi];
  }
  function pret() {
    if(ES_PRET_IRR[raw]) return ES_PRET_IRR[raw][pi];
    if(!ok) return '(pret√©rito)';
    const e = isAr?['√©','aste','√≥','amos','aron']:['√≠','iste','i√≥','imos','ieron'];
    return root+e[pi];
  }
  function fut() {
    if(ES_FUT_IRR[raw]) return ES_FUT_IRR[raw][pi];
    if(!ok) return '(futuro)';
    return raw+['√©','√°s','√°','emos','√°n'][pi];
  }
  function imp() {
    // imperfecto (usado para pasado continuo/perfecto continuo)
    if(ES_IMP_IRR[raw]) return ES_IMP_IRR[raw][pi];
    if(!ok) return '(imperfecto)';
    const e = isAr?['aba','abas','aba','√°bamos','aban']:['√≠a','√≠as','√≠a','√≠amos','√≠an'];
    return root+e[pi];
  }

  const heP  = ["he","has","ha","hemos","han"][pi];
  const habP = ["hab√≠a","hab√≠as","hab√≠a","hab√≠amos","hab√≠an"][pi];
  const habrP= ["habr√©","habr√°s","habr√°","habremos","habr√°n"][pi];
  const estP = ["estoy","est√°s","est√°","estamos","est√°n"][pi];
  const estaP= ["estaba","estabas","estaba","est√°bamos","estaban"][pi];
  const estrP= ["estar√©","estar√°s","estar√°","estaremos","estar√°n"][pi];

  switch(cT) {
    case 'prs':  return pres();
    case 'prc':  return `${estP} ${ger}`;
    case 'prp':  return `${heP} ${part}`;
    case 'prpc': return `${heP} estado ${ger}`;
    case 'ps':   return pret();
    case 'pc':   return `${estaP} ${ger}`;
    case 'pp':   return `${habP} ${part}`;
    case 'ppc':  return `${habP} estado ${ger}`;
    case 'fs':   return fut();
    case 'fc':   return `${estrP} ${ger}`;
    case 'fp':   return `${habrP} ${part}`;
    case 'fpc':  return `${habrP} estado ${ger}`;
    default:     return '(verbo)';
  }
}

/* =========================================================
   CONSTRUIR ORACI√ìN EN INGL√âS
========================================================= */
function is3s(k) { return (k==='He'||k==='She'||k==='It'); }
function isI(k)  { return k==='I'; }

function buildEn() {
  const k=cP, p=EN_PRON[k];
  const v1=String(cV.v1||''), v2=String(cV.v2||''), v3=String(cV.v3||'');
  const ving=makeVing(v1), v1s=thirdSg(v1);

  const sel = getSelectedAdverbs();
  const fq = sel.filter(a=>a.pos==='freq').map(a=>`<em>${escHtml(a.w)}</em>`).join(' ');
  const md = sel.filter(a=>a.pos==='mid' ).map(a=>`<em>${escHtml(a.w)}</em>`).join(' ');
  const pf = sel.filter(a=>a.pos==='perf').map(a=>`<em>${escHtml(a.w)}</em>`).join(' ');
  const wl = sel.filter(a=>a.pos==='will').map(a=>`<em>${escHtml(a.w)}</em>`).join(' ');
  const en = sel.filter(a=>a.pos==='end' ).map(a=>`<em>${escHtml(a.w)}</em>`).join(', ');

  const F=fq?' '+fq:'', M=md?' '+md:'', P=pf?' '+pf:'', W=wl?' '+wl:'', E=en?' '+en:'';
  const af=cM==='af', neg=cM==='neg';
  let s='';

  switch(cT) {
    case 'prs': {
      const do_=is3s(k)?'does':'do', Do_=is3s(k)?'Does':'Do';
      if(af)      s=`${p}${F} ${vSpan(is3s(k)?v1s:v1,1)}${E}`;
      else if(neg)s=`${p} ${hiAux(do_)} ${hiNeg('not')}${F} ${vSpan(v1,1)}${E}`;
      else        s=`${hiAux(Do_)} ${p}${F} ${vSpan(v1,1)}${E}?`;
      break;
    }
    case 'prc': {
      const be=isI(k)?'am':(is3s(k)?'is':'are'), Be=isI(k)?'Am':(is3s(k)?'Is':'Are');
      if(af)      s=`${p} ${hiAux(be)}${M} ${vSpan(ving,1)}${E}`;
      else if(neg)s=`${p} ${hiAux(be)} ${hiNeg('not')}${M} ${vSpan(ving,1)}${E}`;
      else        s=`${hiAux(Be)} ${p}${M} ${vSpan(ving,1)}${E}?`;
      break;
    }
    case 'prp': {
      const h=is3s(k)?'has':'have', H=is3s(k)?'Has':'Have';
      if(af)      s=`${p} ${hiAux(h)}${P} ${vSpan(v3,3)}${E}`;
      else if(neg)s=`${p} ${hiAux(h)} ${hiNeg('not')}${P} ${vSpan(v3,3)}${E}`;
      else        s=`${hiAux(H)} ${p}${P} ${vSpan(v3,3)}${E}?`;
      break;
    }
    case 'prpc': {
      const h=is3s(k)?'has':'have', H=is3s(k)?'Has':'Have';
      if(af)      s=`${p} ${hiAux(h)}${P} ${hiAux('been')} ${vSpan(ving,1)}${E}`;
      else if(neg)s=`${p} ${hiAux(h)}${P} ${hiNeg('not')} ${hiAux('been')} ${vSpan(ving,1)}${E}`;
      else        s=`${hiAux(H)} ${p}${P} ${hiAux('been')} ${vSpan(ving,1)}${E}?`;
      break;
    }
    case 'ps': {
      if(af)      s=`${p} ${vSpan(v2,2)}${E}`;
      else if(neg)s=`${p} ${hiAux('did')} ${hiNeg('not')} ${vSpan(v1,1)}${E}`;
      else        s=`${hiAux('Did')} ${p} ${vSpan(v1,1)}${E}?`;
      break;
    }
    case 'pc': {
      const wb=(isI(k)||is3s(k))?'was':'were', Wb=(isI(k)||is3s(k))?'Was':'Were';
      if(af)      s=`${p} ${hiAux(wb)}${M} ${vSpan(ving,1)}${E}`;
      else if(neg)s=`${p} ${hiAux(wb)} ${hiNeg('not')}${M} ${vSpan(ving,1)}${E}`;
      else        s=`${hiAux(Wb)} ${p}${M} ${vSpan(ving,1)}${E}?`;
      break;
    }
    case 'pp': {
      if(af)      s=`${p} ${hiAux('had')}${P} ${vSpan(v3,3)}${E}`;
      else if(neg)s=`${p} ${hiAux('had')} ${hiNeg('not')}${P} ${vSpan(v3,3)}${E}`;
      else        s=`${hiAux('Had')} ${p}${P} ${vSpan(v3,3)}${E}?`;
      break;
    }
    case 'ppc': {
      if(af)      s=`${p} ${hiAux('had')}${P} ${hiAux('been')} ${vSpan(ving,1)}${E}`;
      else if(neg)s=`${p} ${hiAux('had')}${P} ${hiNeg('not')} ${hiAux('been')} ${vSpan(ving,1)}${E}`;
      else        s=`${hiAux('Had')} ${p}${P} ${hiAux('been')} ${vSpan(ving,1)}${E}?`;
      break;
    }
    case 'fs': {
      if(af)      s=`${p} ${hiAux('will')}${W} ${vSpan(v1,1)}${E}`;
      else if(neg)s=`${p} ${hiAux('will')}${W} ${hiNeg('not')} ${vSpan(v1,1)}${E}`;
      else        s=`${hiAux('Will')} ${p}${W} ${vSpan(v1,1)}${E}?`;
      break;
    }
    case 'fc': {
      if(af)      s=`${p} ${hiAux('will')}${W} ${hiAux('be')} ${vSpan(ving,1)}${E}`;
      else if(neg)s=`${p} ${hiAux('will')}${W} ${hiNeg('not')} ${hiAux('be')} ${vSpan(ving,1)}${E}`;
      else        s=`${hiAux('Will')} ${p}${W} ${hiAux('be')} ${vSpan(ving,1)}${E}?`;
      break;
    }
    case 'fp': {
      if(af)      s=`${p} ${hiAux('will')}${W} ${hiAux('have')}${P} ${vSpan(v3,3)}${E}`;
      else if(neg)s=`${p} ${hiAux('will')}${W} ${hiNeg('not')} ${hiAux('have')}${P} ${vSpan(v3,3)}${E}`;
      else        s=`${hiAux('Will')} ${p}${W} ${hiAux('have')}${P} ${vSpan(v3,3)}${E}?`;
      break;
    }
    case 'fpc': {
      if(af)      s=`${p} ${hiAux('will')}${W} ${hiAux('have')}${P} ${hiAux('been')} ${vSpan(ving,1)}${E}`;
      else if(neg)s=`${p} ${hiAux('will')}${W} ${hiNeg('not')} ${hiAux('have')}${P} ${hiAux('been')} ${vSpan(ving,1)}${E}`;
      else        s=`${hiAux('Will')} ${p}${W} ${hiAux('have')}${P} ${hiAux('been')} ${vSpan(ving,1)}${E}?`;
      break;
    }
  }
  return s;
}

/* =========================================================
   CONSTRUIR TRADUCCI√ìN AL ESPA√ëOL
========================================================= */
function buildEs() {
  const subject = ES_PRON[cP] || "Yo";
  const verbPhrase = espVerbPhrase();
  const sel = getSelectedAdverbs();

  const advBefore = sel.filter(a=>a.pos!=='end').map(a=>a.e).filter(Boolean);
  const timeEnd   = sel.filter(a=>a.pos==='end' ).map(a=>a.e).filter(Boolean);

  const advHtml = advBefore.length ? ` <span class="adv-ins">${escHtml(advBefore.join(' '))}</span>` : '';
  const tmHtml  = timeEnd.length   ? ` <span class="tm-ins">${escHtml(timeEnd.join(', '))}</span>`  : '';

  let core = `${subject}${cM==='neg'?' <span class="neg-hi">no</span>':''}${advHtml} ${escHtml(verbPhrase)}${tmHtml}`;
  if(cM==='int') core = `¬ø${core}?`;
  return core;
}

/* =========================================================
   BOT√ìN COPIAR ORACI√ìN
========================================================= */
function copySentence() {
  const enEl  = document.getElementById('sentEn');
  const esEl  = document.getElementById('sentEs');
  const enTxt = enEl ? enEl.innerText : '';
  const esTxt = esEl ? esEl.innerText : '';
  const text  = `${enTxt}\n${esTxt}`;
  if(navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(()=>{
      showToast('Oraci√≥n copiada al portapapeles', 'üìã');
      const btn = document.getElementById('copyBtn');
      btn.classList.add('copied');
      btn.innerHTML = '‚úì Copiada';
      setTimeout(()=>{ btn.classList.remove('copied'); btn.innerHTML='üìã Copiar'; }, 2000);
    });
  } else {
    showToast('Copia el texto directamente de la pantalla', 'üìã');
  }
}

/* =========================================================
   ADVERTENCIAS
========================================================= */
function updateWarnings() {
  const sel = getSelectedAdverbs();
  const advCount = sel.filter(a=>a.pos!=='end').length;
  const tmCount  = sel.filter(a=>a.pos==='end' ).length;
  const warn = document.getElementById('advWarn');
  const lines = [];
  if(advCount>=2) lines.push(`<span class="line">‚ö†Ô∏è <strong>No se aconseja</strong> usar dos adverbios de frecuencia al mismo tiempo. Elige 1 para que suene natural.</span>`);
  if(tmCount>=2)  lines.push(`<span class="line">‚ö†Ô∏è <strong>No se aconseja</strong> usar dos marcadores de tiempo a la vez. Elige 1 o reformula.</span>`);
  if(lines.length) { warn.style.display='block'; warn.innerHTML=`<div><strong>Observaci√≥n</strong></div>${lines.join('')}`; }
  else             { warn.style.display='none'; warn.textContent=''; }
}

/* =========================================================
   RENDER COMPLETO
========================================================= */
function buildUso() {
  const td=TD[cT], cv=td.c, cv2=td.c2;
  const name=document.getElementById('tName');
  name.textContent=td.n; name.style.color=`var(${cv2})`;
  const badge=document.getElementById('tZone');
  badge.textContent=td.z;
  badge.style.background=rgba(cv,.12);
  badge.style.color=`var(${cv2})`;
  badge.style.border=`1px solid ${rgba(cv,.30)}`;
  document.getElementById('usoCard').style.borderColor=rgba(cv,.22);
  const lbl=document.getElementById('usoLblTxt');
  lbl.textContent=`¬øCu√°ndo se usa el ${td.n}?`;
  lbl.style.color=`var(${cv2})`;
  document.getElementById('usoCards').innerHTML=td.uso.map(u=>`
    <div class="uso-card">
      <div class="uso-ico">${u.ico}</div>
      <div class="uso-ti">${escHtml(u.ti)}</div>
      <div class="uso-desc">${escHtml(u.desc)}</div>
      <div class="uso-en">"${escHtml(u.en)}"</div>
      <div class="uso-es">${escHtml(u.es)}</div>
    </div>`).join('');
}

function buildStruct() {
  const td=TD[cT], cv=td.c;
  document.getElementById('structCard').style.borderColor=rgba(cv,.22);
  document.getElementById('fmlBox').innerHTML=`<span class="fml-lbl">F√≥rmula</span>${escHtml(td.f)}`;
  const mL={af:'Afirmativa (+)',neg:'Negativa (‚àí)',int:'Pregunta (?)'};
  document.getElementById('auxModes').innerHTML=['af','neg','int'].map(m=>{
    const blocks=td.aux[m]||td.aux['af'];
    return blocks.map(b=>`<div class="aux-block">
      <div class="aux-block-lbl">${mL[m]}</div>
      <div class="chips-row">${b.chips.map(c=>c.k==='arr'
        ?`<span class="ch-arr">‚Üí</span>`
        :`<span class="chip ch-${c.k}">${escHtml(c.t)}</span>`).join('')}
      </div>
      <div class="aux-note">${escHtml(b.note)}</div>
    </div>`).join('');
  }).join('');
}

/* Build a readable formula string from chips for the active mode */
function getModeFormula() {
  const td = TD[cT];
  const blocks = (td.aux[cM] || td.aux['af']);
  if(!blocks || !blocks.length) return td.f;
  const chips = blocks[0].chips;

  // Map chip kind ‚Üí display text
  const CHIP_ABBR = { subj:'S', obj:'O/C', arr:null };
  const parts = [];
  chips.forEach(c => {
    if(c.k === 'arr') return; // skip arrows, we'll join with " + "
    if(CHIP_ABBR[c.k] !== undefined) {
      parts.push(CHIP_ABBR[c.k]);
    } else {
      parts.push(c.t); // aux, neg, verb ‚Äî use text as-is
    }
  });
  let formula = parts.join(' + ');
  if(cM === 'int') formula += ' ?';
  return formula;
}

/* Color token per mode */
function getModeColor() {
  if(cM === 'af')  return { var:'--teal2',  rgb:'0,232,196' };
  if(cM === 'neg') return { var:'--past2',  rgb:'255,122,144' };
  if(cM === 'int') return { var:'--indigo', rgb:'108,142,245' };
  return { var:'--teal2', rgb:'0,232,196' };
}

function buildSent() {
  const td=TD[cT], cv=td.c;
  document.getElementById('sentCard').style.borderColor=rgba(cv,.22);

  // Sync sent-disp class with active mode (border + bg gradient)
  const disp = document.getElementById('sentDisp');
  disp.style.borderColor = '';
  disp.classList.remove('mode-af','mode-neg','mode-int');
  disp.classList.add('mode-'+cM);

  document.getElementById('sentEn').innerHTML = buildEn();
  document.getElementById('sentEs').innerHTML = buildEs();

  // Mode-synced formula: label color matches active button
  const mc = getModeColor();
  const formula = getModeFormula();
  document.getElementById('sentFml').innerHTML =
    `<strong>Estructura:</strong> <span style="color:var(${mc.var});">${escHtml(formula)}</span>`;

  updateWarnings();
}

function buildAdv() {
  const cats = TD[cT].adverbs || {};
  const chipOn = w => DYN_BASE.has(w) ? hasBase(w) : cAdv.has(w);

  document.getElementById('advCats').innerHTML = Object.entries(cats).map(([cat,adverbs])=>`
    <div>
      <div class="adv-cat-lbl">${escHtml(cat)}</div>
      <div class="adv-chips">${adverbs.map(a=>{
        const w=a.w, on=chipOn(w), isDyn=DYN_BASE.has(w);
        return `
          <button class="adv-chip ${on?'on':''} ${isDyn?'dyn-chip':''}"
            aria-pressed="${on?'true':'false'}"
            onclick='toggleAdv(${JSON.stringify(w)})'>
            <span>${escHtml(w)}</span>
            <span class="adv-esp">${escHtml(a.e)}</span>
          </button>`;
      }).join('')}
      </div>
    </div>`).join('');
}

function render() {
  updateTenseStick();
  buildUso();
  buildStruct();
  buildSent();
  buildAdv();
  updateHash();
  refreshSharePill();

  // ‚îÄ‚îÄ Botones de modo: cada uno con su color distinto ‚îÄ‚îÄ
  const MODE_COLORS = {
    af:  { background:'#00c8a8', borderColor:'#00c8a8', color:'#061513', boxShadow:'0 0 0 3px rgba(0,200,168,.30), 0 4px 18px rgba(0,200,168,.28)' },
    neg: { background:'#e8506a', borderColor:'#e8506a', color:'#ffffff', boxShadow:'0 0 0 3px rgba(232,80,106,.30), 0 4px 18px rgba(232,80,106,.28)' },
    int: { background:'#6c8ef5', borderColor:'#6c8ef5', color:'#ffffff', boxShadow:'0 0 0 3px rgba(108,142,245,.30), 0 4px 18px rgba(108,142,245,.28)' },
  };
  const BTN_OFF = { background:'', borderColor:'', color:'', boxShadow:'' };

  ['af','neg','int'].forEach(m => {
    const btn = document.getElementById('bt-'+m);
    if(!btn) return;
    const on = (m === cM);
    Object.assign(btn.style, on ? MODE_COLORS[m] : BTN_OFF);
    btn.classList.toggle('active', on);
    btn.setAttribute('aria-pressed', on ? 'true' : 'false');
  });

  // ‚îÄ‚îÄ Pronombres: naranja cuando activo ‚îÄ‚îÄ
  const PRON_ON  = { background:'#f09a1a', borderColor:'#f09a1a', color:'#1a0800', boxShadow:'0 0 0 3px rgba(240,154,26,.30), 0 4px 18px rgba(240,154,26,.28)' };
  const PRON_OFF = { background:'', borderColor:'', color:'', boxShadow:'' };

  P_KEYS.forEach(k => {
    const el = document.getElementById('p-'+k);
    if(!el) return;
    const on = (k === cP);
    Object.assign(el.style, on ? PRON_ON : PRON_OFF);
    el.classList.toggle('active', on);
    el.setAttribute('aria-pressed', on ? 'true' : 'false');
    const sm = el.querySelector('small');
    if(sm) sm.style.color = on ? 'rgba(26,8,0,.60)' : '';
  });
}

/* =========================================================
   ACCIONES
========================================================= */
function clearAdv() {
  cAdv.clear(); cAdvMap.clear();
  render(); saveState();
  showToast('Adverbios eliminados', 'üóëÔ∏è');
}

async function toggleAdv(w) {
  const idx  = getAdvIndex();
  const meta = idx.get(w) || {pos:"end",e:""};

  if(DYN_BASE.has(w)) {
    if(hasBase(w)) {
      removeBase(w);
      render(); saveState();
      return;
    }
    const val = await modalOpen(w);
    if(val===null || val==='') return;

    let phraseEn='', phraseEs='';
    if(w==="for") {
      const p=parseQtyPhrase(val);
      phraseEn=`for ${p.en}`; phraseEs=`durante ${p.es}`;
    } else if(w==="since") {
      phraseEn=`since ${val}`; phraseEs=`desde ${val}`;
    } else if(w==="ago") {
      const p=parseQtyPhrase(val);
      phraseEn=`${p.en} ago`; phraseEs=`hace ${p.es}`;
    } else if(w==="by the time") {
      phraseEn=`by the time ${val}`; phraseEs=`para cuando ${val}`;
    } else if(w==="while") {
      phraseEn=`while ${val}`; phraseEs=`mientras ${val}`;
    } else if(w==="as") {
      phraseEn=`as ${val}`; phraseEs=`mientras / cuando ${val}`;
    } else if(w==="when") {
      phraseEn=`when ${val}`; phraseEs=`cuando ${val}`;
    } else {
      phraseEn=`${w} ${val}`; phraseEs=`${meta.e} ${val}`;
    }

    const key = `${w}|${phraseEn}`;
    cAdv.add(key);
    cAdvMap.set(key,{w:phraseEn,e:phraseEs,pos:meta.pos,base:w});
    render(); saveState();
    showToast(`A√±adido: "${phraseEn}"`, '‚úì');
    return;
  }

  const wasOn = cAdv.has(w);
  wasOn ? cAdv.delete(w) : cAdv.add(w);
  render(); saveState();
  if(!wasOn) showToast(`A√±adido: "${w}"`, '‚úì', 1600);
}

function setM(m) { cM=m; render(); saveState(); }
function setP(p) { cP=p; render(); saveState(); }

/* =========================================================
   L√çNEA DE TIEMPO
========================================================= */
const TORDER = ['ppc','pp','pc','ps','prc','prs','prp','prpc','fs','fc','fp','fpc'];

function selT(e,k,opts={}) {
  cT = k;
  visitedTenses.add(k);
  if(!opts.keepAdv) { cAdv.clear(); cAdvMap.clear(); }

  document.querySelectorAll('.tn').forEach(n=>n.classList.remove('active'));
  const nd = (e && e.currentTarget) ? e.currentTarget : document.getElementById('nd-'+k);
  if(nd) nd.classList.add('active');

  // Mark visited dot
  const dot = nd ? nd.querySelector('.dot') : null;
  if(dot) dot.classList.add('visited');

  render();
  saveState();
}

function initTimelineA11y() {
  document.querySelectorAll('.tn').forEach(n=>{
    n.setAttribute('tabindex','0');
    n.setAttribute('role','button');
    n.setAttribute('aria-label','Seleccionar tiempo verbal');
    n.addEventListener('keydown',ev=>{
      if(ev.key==='Enter'||ev.key===' ') { ev.preventDefault(); n.click(); }
    });
  });

  document.addEventListener('keydown',ev=>{
    const a = document.activeElement;
    const inInput = a && (a.tagName==='INPUT'||a.tagName==='TEXTAREA'||a.isContentEditable);
    if(inInput) return;
    const modalOpen = document.getElementById('modalOverlay').classList.contains('open');
    if(modalOpen) return;
    if(ev.key!=='ArrowLeft'&&ev.key!=='ArrowRight') return;
    ev.preventDefault();
    const i = TORDER.indexOf(cT);
    const ni = ev.key==='ArrowLeft' ? Math.max(0,i-1) : Math.min(TORDER.length-1,i+1);
    const nk = TORDER[ni];
    const nd = document.getElementById('nd-'+nk);
    selT({currentTarget:nd}, nk);
    if(nd) nd.focus({preventScroll:true});
  });
}

/* =========================================================
   PROCESADOR DE VERBOS
========================================================= */
function procVerb() {
  const raw = (document.getElementById('vIn').value||'').toLowerCase().trim();
  const val = raw||'play';

  if(IRR[val]) {
    const d=IRR[val];
    cV={v1:d[0],v2:d[1],v3:d[2],esp:d[3],irreg:true};
  } else if(!raw) {
    cV={v1:'play',v2:'played',v3:'played',esp:'jugar / tocar (instrumento)',irreg:false};
  } else {
    const v2v3=makeV2V3(val);
    const esTranslation = REG_ESP[val] || '(sin traducci√≥n en diccionario)';
    cV={v1:val,v2:v2v3,v3:v2v3,esp:esTranslation,irreg:false};
  }

  document.getElementById('v1').textContent=cV.v1;
  document.getElementById('v2').textContent=cV.v2;
  document.getElementById('v3').textContent=cV.v3;
  document.getElementById('vEsp').textContent=cV.esp;
  document.getElementById('vVing').textContent=makeVing(cV.v1);
  document.getElementById('vV1s').textContent=thirdSg(cV.v1);

  const tb=document.getElementById('vType');
  tb.textContent=cV.irreg?'Irregular':'Regular';
  tb.className='vtype '+(cV.irreg?'irr':'reg');

  render();
  saveState();
}

/* =========================================================
   PERSISTENCIA ‚Äî localStorage
========================================================= */
function saveState() {
  const data = {
    cT,cM,cP,
    vIn: (document.getElementById('vIn')||{}).value||'',
    cAdv: Array.from(cAdv),
    cAdvMap: Array.from(cAdvMap.entries()),
    visited: Array.from(visitedTenses)
  };
  try { localStorage.setItem('nv-state', JSON.stringify(data)); } catch(_){}
}

function loadState() {
  try {
    const raw = localStorage.getItem('nv-state');
    if(!raw) return false;
    const s = JSON.parse(raw);
    if(!s || !s.cT || !TD[s.cT]) return false;
    cT  = s.cT;
    cM  = (['af','neg','int'].includes(s.cM)) ? s.cM : 'af';
    cP  = P_KEYS.includes(s.cP) ? s.cP : (s.cP==='You'?'You_s':'I');
    cAdv.clear(); cAdvMap.clear();
    if(Array.isArray(s.cAdv))    s.cAdv.forEach(k=>cAdv.add(k));
    if(Array.isArray(s.cAdvMap)) s.cAdvMap.forEach(([k,v])=>{ if(k&&v&&typeof v==='object') cAdvMap.set(k,v); });
    if(Array.isArray(s.visited)) s.visited.forEach(t=>visitedTenses.add(t));
    const inp = document.getElementById('vIn');
    if(inp && typeof s.vIn==='string') inp.value=s.vIn;
    return true;
  } catch(_) { return false; }
}

/* =========================================================
   INIT
========================================================= */
window.onload = () => {
  initPrefs();
  initTimelineA11y();
  setTopbarSpacing();
  window.addEventListener('resize', setTopbarSpacing);
  // URL hash routing: si hay hash v√°lido, √∫salo
  const hashTense = readHash();
  if(hashTense) cT = hashTense;

  const restored = loadState();
  // Si el hash difiere del estado guardado, el hash gana
  if(hashTense && hashTense !== cT) {
    cT = hashTense;
    cAdv.clear(); cAdvMap.clear();
  }

  // Mark visited
  visitedTenses.add(cT);

  // Activate timeline node
  const nd = document.getElementById('nd-'+cT) || document.getElementById('nd-prs');
  if(nd) {
    nd.classList.add('active');
    nd.querySelector('.dot')?.classList.add('visited');
  }
  // Mark all previously visited
  visitedTenses.forEach(t=>{
    const n=document.getElementById('nd-'+t);
    if(n) n.querySelector('.dot')?.classList.add('visited');
  });

  procVerb();
  if(!restored && !hashTense) { cAdv.clear(); cAdvMap.clear(); }
  render();
};
/* =========================================================
   TENSE INFO MODAL ‚Äî footer timeline
========================================================= */
const ZONE_COLORS = {
  '--past': { bg:'rgba(232,80,106,.15)', border:'rgba(232,80,106,.35)', color:'var(--past2)', btnBg:'var(--past)', btnColor:'#fff' },
  '--pres': { bg:'rgba(0,200,168,.12)',  border:'rgba(0,200,168,.30)',  color:'var(--pres2)', btnBg:'var(--teal)', btnColor:'#061513' },
  '--fut':  { bg:'rgba(240,154,26,.12)', border:'rgba(240,154,26,.30)', color:'var(--fut2)',  btnBg:'var(--fut)',  btnColor:'#1a0800' },
};

const MODE_LABELS = { af:'Afirmativa (+)', neg:'Negativa (‚àí)', int:'Pregunta (?)' };

/* =========================================================
   GU√çAS EXTENDIDAS (iframe dentro del modal)
   - Para 'prs' se usa la gu√≠a definitiva embebida (template prsAppendDoc)
   - Para el resto, se genera una gu√≠a consistente desde TD (sin depender de archivos externos)
========================================================= */
const GUIDE_TIPS = {
  prs:  ["Recuerda: con He/She/It el verbo lleva -s/-es.", "En negativa y pregunta, el verbo vuelve a V1 (do/does + V1).", "Los adverbios de frecuencia suelen ir antes del verbo principal (always, usually‚Ä¶)."],
  prc:  ["Usa 'am/is/are + V-ing' para acciones en progreso.", "Muy com√∫n con: now, right now, at the moment.", "Tambi√©n sirve para planes ya acordados (I am meeting‚Ä¶)."],
  prp:  ["Enfoca experiencia o resultado actual (sin decir cu√°ndo).", "Ya/just suelen ir entre have/has y V3.", "Usa 'yet' en neg/preg al final (I haven't‚Ä¶ yet)."],
  prpc: ["Enfoca duraci√≥n o proceso (have/has been + V-ing).", "Perfecto con for/since para duraci√≥n.", "Si quieres SOLO resultado (no proceso), usa Present Perfect."],
  ps:   ["Usa pasado simple con tiempo definido (yesterday, last‚Ä¶, in 2019).", "En negativa/pregunta: did + V1 (no V2).", "Para narrar historias: acciones en secuencia."],
  pc:   ["Fondo/acci√≥n en progreso en el pasado (was/were + V-ing).", "Interrupci√≥n t√≠pica: when + Past Simple.", "Simult√°neo: while + Past Continuous."],
  pp:   ["Pasado antes de otro pasado (had + V3).", "Muy com√∫n con: by the time, before.", "Si mencionas el orden de 2 acciones pasadas, PP aclara cu√°l fue primero."],
  ppc:  ["Duraci√≥n antes de un evento pasado (had been + V-ing).", "√ötil para causas/evidencia en el pasado (He was tired because‚Ä¶).", "for/since suelen acompa√±ar este tiempo."],
  fs:   ["Decisiones al momento, promesas y predicciones (will + V1).", "Para planes ya agendados, suele preferirse Present Continuous.", "En negativa: won't + V1."],
  fc:   ["Acci√≥n en progreso en un momento futuro (will be + V-ing).", "√ötil para preguntar planes de forma educada.", "Marcador t√≠pico: this time tomorrow."],
  fp:   ["Acci√≥n terminada antes de un punto futuro (will have + V3).", "Marcador t√≠pico: by + hora/fecha.", "Muy com√∫n: by the time‚Ä¶"],
  fpc:  ["Duraci√≥n hasta un punto futuro (will have been + V-ing).", "Combina for/since con by + punto futuro.", "Enfoca el proceso y la continuidad, no solo el resultado."]
};

function chipsToText(chips){
  return (chips||[])
    .filter(c=>c && c.k!=='arr')
    .map(c=>{
      // Compacta un poco para gu√≠a: Subject‚ÜíS, Object/Complement‚ÜíO/C
      if(c.k==='subj') return 'S';
      if(c.k==='obj')  return 'O/C';
      return c.t;
    })
    .join(' + ');
}

function buildGuideDoc(key){
  const td = TD[key];
  if(!td) return '';
  const tips = GUIDE_TIPS[key] || ["Practica con 1 adverbio a la vez para sonar natural.", "Cambia pronombres para automatizar la estructura.", "Haz 3 frases: afirmativa, negativa y pregunta."];

  const structs = ['af','neg','int'].map(m=>{
    const b = (td.aux && td.aux[m] && td.aux[m][0]) ? td.aux[m][0] : null;
    const line = b ? chipsToText(b.chips) + (m==='int'?' ?':'') : '';
    const note = b && b.note ? b.note : '';
    return {m, line, note};
  });

  const advCats = td.adverbs || {};
  const allAdv  = Object.values(advCats).flat().slice(0, 18);

  // HTML para srcdoc (autocontenido)
  return `<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${escHtml(td.n)} ¬∑ Gu√≠a extendida</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f172a; --card:#1e293b; --tx:#f8fafc; --tx2:#cbd5e1;
    --b:rgba(255,255,255,.10);
    --accent:${td.c==='--past' ? '#ff7a90' : td.c==='--fut' ? '#ffc040' : '#00e8c4'};
  }
  body{font-family:Poppins,system-ui,sans-serif;background:var(--bg);color:var(--tx);padding:16px;line-height:1.75;}
  .wrap{max-width:980px;margin:0 auto;}
  .hero{background:linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border:1px solid var(--b);border-radius:18px;padding:18px 16px;margin-bottom:12px;}
  h1{margin:0 0 6px;font-size:1.6rem;}
  .sub{color:var(--tx2);font-size:.95rem;margin:0 0 10px;}
  .pill{display:inline-block;font-weight:800;font-size:.72rem;letter-spacing:2px;text-transform:uppercase;padding:6px 12px;border-radius:999px;border:1px solid var(--b);color:var(--accent);background:rgba(0,0,0,.18);}
  .formula{margin-top:10px;font-family:ui-monospace,Consolas,monospace;font-weight:800;color:var(--accent);background:rgba(0,0,0,.22);border:1px solid var(--b);border-radius:12px;padding:10px 12px;display:inline-block;}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:10px;margin:12px 0;}
  .card{background:var(--card);border:1px solid var(--b);border-radius:16px;padding:14px 12px;}
  .lbl{font-weight:800;letter-spacing:2px;text-transform:uppercase;font-size:.68rem;color:var(--tx2);margin-bottom:8px;}
  .use-ico{font-size:1.2rem;margin-bottom:6px;}
  .use-ti{font-weight:800;margin-bottom:4px;}
  .use-desc{color:var(--tx2);font-size:.92rem;margin-bottom:8px;}
  .ex{font-family:ui-monospace,Consolas,monospace;color:var(--accent);font-weight:700;font-size:.9rem;}
  .ex2{color:var(--tx2);font-style:italic;font-size:.88rem;margin-top:4px;}
  .struct{display:flex;flex-direction:column;gap:10px;}
  .line{font-family:ui-monospace,Consolas,monospace;font-weight:800;color:var(--accent);background:rgba(0,0,0,.22);border:1px solid var(--b);border-radius:12px;padding:10px 12px;}
  .note{color:var(--tx2);font-size:.9rem;margin-top:6px;}
  .chips{display:flex;flex-wrap:wrap;gap:8px;}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--b);background:rgba(0,0,0,.18);font-size:.86rem;}
  .tips li{margin:6px 0;color:var(--tx2);}
  @media(max-width:520px){ body{padding:12px;} }
</style>
</head>
<body>
<div class="wrap">
  <div class="hero">
    <span class="pill">${escHtml(td.z)}</span>
    <h1>${escHtml(td.n)}</h1>
    <p class="sub">Gu√≠a extendida (resumen ampliado) para practicar estructuras y usos t√≠picos.</p>
    <div class="formula">${escHtml(td.f)}</div>
  </div>

  <div class="card">
    <div class="lbl">Cu√°ndo se usa</div>
    <div class="grid">
      ${(td.uso||[]).map(u=>`
        <div class="card" style="background:rgba(0,0,0,.12);">
          <div class="use-ico">${u.ico}</div>
          <div class="use-ti">${escHtml(u.ti)}</div>
          <div class="use-desc">${escHtml(u.desc)}</div>
          <div class="ex">${escHtml(u.en)}</div>
          <div class="ex2">${escHtml(u.es)}</div>
        </div>
      `).join('')}
    </div>
  </div>

  <div class="card">
    <div class="lbl">Estructura</div>
    <div class="struct">
      ${structs.map(s=>`
        <div>
          <div class="lbl" style="margin-bottom:6px;">${escHtml(MODE_LABELS[s.m]||s.m)}</div>
          <div class="line">${escHtml(s.line || td.f)}</div>
          ${s.note ? `<div class="note">${escHtml(s.note)}</div>` : ``}
        </div>
      `).join('')}
    </div>
  </div>

  <div class="card">
    <div class="lbl">Adverbios t√≠picos</div>
    <div class="chips">
      ${allAdv.length ? allAdv.map(a=>`<span class="chip">${escHtml(a.w)} <span style="opacity:.7;font-style:italic;">(${escHtml(a.e)})</span></span>`).join('') : `<span class="chip">Sin adverbios espec√≠ficos</span>`}
    </div>
  </div>

  <div class="card">
    <div class="lbl">Tips r√°pidos</div>
    <ul class="tips">
      ${tips.map(t=>`<li>${escHtml(t)}</li>`).join('')}
    </ul>
  </div>

  <div class="card" style="text-align:center;">
    <div class="lbl">Micro‚Äëreto</div>
    <p class="sub" style="margin-bottom:10px;">Crea 3 oraciones usando el verbo <b>play</b>:</p>
    <div class="chips" style="justify-content:center;">
      <span class="chip">1) Afirmativa</span>
      <span class="chip">2) Negativa</span>
      <span class="chip">3) Pregunta</span>
    </div>
    <p class="sub" style="margin-top:10px;">Luego vuelve a la app y prueba con adverbios.</p>
  </div>
</div>
</body>
</html>`;
}
function prepareGuideDoc(docHtml){
  if(!docHtml) return docHtml;

  // Replace YouTube embeds inside srcdoc with a safe "Ver video en YouTube" button.
  // This avoids YouTube "Error 153" that can happen in srcdoc/iframes (e.g., Google Sites).
  const reWrap = /<div\s+class="video-wrapper">[\s\S]*?<iframe[^>]+src="https?:\/\/(?:www\.)?(?:youtube\.com|youtube-nocookie\.com)\/embed\/([^"?&\/]+)[^"]*"[^>]*><\/iframe>[\s\S]*?<\/div>/gi;
  const reIfr  = /<iframe[^>]+src="https?:\/\/(?:www\.)?(?:youtube\.com|youtube-nocookie\.com)\/embed\/([^"?&\/]+)[^"]*"[^>]*><\/iframe>/gi;

  let out = docHtml.replace(reWrap, (m,id) => {
    const url = `https://www.youtube.com/watch?v=${id}`;
    return `<div class="video-wrapper yt-linkbox"><a class="yt-open" href="${url}" target="_blank" rel="noopener">Ver video en YouTube ‚ñ∂</a></div>`;
  });

  out = out.replace(reIfr, (m,id) => {
    const url = `https://www.youtube.com/watch?v=${id}`;
    return `<a class="yt-open" href="${url}" target="_blank" rel="noopener">Ver video en YouTube ‚ñ∂</a>`;
  });

  if(out !== docHtml){
    const css = `
/* YouTube safe link (avoids Error 153 in srcdoc / embedded contexts) */
.yt-linkbox{padding-bottom:0!important;height:auto!important;min-height:140px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.25);}
.yt-open{display:inline-flex;align-items:center;gap:10px;padding:14px 18px;border-radius:14px;font-weight:800;text-decoration:none;border:2px solid var(--primary);background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;box-shadow:0 10px 24px rgba(0,0,0,0.35);}
.yt-open:hover{filter:brightness(1.05);transform:translateY(-1px);}
.yt-open:active{transform:translateY(0);}
.yt-open:focus{outline:3px solid var(--accent);outline-offset:3px;}
`;

    if(/<\/style>/i.test(out)){
      // Inject right before the first </style>
      out = out.replace(/<\/style>/i, css + "\n</style>");
    } else if(/<\/head>/i.test(out)){
      out = out.replace(/<\/head>/i, `<style>${css}</style>\n</head>`);
    } else {
      out = `<style>${css}</style>\n` + out;
    }
  }

  return out;
}



function openTenseModal(key) {
  const td = TD[key];
  if(!td) return;

  const ov  = document.getElementById('tmOverlay');
  const zc  = ZONE_COLORS[td.c] || ZONE_COLORS['--pres'];

  // Zone badge
  const zone = document.getElementById('tmZone');
  zone.textContent = td.z;
  zone.style.background  = zc.bg;
  zone.style.border      = `1px solid ${zc.border}`;
  zone.style.color       = zc.color;
  zone.style.fontFamily  = "'JetBrains Mono', monospace";
  zone.style.fontWeight  = '900';

  // Title & formula
  document.getElementById('tmTitle').textContent   = td.n;
  document.getElementById('tmFormula').textContent = td.f;

  // Uso cards
  document.getElementById('tmUso').innerHTML = (td.uso||[]).map(u => `
    <div class="tm-uso-card">
      <div class="tm-uso-ico">${u.ico}</div>
      <div class="tm-uso-ti">${escHtml(u.ti)}</div>
      <div class="tm-uso-desc">${escHtml(u.desc)}</div>
      <div class="tm-uso-en">${escHtml(u.en)}</div>
      <div class="tm-uso-es">${escHtml(u.es)}</div>
    </div>`).join('');

  // Structure ‚Äî af/neg/int
  const auxData = td.aux || {};
  document.getElementById('tmStruct').innerHTML = ['af','neg','int'].map(m => {
    const blocks = auxData[m] || [];
    if(!blocks.length) return '';
    const b = blocks[0];
    const chips = (b.chips||[]).map(c => {
      if(c.k==='arr') return `<span class="tm-chip ch-arr">‚Üí</span>`;
      return `<span class="tm-chip ch-${c.k}">${escHtml(c.t)}</span>`;
    }).join('');
    return `
      <div class="tm-struct-row">
        <div class="tm-struct-mode">${MODE_LABELS[m]}</div>
        <div class="tm-chips">${chips}</div>
        ${b.note ? `<div class="tm-struct-note">${escHtml(b.note)}</div>` : ''}
      </div>`;
  }).join('');

  // Adverbs ‚Äî flatten all categories
  const advCats = td.adverbs || {};
  const allAdv  = Object.values(advCats).flat();
  document.getElementById('tmAdv').innerHTML = allAdv.length
    ? allAdv.map(a => `<span class="tm-adv-chip">${escHtml(a.w)}<span style="color:var(--tx3);margin-left:5px;font-style:italic;">${escHtml(a.e)}</span></span>`).join('')
    : '<span style="color:var(--tx3);font-style:italic;font-size:.82rem;">Sin adverbios espec√≠ficos.</span>';

  // Extra: Gu√≠a extendida ‚Äî para 'prs' usa la gu√≠a definitiva embebida; para el resto genera gu√≠a desde TD
  const extra = document.getElementById('tmExtra');
  const ifr   = document.getElementById('tmExtraIfr');
  const extraTitle = document.getElementById('tmExtraTitle');
  const extraSub   = document.getElementById('tmExtraSub');

  if(extra){
    extra.style.display = 'block';
    if(extraTitle) extraTitle.textContent = `üìò ${td.n} ¬∑ Gu√≠a extendida`;
    if(extraSub)   extraSub.textContent   = (key === 'prs')
      ? 'Gu√≠a definitiva (interactiva) integrada dentro del modal.'
      : (key === 'prc')
        ? 'Gu√≠a completa de Present Continuous integrada dentro del modal.'
        : (key === 'pc')
          ? 'Gu√≠a completa de Past Continuous integrada dentro del modal.'
          : (key === 'fs')
        ? 'Gu√≠a completa de Future Simple (Will) integrada dentro del modal.'
        : (key === 'ps')
          ? 'Gu√≠a completa de Past Simple integrada dentro del modal.'
          : (key === 'prp')
            ? 'Gu√≠a completa de Present Perfect integrada dentro del modal.'
            : (key === 'prpc')
              ? 'Gu√≠a completa de Present Perfect Continuous integrada dentro del modal.'
              : (key === 'pp')
              ? 'Gu√≠a completa de Past Perfect integrada dentro del modal.'
              : (key === 'ppc')
                ? 'Gu√≠a completa de Past Perfect Continuous integrada dentro del modal.'
                : (key === 'fp')
                ? 'Gu√≠a completa de Future Perfect integrada dentro del modal.'
                : 'Resumen ampliado con ejemplos, estructura y tips (autogenerado).';

    if(ifr){
      // Recarga solo si cambia el tiempo
      const prevKey = ifr.dataset.key || '';
      if(prevKey !== key){
        if(key === 'prs'){
          const tpl = document.getElementById('prsAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
        } else if(key === 'prc'){
          const tpl = document.getElementById('prcAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'pc'){
          const tpl = document.getElementById('pcAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'fs'){
          const tpl = document.getElementById('fsAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'ps'){
          const tpl = document.getElementById('psAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'prp'){
          const tpl = document.getElementById('prpAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'prpc'){
          const tpl = document.getElementById('prpcAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'pp'){
          const tpl = document.getElementById('ppAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'ppc'){
          const tpl = document.getElementById('ppcAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'fp'){
          const tpl = document.getElementById('fpAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'fpc'){
          const tpl = document.getElementById('fpcAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else if(key === 'fc'){
          const tpl = document.getElementById('fcAppendDoc');
          if(tpl) ifr.srcdoc = prepareGuideDoc(tpl.innerHTML.trim());
          else    ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        } else {
          ifr.srcdoc = prepareGuideDoc(buildGuideDoc(key));
        }
        ifr.dataset.key = key;
      }
    }
  }
// CTA button ‚Äî go to this tense
  const btn = document.getElementById('tmBtnGo');
  btn.style.background = zc.btnBg;
  btn.style.color      = zc.btnColor;
  btn.textContent      = `Explorar: ${td.n} ‚Üí`;
  btn.onclick = () => {
    closeTenseModal();
    // Navigate to top and select tense
    const nd = document.getElementById('nd-'+key);
    selT(nd ? {currentTarget:nd} : {currentTarget:null}, key);
    window.scrollTo({top:0, behavior:'smooth'});
  };

  ov.classList.add('open');
  document.body.style.overflow = 'hidden';
  // Focus close button for a11y
  setTimeout(() => ov.querySelector('.tm-close')?.focus(), 80);
}

function closeTenseModal() {
  document.getElementById('tmOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

// Escape key closes tense modal
document.addEventListener('keydown', ev => {
  if(ev.key === 'Escape') closeTenseModal();
});
</script>
</body>
</html>
